<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Distributed Aggregation Protocol for Privacy Preserving Measurement</title>
<meta content="Tim Geoghegan" name="author">
<meta content="Christopher Patton" name="author">
<meta content="Brandon Pitman" name="author">
<meta content="Eric Rescorla" name="author">
<meta content="Christopher A. Wood" name="author">
<meta content="
       There are many situations in which it is desirable to take measurements of data
which people consider sensitive. In these cases, the entity taking the
measurement is usually not interested in people's individual responses but
rather in aggregated data. Conventional methods require collecting individual
responses and then aggregating them, thus representing a threat to user privacy
and rendering many such measurements difficult and impractical. This document
describes a multi-party distributed aggregation protocol (DAP) for privacy
preserving measurement (PPM) which can be used to collect aggregate data without
revealing any individual user's data. 
    " name="description">
<meta content="xml2rfc 3.25.0" name="generator">
<meta content="draft-ietf-ppm-dap-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.25.0
    Python 3.12.8
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.5
    lxml 5.3.0
    platformdirs 4.3.6
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-ppm-dap.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">DAP</td>
<td class="right">January 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Geoghegan, et al.</td>
<td class="center">Expires 19 July 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-ppm-dap-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-01-15" class="published">15 January 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-07-19">19 July 2025</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">T. Geoghegan</div>
<div class="org">ISRG</div>
</div>
<div class="author">
      <div class="author-name">C. Patton</div>
<div class="org">Cloudflare</div>
</div>
<div class="author">
      <div class="author-name">B. Pitman</div>
<div class="org">ISRG</div>
</div>
<div class="author">
      <div class="author-name">E. Rescorla</div>
<div class="org">Independent</div>
</div>
<div class="author">
      <div class="author-name">C. A. Wood</div>
<div class="org">Cloudflare</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Distributed Aggregation Protocol for Privacy Preserving Measurement</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">There are many situations in which it is desirable to take measurements of data
which people consider sensitive. In these cases, the entity taking the
measurement is usually not interested in people's individual responses but
rather in aggregated data. Conventional methods require collecting individual
responses and then aggregating them, thus representing a threat to user privacy
and rendering many such measurements difficult and impractical. This document
describes a multi-party distributed aggregation protocol (DAP) for privacy
preserving measurement (PPM) which can be used to collect aggregate data without
revealing any individual user's data.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://ietf-wg-ppm.github.io/draft-ietf-ppm-dap/draft-ietf-ppm-dap.html">https://ietf-wg-ppm.github.io/draft-ietf-ppm-dap/draft-ietf-ppm-dap.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-ietf-ppm-dap/">https://datatracker.ietf.org/doc/draft-ietf-ppm-dap/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        Privacy Preserving Measurement Working Group mailing list (<span><a href="mailto:ppm@ietf.org">mailto:ppm@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/ppm/">https://mailarchive.ietf.org/arch/browse/ppm/</a></span>.
        Subscribe at <span><a href="https://www.ietf.org/mailman/listinfo/ppm/">https://www.ietf.org/mailman/listinfo/ppm/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/ietf-wg-ppm/draft-ietf-ppm-dap">https://github.com/ietf-wg-ppm/draft-ietf-ppm-dap</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 19 July 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-change-log" class="internal xref">Change Log</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2.2.1">
                    <p id="section-toc.1-1.1.2.2.2.1.1" class="keepWithNext"><a href="#section-1.2.1" class="auto internal xref">1.2.1</a>.  <a href="#name-glossary-of-terms" class="internal xref">Glossary of Terms</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1"><a href="#section-1.3" class="auto internal xref">1.3</a>.  <a href="#name-representation-language" class="internal xref">Representation Language</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-overview" class="internal xref">Overview</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-system-architecture" class="internal xref">System Architecture</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-validating-measurements" class="internal xref">Validating Measurements</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="auto internal xref">2.3</a>.  <a href="#name-replay-protection" class="internal xref">Replay Protection</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-message-transport" class="internal xref">Message Transport</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-https-request-authenticatio" class="internal xref">HTTPS Request Authentication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-errors" class="internal xref">Errors</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-protocol-definition" class="internal xref">Protocol Definition</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-basic-type-definitions" class="internal xref">Basic Type Definitions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-batch-modes-batches-and-que" class="internal xref">Batch Modes, Batches, and Queries</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-task-configuration" class="internal xref">Task Configuration</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-resource-uris" class="internal xref">Resource URIs</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-timestamps-and-time-interva" class="internal xref">Timestamps and Time Intervals</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="auto internal xref">4.6</a>.  <a href="#name-uploading-reports" class="internal xref">Uploading Reports</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.1">
                    <p id="section-toc.1-1.4.2.6.2.1.1"><a href="#section-4.6.1" class="auto internal xref">4.6.1</a>.  <a href="#name-hpke-configuration-request" class="internal xref">HPKE Configuration Request</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.2">
                    <p id="section-toc.1-1.4.2.6.2.2.1"><a href="#section-4.6.2" class="auto internal xref">4.6.2</a>.  <a href="#name-upload-request" class="internal xref">Upload Request</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.3">
                    <p id="section-toc.1-1.4.2.6.2.3.1"><a href="#section-4.6.3" class="auto internal xref">4.6.3</a>.  <a href="#name-report-extensions" class="internal xref">Report Extensions</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7">
                <p id="section-toc.1-1.4.2.7.1"><a href="#section-4.7" class="auto internal xref">4.7</a>.  <a href="#name-verifying-and-aggregating-r" class="internal xref">Verifying and Aggregating Reports</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7.2.1">
                    <p id="section-toc.1-1.4.2.7.2.1.1"><a href="#section-4.7.1" class="auto internal xref">4.7.1</a>.  <a href="#name-aggregate-initialization" class="internal xref">Aggregate Initialization</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7.2.2">
                    <p id="section-toc.1-1.4.2.7.2.2.1"><a href="#section-4.7.2" class="auto internal xref">4.7.2</a>.  <a href="#name-aggregate-continuation" class="internal xref">Aggregate Continuation</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8">
                <p id="section-toc.1-1.4.2.8.1"><a href="#section-4.8" class="auto internal xref">4.8</a>.  <a href="#name-collecting-results" class="internal xref">Collecting Results</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8.2.1">
                    <p id="section-toc.1-1.4.2.8.2.1.1"><a href="#section-4.8.1" class="auto internal xref">4.8.1</a>.  <a href="#name-collection-job-initializati" class="internal xref">Collection Job Initialization</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8.2.2">
                    <p id="section-toc.1-1.4.2.8.2.2.1"><a href="#section-4.8.2" class="auto internal xref">4.8.2</a>.  <a href="#name-obtaining-aggregate-shares" class="internal xref">Obtaining Aggregate Shares</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8.2.3">
                    <p id="section-toc.1-1.4.2.8.2.3.1"><a href="#section-4.8.3" class="auto internal xref">4.8.3</a>.  <a href="#name-collection-job-finalization" class="internal xref">Collection Job Finalization</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8.2.4">
                    <p id="section-toc.1-1.4.2.8.2.4.1"><a href="#section-4.8.4" class="auto internal xref">4.8.4</a>.  <a href="#name-aggregate-share-encryption" class="internal xref">Aggregate Share Encryption</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8.2.5">
                    <p id="section-toc.1-1.4.2.8.2.5.1"><a href="#section-4.8.5" class="auto internal xref">4.8.5</a>.  <a href="#name-batch-validation" class="internal xref">Batch Validation</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-batch-modes" class="internal xref">Batch Modes</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-time-interval" class="internal xref">Time Interval</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.1">
                    <p id="section-toc.1-1.5.2.1.2.1.1"><a href="#section-5.1.1" class="auto internal xref">5.1.1</a>.  <a href="#name-query-configuration" class="internal xref">Query Configuration</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.2">
                    <p id="section-toc.1-1.5.2.1.2.2.1"><a href="#section-5.1.2" class="auto internal xref">5.1.2</a>.  <a href="#name-partial-batch-selector-conf" class="internal xref">Partial Batch Selector Configuration</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.3">
                    <p id="section-toc.1-1.5.2.1.2.3.1"><a href="#section-5.1.3" class="auto internal xref">5.1.3</a>.  <a href="#name-batch-selector-configuratio" class="internal xref">Batch Selector Configuration</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.4">
                    <p id="section-toc.1-1.5.2.1.2.4.1"><a href="#section-5.1.4" class="auto internal xref">5.1.4</a>.  <a href="#name-batch-buckets-2" class="internal xref">Batch Buckets</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-leader-selected-batch-mode" class="internal xref">Leader-selected Batch Mode</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.1">
                    <p id="section-toc.1-1.5.2.2.2.1.1"><a href="#section-5.2.1" class="auto internal xref">5.2.1</a>.  <a href="#name-query-configuration-2" class="internal xref">Query Configuration</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.2">
                    <p id="section-toc.1-1.5.2.2.2.2.1"><a href="#section-5.2.2" class="auto internal xref">5.2.2</a>.  <a href="#name-partial-batch-selector-confi" class="internal xref">Partial Batch Selector Configuration</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.3">
                    <p id="section-toc.1-1.5.2.2.2.3.1"><a href="#section-5.2.3" class="auto internal xref">5.2.3</a>.  <a href="#name-batch-selector-configuration" class="internal xref">Batch Selector Configuration</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.4">
                    <p id="section-toc.1-1.5.2.2.2.4.1"><a href="#section-5.2.4" class="auto internal xref">5.2.4</a>.  <a href="#name-batch-buckets-3" class="internal xref">Batch Buckets</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-operational-considerations" class="internal xref">Operational Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-protocol-participant-capabi" class="internal xref">Protocol Participant Capabilities</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.1">
                    <p id="section-toc.1-1.6.2.1.2.1.1"><a href="#section-6.1.1" class="auto internal xref">6.1.1</a>.  <a href="#name-client-capabilities" class="internal xref">Client Capabilities</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.2">
                    <p id="section-toc.1-1.6.2.1.2.2.1"><a href="#section-6.1.2" class="auto internal xref">6.1.2</a>.  <a href="#name-aggregator-capabilities" class="internal xref">Aggregator Capabilities</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.3">
                    <p id="section-toc.1-1.6.2.1.2.3.1"><a href="#section-6.1.3" class="auto internal xref">6.1.3</a>.  <a href="#name-collector-capabilities" class="internal xref">Collector Capabilities</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-vdafs-and-compute-requireme" class="internal xref">VDAFs and Compute Requirements</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.  <a href="#name-aggregation-utility-and-sof" class="internal xref">Aggregation Utility and Soft Batch Deadlines</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="auto internal xref">6.4</a>.  <a href="#name-protocol-specific-optimizat" class="internal xref">Protocol-specific Optimizations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4.2.1">
                    <p id="section-toc.1-1.6.2.4.2.1.1"><a href="#section-6.4.1" class="auto internal xref">6.4.1</a>.  <a href="#name-reducing-storage-requiremen" class="internal xref">Reducing Storage Requirements</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4.2.2">
                    <p id="section-toc.1-1.6.2.4.2.2.1"><a href="#section-6.4.2" class="auto internal xref">6.4.2</a>.  <a href="#name-distributed-systems-and-syn" class="internal xref">Distributed-systems and Synchronization Concerns</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-compliance-requirements" class="internal xref">Compliance Requirements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-sybil-attacks" class="internal xref">Sybil Attacks</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-batch-selection-attacks" class="internal xref">Batch-selection Attacks</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-client-authentication" class="internal xref">Client Authentication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="auto internal xref">8.4</a>.  <a href="#name-anonymizing-proxies" class="internal xref">Anonymizing Proxies</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.5">
                <p id="section-toc.1-1.8.2.5.1"><a href="#section-8.5" class="auto internal xref">8.5</a>.  <a href="#name-differential-privacy" class="internal xref">Differential Privacy</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.6">
                <p id="section-toc.1-1.8.2.6.1"><a href="#section-8.6" class="auto internal xref">8.6</a>.  <a href="#name-task-parameters" class="internal xref">Task Parameters</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.6.2.1">
                    <p id="section-toc.1-1.8.2.6.2.1.1"><a href="#section-8.6.1" class="auto internal xref">8.6.1</a>.  <a href="#name-vdaf-verification-key-requi" class="internal xref">VDAF Verification Key Requirements</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.6.2.2">
                    <p id="section-toc.1-1.8.2.6.2.2.1"><a href="#section-8.6.2" class="auto internal xref">8.6.2</a>.  <a href="#name-batch-parameters" class="internal xref">Batch Parameters</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.6.2.3">
                    <p id="section-toc.1-1.8.2.6.2.3.1"><a href="#section-8.6.3" class="auto internal xref">8.6.3</a>.  <a href="#name-task-configuration-agreemen" class="internal xref">Task Configuration Agreement and Consistency</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.7">
                <p id="section-toc.1-1.8.2.7.1"><a href="#section-8.7" class="auto internal xref">8.7</a>.  <a href="#name-infrastructure-diversity" class="internal xref">Infrastructure Diversity</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-protocol-message-media-type" class="internal xref">Protocol Message Media Types</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.1">
                    <p id="section-toc.1-1.9.2.1.2.1.1"><a href="#section-9.1.1" class="auto internal xref">9.1.1</a>.  <a href="#name-application-dap-hpke-config" class="internal xref">"application/dap-hpke-config-list" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.2">
                    <p id="section-toc.1-1.9.2.1.2.2.1"><a href="#section-9.1.2" class="auto internal xref">9.1.2</a>.  <a href="#name-application-dap-report-medi" class="internal xref">"application/dap-report" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.3">
                    <p id="section-toc.1-1.9.2.1.2.3.1"><a href="#section-9.1.3" class="auto internal xref">9.1.3</a>.  <a href="#name-application-dap-aggregation" class="internal xref">"application/dap-aggregation-job-init-req" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.4">
                    <p id="section-toc.1-1.9.2.1.2.4.1"><a href="#section-9.1.4" class="auto internal xref">9.1.4</a>.  <a href="#name-application-dap-aggregation-" class="internal xref">"application/dap-aggregation-job-resp" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.5">
                    <p id="section-toc.1-1.9.2.1.2.5.1"><a href="#section-9.1.5" class="auto internal xref">9.1.5</a>.  <a href="#name-application-dap-aggregation-j" class="internal xref">"application/dap-aggregation-job-continue-req" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.6">
                    <p id="section-toc.1-1.9.2.1.2.6.1"><a href="#section-9.1.6" class="auto internal xref">9.1.6</a>.  <a href="#name-application-dap-aggregate-s" class="internal xref">"application/dap-aggregate-share-req" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.7">
                    <p id="section-toc.1-1.9.2.1.2.7.1"><a href="#section-9.1.7" class="auto internal xref">9.1.7</a>.  <a href="#name-application-dap-aggregate-sh" class="internal xref">"application/dap-aggregate-share" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.8">
                    <p id="section-toc.1-1.9.2.1.2.8.1"><a href="#section-9.1.8" class="auto internal xref">9.1.8</a>.  <a href="#name-application-dap-collection-" class="internal xref">"application/dap-collection-job-req" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.9">
                    <p id="section-toc.1-1.9.2.1.2.9.1"><a href="#section-9.1.9" class="auto internal xref">9.1.9</a>.  <a href="#name-application-dap-collection-j" class="internal xref">"application/dap-collection-job-resp" media type</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-dap-type-registries" class="internal xref">DAP Type Registries</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2.2.1">
                    <p id="section-toc.1-1.9.2.2.2.1.1"><a href="#section-9.2.1" class="auto internal xref">9.2.1</a>.  <a href="#name-batch-modes-registry" class="internal xref">Batch Modes Registry</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2.2.2">
                    <p id="section-toc.1-1.9.2.2.2.2.1"><a href="#section-9.2.2" class="auto internal xref">9.2.2</a>.  <a href="#name-report-extension-registry" class="internal xref">Report Extension Registry</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2.2.3">
                    <p id="section-toc.1-1.9.2.2.2.3.1"><a href="#section-9.2.3" class="auto internal xref">9.2.3</a>.  <a href="#name-report-error-registry" class="internal xref">Report Error Registry</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="auto internal xref">9.3</a>.  <a href="#name-urn-sub-namespace-for-dap-u" class="internal xref">URN Sub-namespace for DAP (urn:ietf:params:ppm:dap)</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-extending-this-document" class="internal xref">Extending this Document</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="auto internal xref">11.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="auto internal xref">11.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-contributors" class="internal xref">Contributors</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document describes the Distributed Aggregation Protocol (DAP) for privacy
preserving measurement. The protocol is executed by a large set of clients and two
aggregation servers. The aggregators' goal is to compute some aggregate
statistic over measurements generated by clients without learning the
measurements themselves. This is made possible by distributing the computation
among the aggregators in such a way that, as long as at least one of them
executes the protocol honestly, no measurement is ever seen in the clear by any
aggregator.<a href="#section-1-1" class="pilcrow">¶</a></p>
<div id="change-log">
<section id="section-1.1">
        <h3 id="name-change-log">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-change-log" class="section-name selfRef">Change Log</a>
        </h3>
<p id="section-1.1-1">(RFC EDITOR: Remove this section.)<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">(*) Indicates a change that breaks wire compatibility with the previous draft.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">13:<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-4.1">
            <p id="section-1.1-4.1.1">Bump draft-irtf-cfrg-vdaf-12 to 13 <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span> and adopt the streaming
aggregation interface. Accordingly, clarify that DAP is only compatible with
VDAFs for which aggregation is order insensitive.<a href="#section-1.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.2">
            <p id="section-1.1-4.2.1">Add public extensions to report metadata. (*)<a href="#section-1.1-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.3">
            <p id="section-1.1-4.3.1">Improve extension points for batch modes. (*)<a href="#section-1.1-4.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.4">
            <p id="section-1.1-4.4.1">During the upload interaction, allow the Leader to indicate to the Client which
set of report extensions it doesn't support.<a href="#section-1.1-4.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.5">
            <p id="section-1.1-4.5.1">Add a start time to task parameters and require rejection of reports outside
of the time validity window. Incidentally, replace the task end time with a
task duration parameter.<a href="#section-1.1-4.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.6">
            <p id="section-1.1-4.6.1">Clarify underspecified behavior around aggregation skew recovery.<a href="#section-1.1-4.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.7">
            <p id="section-1.1-4.7.1">Improve IANA considerations and add guidelines for extending DAP.<a href="#section-1.1-4.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.8">
            <p id="section-1.1-4.8.1">Rename "upload extension" to "report extension", and "prepare error" to
"report error", to better align the names of these types with their
functionality.<a href="#section-1.1-4.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.9">
            <p id="section-1.1-4.9.1">Bump version tag from "dap-12" to "dap-13". (*)<a href="#section-1.1-4.9.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-5">12:<a href="#section-1.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-6.1">
            <p id="section-1.1-6.1.1">Bump draft-irtf-cfrg-vdaf-08 to 12 <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>, and specify the newly-defined
application context string to be a concatenation of the DAP version in use
with the task ID. (*)<a href="#section-1.1-6.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.2">
            <p id="section-1.1-6.2.1">Add support for "asynchronous" aggregation, based on the Leader polling the
Helper for the result of each step of aggregation. (*)<a href="#section-1.1-6.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.3">
            <p id="section-1.1-6.3.1">Update collection semantics to match the new aggregation semantics introduced
in support of asynchronous aggregation. (*)<a href="#section-1.1-6.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.4">
            <p id="section-1.1-6.4.1">Clarify the requirements around report replay protection, defining when and
how report IDs must be checked and stored in order to correctly detect
replays.<a href="#section-1.1-6.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.5">
            <p id="section-1.1-6.5.1">Remove support for per-task HPKE configurations. (*)<a href="#section-1.1-6.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.6">
            <p id="section-1.1-6.6.1">Rename "query type" to "batch mode", to align the name of this configuration
value with its functionality.<a href="#section-1.1-6.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.7">
            <p id="section-1.1-6.7.1">Rename the "fixed-size" batch mode to "leader-selected", to align the name
with the behavior of this query type.<a href="#section-1.1-6.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.8">
            <p id="section-1.1-6.8.1">Remove the <code>max_batch_size</code> parameter of the "fixed-size" batch mode.<a href="#section-1.1-6.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.9">
            <p id="section-1.1-6.9.1">Restore the <code>part_batch_selector</code> field of the <code>Collection</code> structure, which
was removed in draft 11, as it is required to decrypt collection results in
some cases. (*)<a href="#section-1.1-6.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.10">
            <p id="section-1.1-6.10.1">Update <code>PrepareError</code> allocations in order to remove an unused value and to
reserve the zero value for testing. (*)<a href="#section-1.1-6.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.11">
            <p id="section-1.1-6.11.1">Document distributed-system and synchronization concerns in the operational
considerations section.<a href="#section-1.1-6.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.12">
            <p id="section-1.1-6.12.1">Document additional storage and runtime requirements in the operational
considerations section.<a href="#section-1.1-6.12.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.13">
            <p id="section-1.1-6.13.1">Document deviations from the presentation language of <span><a href="https://rfc-editor.org/rfc/rfc8446#section-3" class="relref">Section 3</a> of [<a href="#RFC8446" class="cite xref">RFC8446</a>]</span> for structures described in this specification.<a href="#section-1.1-6.13.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.14">
            <p id="section-1.1-6.14.1">Clarify that differential privacy mitigations can help with privacy, rather
than robustness, in the operational considerations section.<a href="#section-1.1-6.14.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.15">
            <p id="section-1.1-6.15.1">Bump version tag from "dap-11" to "dap-12". (*)<a href="#section-1.1-6.15.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-7">11:<a href="#section-1.1-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-8.1">
            <p id="section-1.1-8.1.1">Remove support for multi-collection of batches, as well as the fixed-size
query type's <code>by_batch_id</code> query. (*)<a href="#section-1.1-8.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-8.2">
            <p id="section-1.1-8.2.1">Clarify purpose of report ID uniqueness.<a href="#section-1.1-8.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-8.3">
            <p id="section-1.1-8.3.1">Bump version tag from "dap-10" to "dap-11". (*)<a href="#section-1.1-8.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-9">10:<a href="#section-1.1-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-10.1">
            <p id="section-1.1-10.1.1">Editorial changes from httpdir early review.<a href="#section-1.1-10.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-10.2">
            <p id="section-1.1-10.2.1">Poll collection jobs with HTTP GET instead of POST. (*)<a href="#section-1.1-10.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-10.3">
            <p id="section-1.1-10.3.1">Upload reports with HTTP POST instead of PUT. (*)<a href="#section-1.1-10.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-10.4">
            <p id="section-1.1-10.4.1">Clarify requirements for problem documents.<a href="#section-1.1-10.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-10.5">
            <p id="section-1.1-10.5.1">Provide guidance on batch sizes when running VDAFs with non-trivial
aggregation parameters.<a href="#section-1.1-10.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-10.6">
            <p id="section-1.1-10.6.1">Bump version tag from "dap-09" to "dap-10". (*)<a href="#section-1.1-10.6.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-11">09:<a href="#section-1.1-11" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-12.1">
            <p id="section-1.1-12.1.1">Fixed-size queries: make the maximum batch size optional.<a href="#section-1.1-12.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-12.2">
            <p id="section-1.1-12.2.1">Fixed-size queries: require current-batch queries to return distinct batches.<a href="#section-1.1-12.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-12.3">
            <p id="section-1.1-12.3.1">Clarify requirements for compatible VDAFs.<a href="#section-1.1-12.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-12.4">
            <p id="section-1.1-12.4.1">Clarify rules around creating and abandoning aggregation jobs.<a href="#section-1.1-12.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-12.5">
            <p id="section-1.1-12.5.1">Recommend that all task parameters are visible to all parties.<a href="#section-1.1-12.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-12.6">
            <p id="section-1.1-12.6.1">Revise security considerations section.<a href="#section-1.1-12.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-12.7">
            <p id="section-1.1-12.7.1">Bump draft-irtf-cfrg-vdaf-07 to 08 <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>. (*)<a href="#section-1.1-12.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-12.8">
            <p id="section-1.1-12.8.1">Bump version tag from "dap-07" to "dap-09". (*)<a href="#section-1.1-12.8.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-13">08:<a href="#section-1.1-13" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-14.1">
            <p id="section-1.1-14.1.1">Clarify requirements for initializing aggregation jobs.<a href="#section-1.1-14.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-14.2">
            <p id="section-1.1-14.2.1">Add more considerations for Sybil attacks.<a href="#section-1.1-14.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-14.3">
            <p id="section-1.1-14.3.1">Expand guidance around choosing the VDAF verification key.<a href="#section-1.1-14.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-14.4">
            <p id="section-1.1-14.4.1">Add an error type registry for the aggregation sub-protocol.<a href="#section-1.1-14.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-15">07:<a href="#section-1.1-15" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-16.1">
            <p id="section-1.1-16.1.1">Bump version tag from "dap-06" to "dap-07". This is a bug-fix revision: the
editors overlooked some changes we intended to pick up in the previous
version. (*)<a href="#section-1.1-16.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-17">06:<a href="#section-1.1-17" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-18.1">
            <p id="section-1.1-18.1.1">Bump draft-irtf-cfrg-vdaf-06 to 07 <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>. (*)<a href="#section-1.1-18.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-18.2">
            <p id="section-1.1-18.2.1">Overhaul security considerations (#488).<a href="#section-1.1-18.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-18.3">
            <p id="section-1.1-18.3.1">Adopt revised ping-pong interface in draft-irtf-cfrg-vdaf-07 (#494).<a href="#section-1.1-18.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-18.4">
            <p id="section-1.1-18.4.1">Add aggregation parameter to <code>AggregateShareAad</code> (#498). (*)<a href="#section-1.1-18.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-18.5">
            <p id="section-1.1-18.5.1">Bump version tag from "dap-05" to "dap-06". (*)<a href="#section-1.1-18.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-19">05:<a href="#section-1.1-19" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-20.1">
            <p id="section-1.1-20.1.1">Bump draft-irtf-cfrg-vdaf-05 to 06 <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>. (*)<a href="#section-1.1-20.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-20.2">
            <p id="section-1.1-20.2.1">Specialize the protocol for two-party VDAFs (i.e., one Leader and One
Helper). Accordingly, update the aggregation sub-protocol to use the new
"ping-pong" interface for two-party VDAFs introduced in
draft-irtf-cfrg-vdaf-06. (*)<a href="#section-1.1-20.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-20.3">
            <p id="section-1.1-20.3.1">Allow the following actions to be safely retried: aggregation job creation,
collection job creation, and requesting the Helper's aggregate share.<a href="#section-1.1-20.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-20.4">
            <p id="section-1.1-20.4.1">Merge error types that are related.<a href="#section-1.1-20.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-20.5">
            <p id="section-1.1-20.5.1">Drop recommendation to generate IDs using a cryptographically secure
pseudorandom number generator wherever pseudorandomness is not required.<a href="#section-1.1-20.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-20.6">
            <p id="section-1.1-20.6.1">Require HPKE config identifiers to be unique.<a href="#section-1.1-20.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-20.7">
            <p id="section-1.1-20.7.1">Bump version tag from "dap-04" to "dap-05". (*)<a href="#section-1.1-20.7.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-21">04:<a href="#section-1.1-21" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-22.1">
            <p id="section-1.1-22.1.1">Introduce resource oriented HTTP API. (#278, #398, #400) (*)<a href="#section-1.1-22.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-22.2">
            <p id="section-1.1-22.2.1">Clarify security requirements for choosing VDAF verify key. (#407, #411)<a href="#section-1.1-22.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-22.3">
            <p id="section-1.1-22.3.1">Require Clients to provide nonce and random input when sharding inputs. (#394,
#425) (*)<a href="#section-1.1-22.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-22.4">
            <p id="section-1.1-22.4.1">Add interval of time spanned by constituent reports to Collection message.
(#397, #403) (*)<a href="#section-1.1-22.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-22.5">
            <p id="section-1.1-22.5.1">Update share validation requirements based on latest security analysis. (#408,
#410)<a href="#section-1.1-22.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-22.6">
            <p id="section-1.1-22.6.1">Bump draft-irtf-cfrg-vdaf-03 to 05 <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>. (#429) (*)<a href="#section-1.1-22.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-22.7">
            <p id="section-1.1-22.7.1">Bump version tag from "dap-03" to "dap-04". (#424) (*)<a href="#section-1.1-22.7.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-23">03:<a href="#section-1.1-23" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-24.1">
            <p id="section-1.1-24.1.1">Enrich the "fixed_size" query type to allow the Collector to request a
recently aggregated batch without knowing the batch ID in advance. ID
discovery was previously done out-of-band. (*)<a href="#section-1.1-24.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-24.2">
            <p id="section-1.1-24.2.1">Allow Aggregators to advertise multiple HPKE configurations. (*)<a href="#section-1.1-24.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-24.3">
            <p id="section-1.1-24.3.1">Clarify requirements for enforcing anti-replay. Namely, while it is sufficient
to detect repeated report IDs, it is also enough to detect repeated IDs and
timestamps.<a href="#section-1.1-24.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-24.4">
            <p id="section-1.1-24.4.1">Remove the extensions from the Report and add extensions to the plaintext
payload of each ReportShare. (*)<a href="#section-1.1-24.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-24.5">
            <p id="section-1.1-24.5.1">Clarify that extensions are mandatory to implement: If an Aggregator does not
recognize a ReportShare's extension, it must reject it.<a href="#section-1.1-24.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-24.6">
            <p id="section-1.1-24.6.1">Clarify that Aggregators must reject any ReportShare with repeated extension
types.<a href="#section-1.1-24.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-24.7">
            <p id="section-1.1-24.7.1">Specify explicitly how to serialize the Additional Authenticated Data (AAD)
string for HPKE encryption. This clarifies an ambiguity in the previous
version. (*)<a href="#section-1.1-24.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-24.8">
            <p id="section-1.1-24.8.1">Change the length tag for the aggregation parameter to 32 bits. (*)<a href="#section-1.1-24.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-24.9">
            <p id="section-1.1-24.9.1">Use the same prefix ("application") for all media types. (*)<a href="#section-1.1-24.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-24.10">
            <p id="section-1.1-24.10.1">Make input share validation more explicit, including adding a new
ReportShareError variant, "report_too_early", for handling reports too far in
the future. (*)<a href="#section-1.1-24.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-24.11">
            <p id="section-1.1-24.11.1">Improve alignment of problem details usage with <span>[<a href="#RFC7807" class="cite xref">RFC7807</a>]</span>. Replace
"reportTooLate" problem document type with "repjortRejected" and clarify
handling of rejected reports in the upload sub-protocol. (*)<a href="#section-1.1-24.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-24.12">
            <p id="section-1.1-24.12.1">Bump version tag from "dap-02" to "dap-03". (*)<a href="#section-1.1-24.12.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-25">02:<a href="#section-1.1-25" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-26.1">
            <p id="section-1.1-26.1.1">Define a new task configuration parameter, called the "query type", that
allows tasks to partition reports into batches in different ways. In the
current draft, the Collector specifies a "query", which the Aggregators use to
guide selection of the batch. Two query types are defined: the "time_interval"
type captures the semantics of draft 01; and the "fixed_size" type allows the
Leader to partition the reports arbitrarily, subject to the constraint that
each batch is roughly the same size. (*)<a href="#section-1.1-26.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-26.2">
            <p id="section-1.1-26.2.1">Define a new task configuration parameter, called the task "expiration", that
defines the lifetime of a given task.<a href="#section-1.1-26.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-26.3">
            <p id="section-1.1-26.3.1">Specify requirements for HTTP request authentication rather than a concrete
scheme. (Draft 01 required the use of the <code>DAP-Auth-Token</code> header; this is now
optional.)<a href="#section-1.1-26.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-26.4">
            <p id="section-1.1-26.4.1">Make "task_id" an optional parameter of the "/hpke_config" endpoint.<a href="#section-1.1-26.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-26.5">
            <p id="section-1.1-26.5.1">Add report count to CollectResp message. (*)<a href="#section-1.1-26.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-26.6">
            <p id="section-1.1-26.6.1">Increase message payload sizes to accommodate VDAFs with input and aggregate
shares larger than 2^16-1 bytes. (*)<a href="#section-1.1-26.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-26.7">
            <p id="section-1.1-26.7.1">Bump draft-irtf-cfrg-vdaf-01 to 03 <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>. (*)<a href="#section-1.1-26.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-26.8">
            <p id="section-1.1-26.8.1">Bump version tag from "dap-01" to "dap-02". (*)<a href="#section-1.1-26.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-26.9">
            <p id="section-1.1-26.9.1">Rename the report nonce to the "report ID" and move it to the top of the
structure. (*)<a href="#section-1.1-26.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-26.10">
            <p id="section-1.1-26.10.1">Clarify when it is safe for an Aggregator to evict various data artifacts from
long-term storage.<a href="#section-1.1-26.10.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-1.2">
        <h3 id="name-conventions-and-definitions">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
        </h3>
<p id="section-1.2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<div id="glossary-of-terms">
<section id="section-1.2.1">
          <h4 id="name-glossary-of-terms">
<a href="#section-1.2.1" class="section-number selfRef">1.2.1. </a><a href="#name-glossary-of-terms" class="section-name selfRef">Glossary of Terms</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-1.2.1-1">
            <dt id="section-1.2.1-1.1">Aggregate result:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.2">
              <p id="section-1.2.1-1.2.1">The output of the aggregation function. As defined in <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.2.1-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.3">Aggregate share:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.4">
              <p id="section-1.2.1-1.4.1">A secret share of the aggregate result computed by each Aggregator and
transmitted to the Collector. As defined in <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.2.1-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.5">Aggregation function:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.6">
              <p id="section-1.2.1-1.6.1">The function computed over the measurements generated by the Clients and the
aggregation parameter selected by the Collector. As defined in <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.2.1-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.7">Aggregation parameter:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.8">
              <p id="section-1.2.1-1.8.1">Parameter selected by the Collector used to prepare a batch of measurements
for aggregation. As defined in <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.2.1-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.9">Aggregator:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.10">
              <p id="section-1.2.1-1.10.1">A server that receives report shares from Clients and validates and aggregates
them with the help of the other Aggregator. As defined in <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.2.1-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.11">Batch:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.12">
              <p id="section-1.2.1-1.12.1">A set of reports (i.e., measurements) that are aggregated into an aggregate
result. As defined in <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.2.1-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.13">Batch bucket:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.14">
              <p id="section-1.2.1-1.14.1">State associated with a given batch allowing the aggregators to perform
incremental aggregation. Depending on the batch mode, there may be many batch
buckets tracking the state of a single batch.<a href="#section-1.2.1-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.15">Batch duration:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.16">
              <p id="section-1.2.1-1.16.1">The time difference between the oldest and newest report in a batch.<a href="#section-1.2.1-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.17">Batch interval:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.18">
              <p id="section-1.2.1-1.18.1">A parameter of a query issued by the Collector that specifies the time range
of the reports in the batch.<a href="#section-1.2.1-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.19">Client:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.20">
              <p id="section-1.2.1-1.20.1">The DAP protocol role identifying a party that generates a measurement and
uploads a report. Note the distinction between a DAP Client (distinguished in
this document by the capital "C") and an HTTP client (distinguished in this
document by the phrase "HTTP client"), as the DAP Client is not the only role
that sometimes acts as an HTTP client.<a href="#section-1.2.1-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.21">Collector:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.22">
              <p id="section-1.2.1-1.22.1">The party that selects the aggregation parameter and computes the aggregate
result.<a href="#section-1.2.1-1.22.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.23">Helper:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.24">
              <p id="section-1.2.1-1.24.1">The Aggregator that executes the aggregation and collection interactions
initiated by the Leader.<a href="#section-1.2.1-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.25">Input share:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.26">
              <p id="section-1.2.1-1.26.1">An Aggregator's share of a measurement. The input shares are output by the
VDAF sharding algorithm. As defined in <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.2.1-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.27">Output share:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.28">
              <p id="section-1.2.1-1.28.1">An Aggregator's share of the refined measurement resulting from successful
execution of VDAF preparation. Many output shares are combined into an
aggregate share during VDAF aggregation. As defined in <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.2.1-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.29">Leader:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.30">
              <p id="section-1.2.1-1.30.1">The Aggregator that coordinates aggregation and collection with the Helper.<a href="#section-1.2.1-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.31">Measurement:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.32">
              <p id="section-1.2.1-1.32.1">A plaintext input emitted by a Client (e.g., a count, summand, or string),
before any encryption or secret sharing is applied. Depending on the VDAF in
use, multiple values may be grouped into a single measurement. As defined in
<span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.2.1-1.32.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.33">Minimum batch size:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.34">
              <p id="section-1.2.1-1.34.1">The minimum number of reports that must be aggregated before a batch can be
collected.<a href="#section-1.2.1-1.34.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.35">Public share:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.36">
              <p id="section-1.2.1-1.36.1">The output of the VDAF sharding algorithm transmitted to each of the
Aggregators. As defined in <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.2.1-1.36.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.37">Report:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.38">
              <p id="section-1.2.1-1.38.1">A cryptographically protected measurement uploaded to the Leader by a Client.
Includes a pair of report shares, one for each Aggregator.<a href="#section-1.2.1-1.38.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-1.2.1-1.39">Report share:</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-1.40">
              <p id="section-1.2.1-1.40.1">An input share encrypted under the HPKE public key of an Aggregator <span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span>.
The report share also includes some associated data used for processing the
report.<a href="#section-1.2.1-1.40.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="representation-language">
<section id="section-1.3">
        <h3 id="name-representation-language">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-representation-language" class="section-name selfRef">Representation Language</a>
        </h3>
<p id="section-1.3-1">With some exceptions, we use the presentation language defined in <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>], <a href="https://rfc-editor.org/rfc/rfc8446#section-3" class="relref">Section 3</a></span> to define messages in the DAP protocol. Encoding and decoding of
these messages as byte strings also follows <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span>. We enumerate the
exceptions below.<a href="#section-1.3-1" class="pilcrow">¶</a></p>
<p id="section-1.3-2"><span><a href="https://rfc-editor.org/rfc/rfc8446#section-3.7" class="relref">Section 3.7</a> of [<a href="#RFC8446" class="cite xref">RFC8446</a>]</span> defines a syntax for structure fields whose values
are constants. In this document, we do not use that notation, but use something
similar to describe specific variants of structures containing enumerated types,
described in <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>], <a href="https://rfc-editor.org/rfc/rfc8446#section-3.8" class="relref">Section 3.8</a></span>.<a href="#section-1.3-2" class="pilcrow">¶</a></p>
<p id="section-1.3-3">For example, suppose we have an enumeration and a structure defined as follows:<a href="#section-1.3-3" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-1.3-4">
<pre>
enum {
  number(0),
  string(1),
  (255)
} ExampleEnum;

struct {
  uint32 always_present;
  ExampleEnum type;
  select (ExampleStruct.type) {
    case number: uint32 a_number;
    case string: opaque a_string&lt;0..10&gt;;
  };
} ExampleStruct;
</pre><a href="#section-1.3-4" class="pilcrow">¶</a>
</div>
<p id="section-1.3-5">Then we describe the specific variant of <code>ExampleStruct</code> where <code>type == number</code>
with a <code>variant</code> block as follows:<a href="#section-1.3-5" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-1.3-6">
<pre>
variant {
  /* Field exists regardless of variant */
  uint32 always_present;
  ExampleEnum type = number;
  /* Only fields included in the `type == number`
     variant is described */
  uint32 a_number;
} ExampleStruct;
</pre><a href="#section-1.3-6" class="pilcrow">¶</a>
</div>
<p id="section-1.3-7">The protocol text accompanying this would explain how implementations should
handle the <code>always_present</code> and <code>a_number</code> fields, but not the <code>type</code> field.
This does not mean that the <code>type</code> field of <code>ExampleStruct</code> can only ever have
value <code>number</code>; it means only that it has this type in this instance.<a href="#section-1.3-7" class="pilcrow">¶</a></p>
<p id="section-1.3-8">This notation can also be used in structures where the enum field does not
affect what fields are or are not present in the structure. For example:<a href="#section-1.3-8" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-1.3-9">
<pre>
enum {
  something(0),
  something_else(1),
  (255)
} FailureReason;

struct {
  FailureReason failure_reason;
  opaque another_field&lt;0..256&gt;;
} FailedOperation;
</pre><a href="#section-1.3-9" class="pilcrow">¶</a>
</div>
<p id="section-1.3-10">The protocol text might include a description like:<a href="#section-1.3-10" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-1.3-11">
<pre>
variant {
  FailureReason failure_reason = something;
  opaque another_field&lt;0..256&gt;;
} FailedOperation;
</pre><a href="#section-1.3-11" class="pilcrow">¶</a>
</div>
<p id="section-1.3-12">Finally, by convention we do not specify the lower length limit of
variable-length vectors. Rather, the lower limit is always set to <code>0</code>.<a href="#section-1.3-12" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="overview">
<section id="section-2">
      <h2 id="name-overview">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
      </h2>
<p id="section-2-1">The protocol is executed by a large set of Clients and a pair of servers
referred to as "Aggregators". Each Client's input to the protocol is its
measurement (or set of measurements, e.g., counts of some user behavior). Given
the input set of measurements <code>meas_1, ..., meas_N</code> held by the Clients, and an
"aggregation parameter" <code>agg_param</code> shared by the Aggregators, the goal of DAP
is to compute <code>agg_result = F(agg_param, meas_1, ..., meas_N)</code> for some
function <code>F</code> while revealing nothing else about the measurements. We call <code>F</code>
the "aggregation function" and <code>agg_result</code> the "aggregate result".<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">DAP is extensible in that it allows for the addition of new cryptographic
schemes that compute different aggregation functions. In particular, the
aggregation function is determined by the Verifiable Distributed Aggregation
Function, or VDAF <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>, used to securely
compute it.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">VDAFs rely on secret sharing to protect the privacy of the measurements. Rather
than sending its measurement in the clear, each Client shards its measurement
into a pair of "input shares" and sends an input share to each of the
Aggregators. This scheme has two important properties:<a href="#section-2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-4.1">
          <p id="section-2-4.1.1">Given only one of the input shares, it is impossible to deduce the plaintext
measurement from which it was generated.<a href="#section-2-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-4.2">
          <p id="section-2-4.2.1">Aggregators can compute secret shares of the aggregate result by aggregating
their shares locally into "aggregate shares", which may later be combined
into the aggregate result.<a href="#section-2-4.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-2-5">Note that some VDAFs allow measurements to be aggregated multiple times, each
time with a different aggregation parameter; however, DAP only allows each
measurement to be aggregated once. Similarly, some VDAFs produce aggregate
values which depend on the order in which the measurementas are aggregated;
however, DAP only supports VDAFs whose aggregation results are independent of
the order in which measurements are aggregated (see <span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-4.4.1" class="relref">Section 4.4.1</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>).<a href="#section-2-5" class="pilcrow">¶</a></p>
<div id="system-architecture">
<section id="section-2.1">
        <h3 id="name-system-architecture">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-system-architecture" class="section-name selfRef">System Architecture</a>
        </h3>
<p id="section-2.1-1">The overall system architecture is shown in <a href="#dap-topology" class="auto internal xref">Figure 1</a>.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<span id="name-dap-architecture-who-sends-"></span><div id="dap-topology">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-2.1-2.1">
<pre>
+--------+
|        |
| Client +----+
|        |    |
+--------+    |
              |
+--------+    |     +------------+         +-----------+
|        |    +-----&gt;            |         |           |
| Client +----------&gt;   Leader   &lt;---------| Collector |
|        |    +-----&gt;            |         |           |
+--------+    |     +------------+         +-----------+
              |           |
+--------+    |           |
|        |    |           |
| Client +----+     +-----V------+
|        |          |            |
+--------+          |   Helper   |
                    |            |
                    +------------+
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-dap-architecture-who-sends-" class="selfRef">DAP architecture (who sends requests to whom).</a>
          </figcaption></figure>
</div>
<p id="section-2.1-3">The main participants in the protocol are as follows:<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.1-4">
          <dt id="section-2.1-4.1">Collector:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-4.2">
            <p id="section-2.1-4.2.1">The party which wants to obtain the aggregate result for the measurements
generated by the Clients. Any given measurement task will have a single
Collector.<a href="#section-2.1-4.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-4.3">Clients:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-4.4">
            <p id="section-2.1-4.4.1">The parties which directly take the measurement(s) and report them to the
DAP protocol. In order to provide reasonable levels of privacy, there must be
a large number of Clients.<a href="#section-2.1-4.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-4.5">Leader:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-4.6">
            <p id="section-2.1-4.6.1">The Aggregator responsible for coordinating the protocol. It receives the
reports from Clients and aggregates them with the assistance of the Helper; and
it orchestrates the process of computing the aggregate result as requested by
the Collector.<a href="#section-2.1-4.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-4.7">Helper:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-4.8">
            <p id="section-2.1-4.8.1">The Aggregator assisting the Leader with the computation. The protocol is
designed so that the Helper is relatively lightweight, with most of the
operational burden borne by the Leader.<a href="#section-2.1-4.8.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-2.1-5">The basic unit of DAP is the "task" which represents a single measurement
process (though potentially aggregating multiple, non-overlapping batches of
measurements). The definition of a task includes the following parameters:<a href="#section-2.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-6.1">
            <p id="section-2.1-6.1.1">The VDAF which determines the type of measurements and the aggregation
function (e.g., mean, standard deviation, etc.).<a href="#section-2.1-6.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-6.2">
            <p id="section-2.1-6.2.1">The identities of the Leader and Helper. These are URLs that implement the
APIs for uploading, aggregation, and collection specified in <a href="#protocol" class="auto internal xref">Section 4</a>.<a href="#section-2.1-6.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-6.3">
            <p id="section-2.1-6.3.1">Cryptographic assets involved in the computation (i.e., key material).<a href="#section-2.1-6.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-6.4">
            <p id="section-2.1-6.4.1">Various parameters used to determine how reports are partitioned into batches
and the size of each batch.<a href="#section-2.1-6.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.1-7">These parameters are distributed to the Clients, Aggregators, and Collector
before the task begins. (Note that not all parameters are distributed to all
parties.) This document does not specify a distribution mechanism, but it is
important that all protocol participants agree on the task's configuration.
Each task is identified by a unique 32-byte ID which is used to refer to it in
protocol messages.<a href="#section-2.1-7" class="pilcrow">¶</a></p>
<p id="section-2.1-8">During the lifetime of a task, each Client records its own measurement
value(s), packages them up into a report, and sends them to the Leader. Each
share is separately encrypted for each Aggregator so that even though they pass
through the Leader, the Leader is unable to see or modify them. Depending on
the task, the Client may only send one report or may send many reports over
time.<a href="#section-2.1-8" class="pilcrow">¶</a></p>
<p id="section-2.1-9">The Leader distributes the shares to the Helper and orchestrates the process of
verifying them (see <a href="#validating-inputs" class="auto internal xref">Section 2.2</a>) and assembling them into a final
aggregate result for the Collector. Depending on the VDAF, it may be possible to
incrementally process each report as it is uploaded, or it may be necessary to
wait until the Collector transmits a collection request before processing can
begin.<a href="#section-2.1-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="validating-inputs">
<section id="section-2.2">
        <h3 id="name-validating-measurements">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-validating-measurements" class="section-name selfRef">Validating Measurements</a>
        </h3>
<p id="section-2.2-1">An essential task of any data collection pipeline is ensuring that the data
being aggregated is "valid". For example, if each measurement is expected to be
an number between <code>0</code> and <code>10</code>, then the aggregator should reject measurements
larger than <code>10</code> or smaller than <code>0</code>. In DAP, input validation is complicated
by the fact that none of the entities other than the Client ever sees that
Client's plaintext measurement. To an Aggregator, a secret share of a valid
measurement is indistinguishable from a secret share of an invalid measurement.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">In DAP, input validation is accomplished by an interactive computation between
the Leader and Helper. At the beginning of this computation, each Aggregator is
in possession of an input share uploaded by the Client. At the end of the
computation, each Aggregator is in possession of either an "output share" that
is ready to be aggregated or an indication that the underlying data is invalid,
in which case the report is rejected.<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2-3">This process is known as "preparation" and is specified by the VDAF itself
(<span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-5.2" class="relref">Section 5.2</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>). To facilitate preparation, the report generated by
the Client include information used by the Aggregators. For example, Prio3
(<span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-7" class="relref">Section 7</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>) includes a zero-knowledge proof of the measurement's
validity (<span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-7.1" class="relref">Section 7.1</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>); the process of verifying this proof
reveals nothing about the underlying measurement beyond its validity.<a href="#section-2.2-3" class="pilcrow">¶</a></p>
<p id="section-2.2-4">The specific properties attested to by the proof vary depending on the
measurement being taken. For instance, to measure the time the user took
performing a given task the proof might demonstrate that the value reported was
within a certain range (e.g., between <code>0</code> and <code>60</code> seconds). By contrast, to
report which of a set of <code>N</code> options the user select, the report might contain
<code>N</code> integers and the proof would demonstrate that <code>N-1</code> were <code>0</code> and the other
was <code>1</code>.<a href="#section-2.2-4" class="pilcrow">¶</a></p>
<p id="section-2.2-5">It is important to recognize that "validity" is distinct from "correctness".
For instance, the user might have spent <code>30</code> seconds on a task but the Client
might report <code>60</code> seconds. This is a problem with any measurement system and
DAP does not attempt to address it; it merely ensures that the data is within
acceptable limits, so the Client could not report <code>10^6</code>  or <code>-20</code> seconds.<a href="#section-2.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="replay-protection">
<section id="section-2.3">
        <h3 id="name-replay-protection">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-replay-protection" class="section-name selfRef">Replay Protection</a>
        </h3>
<p id="section-2.3-1">Another goal of DAP is to mitigate replay attacks in which a report is
aggregated multiple times within a batch or across multiple batches. This would
allow the attacker to learn more information about the underlying measurement
than it would otherwise.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3-2">When a Client generates a report, it also generates a random nonce, called the
"report ID". Each Aggregator is responsible for storing the IDs of reports it
has aggregated for a given task. To check whether a report has been replayed,
it checks whether the report's ID is in the set of stored IDs.<a href="#section-2.3-2" class="pilcrow">¶</a></p>
<p id="section-2.3-3">Note that IDs do not need to be stored indefinitely. The protocol allows
Aggregators to enforce replay only for a sliding time window (e.g., within the
last two weeks of the current time) and reject reports that fall outside of the
replay window. This allows implementation to save resources by forgetting old
report IDs.<a href="#section-2.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="message-transport">
<section id="section-3">
      <h2 id="name-message-transport">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-message-transport" class="section-name selfRef">Message Transport</a>
      </h2>
<p id="section-3-1">Communications between DAP participants are carried over HTTP <span>[<a href="#RFC9110" class="cite xref">RFC9110</a>]</span>. Use
of HTTPS is <span class="bcp14">REQUIRED</span> to provide server authentication and confidentiality.<a href="#section-3-1" class="pilcrow">¶</a></p>
<div id="request-authentication">
<section id="section-3.1">
        <h3 id="name-https-request-authenticatio">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-https-request-authenticatio" class="section-name selfRef">HTTPS Request Authentication</a>
        </h3>
<p id="section-3.1-1">DAP is made up of several interactions in which different subsets of the
protocol's participants interact with each other.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">In those cases where a channel between two participants is tunneled through
another protocol participant, DAP mandates the use of public-key encryption
using <span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span> to ensure that only the intended recipient can see a
message in the clear.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">In other cases, DAP requires HTTP client authentication as well as server
authentication. Any authentication scheme that is composable with HTTP is
allowed. For example:<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-4.1">
            <p id="section-3.1-4.1.1"><span>[<a href="#OAuth2" class="cite xref">OAuth2</a>]</span> credentials are presented in an Authorization HTTP header,
which can be added to any DAP protocol message.<a href="#section-3.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.2">
            <p id="section-3.1-4.2.1">TLS client certificates can be used to authenticate the underlying transport.<a href="#section-3.1-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.3">
            <p id="section-3.1-4.3.1">The <code>DAP-Auth-Token</code> HTTP header described in
<span>[<a href="#I-D.draft-dcook-ppm-dap-interop-test-design-04" class="cite xref">I-D.draft-dcook-ppm-dap-interop-test-design-04</a>]</span>.<a href="#section-3.1-4.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.1-5">This flexibility allows organizations deploying DAP to use existing well-known
HTTP authentication mechanisms that they already support. Discovering what
authentication mechanisms are supported by a DAP participant is outside of this
document's scope.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="errors">
<section id="section-3.2">
        <h3 id="name-errors">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-errors" class="section-name selfRef">Errors</a>
        </h3>
<p id="section-3.2-1">Errors can be reported in DAP both as HTTP status codes and as problem detail
objects <span>[<a href="#RFC9457" class="cite xref">RFC9457</a>]</span> in the response body. For example, if the HTTP client sends
a request using a method not allowed in this document, then the server <span class="bcp14">MAY</span>
return HTTP status 405 Method Not Allowed.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">When the server responds with an error status code, it <span class="bcp14">SHOULD</span> provide additional
information using a problem detail object. If the response body does consist of
a problem detail object, the HTTP status code <span class="bcp14">MUST</span> indicate a client or server
error (the 4xx or 5xx classes, respectively, from <span><a href="https://rfc-editor.org/rfc/rfc9110#section-15" class="relref">Section 15</a> of [<a href="#RFC9110" class="cite xref">RFC9110</a>]</span>).<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">To facilitate automatic response to errors, this document defines the following
standard tokens for use in the "type" field:<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<div id="urn-space-errors">
<table class="center" id="table-1">
          <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Type</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">invalidMessage</td>
              <td class="text-left" rowspan="1" colspan="1">A message received by a protocol participant could not be parsed or otherwise was invalid.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">unrecognizedTask</td>
              <td class="text-left" rowspan="1" colspan="1">A server received a message with an unknown task ID.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">unrecognizedAggregationJob</td>
              <td class="text-left" rowspan="1" colspan="1">A server received a message with an unknown aggregation job ID.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">outdatedConfig</td>
              <td class="text-left" rowspan="1" colspan="1">The message was generated using an outdated configuration.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">reportRejected</td>
              <td class="text-left" rowspan="1" colspan="1">Report could not be processed for an unspecified reason.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">reportTooEarly</td>
              <td class="text-left" rowspan="1" colspan="1">Report could not be processed because its timestamp is too far in the future.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">batchInvalid</td>
              <td class="text-left" rowspan="1" colspan="1">The batch boundary check for Collector's query failed.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">invalidBatchSize</td>
              <td class="text-left" rowspan="1" colspan="1">There are an invalid number of reports in the batch.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">batchQueriedMultipleTimes</td>
              <td class="text-left" rowspan="1" colspan="1">A batch was queried with multiple distinct aggregation parameters.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">batchMismatch</td>
              <td class="text-left" rowspan="1" colspan="1">Aggregators disagree on the report shares that were aggregated in a batch.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">unauthorizedRequest</td>
              <td class="text-left" rowspan="1" colspan="1">Authentication of an HTTP request failed (see <a href="#request-authentication" class="auto internal xref">Section 3.1</a>).</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">stepMismatch</td>
              <td class="text-left" rowspan="1" colspan="1">The Aggregators disagree on the current step of the DAP aggregation protocol.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">batchOverlap</td>
              <td class="text-left" rowspan="1" colspan="1">A request's query includes reports that were previously collected in a different batch.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">unsupportedExtension</td>
              <td class="text-left" rowspan="1" colspan="1">An upload request's extensions list includes an unknown extension.</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-3.2-5">This list is not exhaustive. The server <span class="bcp14">MAY</span> return errors set to a URI other
than those defined above. Servers <span class="bcp14">MUST NOT</span> use the DAP URN namespace for errors
not listed in the appropriate IANA registry (see <a href="#urn-space" class="auto internal xref">Section 9.3</a>). The "detail"
member of the Problem Details document includes additional diagnostic
information.<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<p id="section-3.2-6">When the task ID is known (see <a href="#task-configuration" class="auto internal xref">Section 4.3</a>), the problem document
<span class="bcp14">SHOULD</span> include an additional "taskid" member containing the ID encoded in Base
64 using the URL and filename safe alphabet with no padding defined in
Sections <a href="https://rfc-editor.org/rfc/rfc4648#section-5" class="relref">5</a> and <a href="https://rfc-editor.org/rfc/rfc4648#section-3.2" class="relref">3.2</a> of <span>[<a href="#RFC4648" class="cite xref">RFC4648</a>]</span>.<a href="#section-3.2-6" class="pilcrow">¶</a></p>
<p id="section-3.2-7">In the remainder of this document, the tokens in the table above are used to
refer to error types, rather than the full URNs. For example, an "error of type
'invalidMessage'" refers to an error document with "type" value
"urn:ietf:params:ppm:dap:error:invalidMessage".<a href="#section-3.2-7" class="pilcrow">¶</a></p>
<p id="section-3.2-8">This document uses the verbs "abort" and "alert with [some error message]" to
describe how protocol participants react to various error conditions. This
implies HTTP status code 400 Bad Request unless explicitly specified otherwise.<a href="#section-3.2-8" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="protocol">
<section id="section-4">
      <h2 id="name-protocol-definition">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-protocol-definition" class="section-name selfRef">Protocol Definition</a>
      </h2>
<p id="section-4-1">DAP has three major interactions which need to be defined:<a href="#section-4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.1">
          <p id="section-4-2.1.1">Uploading reports from the Client to the Aggregators, specified in
<a href="#upload-flow" class="auto internal xref">Section 4.6</a><a href="#section-4-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-2.2">
          <p id="section-4-2.2.1">Computing the results for a given measurement task, specified in
<a href="#aggregate-flow" class="auto internal xref">Section 4.7</a><a href="#section-4-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-2.3">
          <p id="section-4-2.3.1">Collecting aggregated results, specified in <a href="#collect-flow" class="auto internal xref">Section 4.8</a><a href="#section-4-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-4-3">Each of these interactions is defined in terms of "resources". In this section
we define these resources and the messages used to act on them.<a href="#section-4-3" class="pilcrow">¶</a></p>
<div id="basic-type-definitions">
<section id="section-4.1">
        <h3 id="name-basic-type-definitions">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-basic-type-definitions" class="section-name selfRef">Basic Type Definitions</a>
        </h3>
<p id="section-4.1-1">The following are some basic type definitions used in other messages:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.1-2">
<pre>
/* ASCII encoded URL. e.g., "https://example.com" */
opaque Url&lt;0..2^16-1&gt;;

uint64 Duration; /* Number of seconds elapsed between two instants */

uint64 Time; /* seconds elapsed since start of UNIX epoch */

/* An interval of time of length duration, where start is included
  and (start + duration) is excluded. */
struct {
  Time start;
  Duration duration;
} Interval;

/* An ID used to uniquely identify a report in the context of a
   DAP task. */
opaque ReportID[16];

/* The various roles in the DAP protocol. */
enum {
  collector(0),
  client(1),
  leader(2),
  helper(3),
  (255)
} Role;

/* Identifier for a server's HPKE configuration */
uint8 HpkeConfigId;

/* An HPKE ciphertext. */
struct {
  HpkeConfigId config_id;    /* config ID */
  opaque enc&lt;0..2^16-1&gt;;     /* encapsulated HPKE key */
  opaque payload&lt;0..2^32-1&gt;; /* ciphertext */
} HpkeCiphertext;

/* Represent a zero-length byte string. */
struct {} Empty;
</pre><a href="#section-4.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1-3">DAP uses the 16-byte <code>ReportID</code> as the nonce parameter for the VDAF <code>shard</code> and
<code>prep_init</code> methods (see <span>[<a href="#VDAF" class="cite xref">VDAF</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-5" class="relref">Section 5</a></span>). Additionally, DAP includes
messages defined in the VDAF specification encoded as opaque byte strings within
various DAP messages. Thus, for a VDAF to be compatible with DAP, it <span class="bcp14">MUST</span>
specify a <code>NONCE_SIZE</code> of 16 bytes, and <span class="bcp14">MUST</span> specify encodings for the following
VDAF types:<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-4.1">
            <p id="section-4.1-4.1.1">PublicShare<a href="#section-4.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-4.2">
            <p id="section-4.1-4.2.1">InputShare<a href="#section-4.1-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-4.3">
            <p id="section-4.1-4.3.1">AggParam<a href="#section-4.1-4.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-4.4">
            <p id="section-4.1-4.4.1">AggShare<a href="#section-4.1-4.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-4.5">
            <p id="section-4.1-4.5.1">PrepShare<a href="#section-4.1-4.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-4.6">
            <p id="section-4.1-4.6.1">PrepMessage<a href="#section-4.1-4.6.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="batch-mode">
<section id="section-4.2">
        <h3 id="name-batch-modes-batches-and-que">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-batch-modes-batches-and-que" class="section-name selfRef">Batch Modes, Batches, and Queries</a>
        </h3>
<p id="section-4.2-1">An aggregate result is computed from a set of reports, called a "batch". The
Collector requests the aggregate result by making a "query"; the Aggregators
use this query to select a batch for aggregation.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">Each measurement task has a preconfigured "batch mode". The batch mode defines
both how reports may be partitioned into batches, as well as how these batches
are addressed and the semantics of the query used for collection.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">This document defines two batch modes:<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-4.1">
            <p id="section-4.2-4.1.1">time-interval (<a href="#time-interval-batch-mode" class="auto internal xref">Section 5.1</a>) in which the query specifies a
time interval, and the batch consists of all reports with a timestamp in that
interval.<a href="#section-4.2-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-4.2">
            <p id="section-4.2-4.2.1">leader-selected (<a href="#leader-selected-batch-mode" class="auto internal xref">Section 5.2</a>) in which the Leader assigns
reports to batches itself, and the Collector's query simply requests the
aggregate result for the "next" batch of reports.<a href="#section-4.2-4.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.2-5">Future documents may define additional batch modes for DAP; see
<a href="#extending-this-doc" class="auto internal xref">Section 10</a>. Implementations are free to implement only a subset of
the available batch modes.<a href="#section-4.2-5" class="pilcrow">¶</a></p>
<p id="section-4.2-6">Batch modes are identified with a single byte in serialized messages, as
follows:<a href="#section-4.2-6" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.2-7">
<pre>
enum {
  reserved(0),
  (255)
} BatchMode;
</pre><a href="#section-4.2-7" class="pilcrow">¶</a>
</div>
<p id="section-4.2-8">The query is issued to the Leader by the Collector during the collection
interaction (<a href="#collect-flow" class="auto internal xref">Section 4.8</a>). In addition, information used to guide batch
selection is conveyed from the Leader to the Helper when initializing
aggregation (<a href="#aggregate-flow" class="auto internal xref">Section 4.7</a>) and finalizing the aggregate shares.<a href="#section-4.2-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="task-configuration">
<section id="section-4.3">
        <h3 id="name-task-configuration">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-task-configuration" class="section-name selfRef">Task Configuration</a>
        </h3>
<p id="section-4.3-1">Prior to the start of execution of the protocol, each participant must agree on
the configuration for each task. A task is uniquely identified by its task ID:<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.3-2">
<pre>
opaque TaskID[32];
</pre><a href="#section-4.3-2" class="pilcrow">¶</a>
</div>
<p id="section-4.3-3">The task ID value <span class="bcp14">MUST</span> be a globally unique sequence of bytes. Each task has
the following parameters associated with it:<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-4.1">
            <p id="section-4.3-4.1.1"><code>leader_aggregator_url</code>: A URL relative to which the Leader's API resources
 can be found.<a href="#section-4.3-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-4.2">
            <p id="section-4.3-4.2.1"><code>helper_aggregator_url</code>: A URL relative to which the Helper's API resources
can be found.<a href="#section-4.3-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-4.3">
            <p id="section-4.3-4.3.1">The batch mode for this task (see <a href="#batch-mode" class="auto internal xref">Section 4.2</a>). This determines how reports
are grouped into batches and the properties that all batches for this task
must have. The party <span class="bcp14">MUST NOT</span> configure the task if it does not recognize the
batch mode.<a href="#section-4.3-4.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-4.4">
            <p id="section-4.3-4.4.1"><code>task_start</code>: The time from which the Clients will start uploading reports to
a task. Aggregators <span class="bcp14">MUST</span> reject reports with timestamps earlier than
<code>task_start</code>.<a href="#section-4.3-4.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-4.5">
            <p id="section-4.3-4.5.1"><code>task_duration</code>: The duration of a task. The task is considered completed
after the end time <code>task_start + task_duration</code>. Aggregators <span class="bcp14">MUST</span> reject
reports that have timestamps later than the end time, and <span class="bcp14">MAY</span> choose to opt
out of the task if <code>task_duration</code> is too long.<a href="#section-4.3-4.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-4.6">
            <p id="section-4.3-4.6.1"><code>time_precision</code>: Used to compute timestamps in DAP. See <a href="#timestamps" class="auto internal xref">Section 4.5</a>.<a href="#section-4.3-4.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-4.7">
            <p id="section-4.3-4.7.1">A unique identifier for the VDAF in use for the task, e.g., one of the VDAFs
defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-10" class="relref">Section 10</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-4.3-4.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-4.8">
            <p id="section-4.3-4.8.1"><code>min_batch_size</code>: The smallest number of reports the batch is allowed to
include. In a sense, this parameter controls the degree of privacy that will
be obtained: the larger the minimum batch size, the higher degree of privacy.
However, this ultimately depends on the application and the nature of the
measurements and aggregation function.<a href="#section-4.3-4.8.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.3-5">Note that the <code>leader_aggregator_url</code> and <code>helper_aggregator_url</code> values may
include arbitrary path components.<a href="#section-4.3-5" class="pilcrow">¶</a></p>
<p id="section-4.3-6">In addition, in order to facilitate the aggregation and collection
interactions, each of the Aggregators is configured with following parameters:<a href="#section-4.3-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-7.1">
            <p id="section-4.3-7.1.1"><code>collector_hpke_config</code>: The <span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span> configuration of the Collector
(described in <a href="#hpke-config" class="auto internal xref">Section 4.6.1</a>); see <a href="#compliance" class="auto internal xref">Section 7</a> for information about the
HPKE configuration algorithms.<a href="#section-4.3-7.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-7.2">
            <p id="section-4.3-7.2.1"><code>vdaf_verify_key</code>: The VDAF verification key shared by the Aggregators. This
key is used in the aggregation interaction (<a href="#aggregate-flow" class="auto internal xref">Section 4.7</a>). The security
requirements are described in <a href="#verification-key" class="auto internal xref">Section 8.6.1</a>.<a href="#section-4.3-7.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.3-8">Finally, the Collector is configured with the HPKE secret key corresponding to
<code>collector_hpke_config</code>.<a href="#section-4.3-8" class="pilcrow">¶</a></p>
<p id="section-4.3-9">A task's parameters are immutable for the lifetime of that task. The only way to
change parameters or to rotate secret values like collector HPKE configuration
or the VDAF verification key is to configure a new task.<a href="#section-4.3-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="resource-uris">
<section id="section-4.4">
        <h3 id="name-resource-uris">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-resource-uris" class="section-name selfRef">Resource URIs</a>
        </h3>
<p id="section-4.4-1">DAP is defined in terms of "resources", such as reports (<a href="#upload-flow" class="auto internal xref">Section 4.6</a>),
aggregation jobs (<a href="#aggregate-flow" class="auto internal xref">Section 4.7</a>), and collection jobs (<a href="#collect-flow" class="auto internal xref">Section 4.8</a>).
Each resource has an associated URI. Resource URIs are specified by a sequence
of string literals and variables. Variables are expanded into strings according
to the following rules:<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-2.1">
            <p id="section-4.4-2.1.1">Variables <code>{leader}</code> and <code>{helper}</code> are replaced with the base URL of the
Leader and Helper respectively (the base URL is defined in
<a href="#task-configuration" class="auto internal xref">Section 4.3</a>).<a href="#section-4.4-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.4-2.2">
            <p id="section-4.4-2.2.1">Variables <code>{task-id}</code>, <code>{aggregation-job-id}</code>, and <code>{collection-job-id}</code> are
replaced with the task ID (<a href="#task-configuration" class="auto internal xref">Section 4.3</a>), aggregation job ID
(<a href="#agg-init" class="auto internal xref">Section 4.7.1</a>), and collection job ID (<a href="#collect-init" class="auto internal xref">Section 4.8.1</a>) respectively. The
value <span class="bcp14">MUST</span> be encoded in its URL-safe, unpadded Base 64 representation as
specified in Sections <a href="https://rfc-editor.org/rfc/rfc4648#section-5" class="relref">5</a> and <a href="https://rfc-editor.org/rfc/rfc4648#section-3.2" class="relref">3.2</a> of <span>[<a href="#RFC4648" class="cite xref">RFC4648</a>]</span>.<a href="#section-4.4-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.4-3">For example, given a helper URL "https://example.com/api/dap", task ID "f0 16 34
47 36 4c cf 1b c0 e3 af fc ca 68 73 c9 c3 81 f6 4a cd f9 02 06 62 f8 3f 46 c0 72
19 e7" and an aggregation job ID "95 ce da 51 e1 a9 75 23 68 b0 d9 61 f9 46 61
28" (32 and 16 byte octet strings, represented in hexadecimal), resource URI
<code>{helper}/tasks/{task-id}/aggregation_jobs/{aggregation-job-id}</code> would be
expanded into
<code>https://example.com/api/dap/tasks/8BY0RzZMzxvA46_8ymhzycOB9krN-QIGYvg_RsByGec/aggregation_jobs/lc7aUeGpdSNosNlh-UZhKA</code>.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="timestamps">
<section id="section-4.5">
        <h3 id="name-timestamps-and-time-interva">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-timestamps-and-time-interva" class="section-name selfRef">Timestamps and Time Intervals</a>
        </h3>
<p id="section-4.5-1">DAP uses timestamps in various places:<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5-2.1">
            <p id="section-4.5-2.1.1">The task configuration includes a validity interval (<a href="#task-configuration" class="auto internal xref">Section 4.3</a>).
The interval includes a timestamp indicating when the interval begins.<a href="#section-4.5-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.5-2.2">
            <p id="section-4.5-2.2.1">The Client's report includes a timestamp indicating when the report was
generated (<a href="#upload-flow" class="auto internal xref">Section 4.6</a>).<a href="#section-4.5-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.5-2.3">
            <p id="section-4.5-2.3.1">The Collector's query may specify a time interval for reports it wants to
aggregate (<a href="#time-interval-batch-mode" class="auto internal xref">Section 5.1</a>).<a href="#section-4.5-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.5-2.4">
            <p id="section-4.5-2.4.1">The result of a collection job indicates the range of timestamps of reports
included in the aggregate result (<a href="#collect-flow" class="auto internal xref">Section 4.8</a>).<a href="#section-4.5-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.5-3">A timestamp has type <code>Time</code> and its value is the number of seconds since the
UNIX epoch. In addition, every timestamp <span class="bcp14">MUST</span> be rounded to the nearest
multiple of <code>time_precision</code> (<a href="#task-configuration" class="auto internal xref">Section 4.3</a>). That is, the value is
computed as<a href="#section-4.5-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5-4">
<pre>
sent_timestamp = timestamp - (timestamp % time_precision)
</pre><a href="#section-4.5-4" class="pilcrow">¶</a>
</div>
<p id="section-4.5-5">A received timestamp is considered to be malformed if <code>received_timestamp %
time_precision &gt; 0</code>.<a href="#section-4.5-5" class="pilcrow">¶</a></p>
<p id="section-4.5-6">A time interval has type <code>Interval</code> and consists of a timestamp indicating the
start of the interval and a duration. The duration has type <code>Duration</code> and its
value is a number of seconds. The duration <span class="bcp14">MUST</span> be a multiple of
<code>time_precision</code>: if <code>duration % time_precision &gt; 0</code>, then the interval is
considered to be malformed.<a href="#section-4.5-6" class="pilcrow">¶</a></p>
<p id="section-4.5-7">Truncating timestamps has multiple purposes. Clients truncate their report
timestamp in order to avoid reducing the size of the anonymity set; see
<a href="#anon-proxy" class="auto internal xref">Section 8.4</a>. It also helps Aggregators manage resources; see
<a href="#sharding-storage" class="auto internal xref">Section 6.4.1</a>.<a href="#section-4.5-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="upload-flow">
<section id="section-4.6">
        <h3 id="name-uploading-reports">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-uploading-reports" class="section-name selfRef">Uploading Reports</a>
        </h3>
<p id="section-4.6-1">Clients periodically upload reports to the Leader. Each report contains two
"report shares", one for the Leader and another for the Helper. The Helper's
report share is transmitted by the Leader during the aggregation interaction
(see <a href="#aggregate-flow" class="auto internal xref">Section 4.7</a>).<a href="#section-4.6-1" class="pilcrow">¶</a></p>
<div id="hpke-config">
<section id="section-4.6.1">
          <h4 id="name-hpke-configuration-request">
<a href="#section-4.6.1" class="section-number selfRef">4.6.1. </a><a href="#name-hpke-configuration-request" class="section-name selfRef">HPKE Configuration Request</a>
          </h4>
<p id="section-4.6.1-1">Before the Client can upload its report to the Leader, it must know the HPKE
configuration of each Aggregator. See <a href="#compliance" class="auto internal xref">Section 7</a> for information on HPKE
algorithm choices.<a href="#section-4.6.1-1" class="pilcrow">¶</a></p>
<p id="section-4.6.1-2">Clients retrieve the HPKE configuration from each Aggregator by sending an HTTP
GET request to <code>{aggregator}/hpke_config</code>.<a href="#section-4.6.1-2" class="pilcrow">¶</a></p>
<p id="section-4.6.1-3">An Aggregator responds to well-formed requests with HTTP status code 200 OK and
an <code>HpkeConfigList</code> value, with media type "application/dap-hpke-config-list".
The <code>HpkeConfigList</code> structure contains one or more <code>HpkeConfig</code> structures in
decreasing order of preference. This allows an Aggregator to support multiple
HPKE configurations simultaneously.<a href="#section-4.6.1-3" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.6.1-4">
<pre>
HpkeConfig HpkeConfigList&lt;0..2^16-1&gt;;

struct {
  HpkeConfigId id;
  HpkeKemId kem_id;
  HpkeKdfId kdf_id;
  HpkeAeadId aead_id;
  HpkePublicKey public_key;
} HpkeConfig;

opaque HpkePublicKey&lt;0..2^16-1&gt;;
uint16 HpkeAeadId; /* Defined in [HPKE] */
uint16 HpkeKemId;  /* Defined in [HPKE] */
uint16 HpkeKdfId;  /* Defined in [HPKE] */
</pre><a href="#section-4.6.1-4" class="pilcrow">¶</a>
</div>
<p id="section-4.6.1-5">Aggregators <span class="bcp14">MUST</span> allocate distinct id values for each <code>HpkeConfig</code> in an
<code>HpkeConfigList</code>.<a href="#section-4.6.1-5" class="pilcrow">¶</a></p>
<p id="section-4.6.1-6">The Client <span class="bcp14">MUST</span> abort if any of the following happen for any HPKE config
request:<a href="#section-4.6.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.1-7.1">
              <p id="section-4.6.1-7.1.1">the GET request did not return a valid HPKE config list;<a href="#section-4.6.1-7.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.6.1-7.2">
              <p id="section-4.6.1-7.2.1">the HPKE config list is empty; or<a href="#section-4.6.1-7.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.6.1-7.3">
              <p id="section-4.6.1-7.3.1">no HPKE config advertised by the Aggregator specifies a supported a KEM, KDF,
or AEAD algorithm triple.<a href="#section-4.6.1-7.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.6.1-8">Aggregators <span class="bcp14">SHOULD</span> use HTTP caching to permit client-side caching of this
resource <span>[<a href="#RFC5861" class="cite xref">RFC5861</a>]</span>. Aggregators <span class="bcp14">SHOULD</span> favor long cache lifetimes to avoid
frequent cache revalidation, e.g., on the order of days. Aggregators can control
this cached lifetime with the Cache-Control header, as in this example:<a href="#section-4.6.1-8" class="pilcrow">¶</a></p>
<div class="lang-http-message sourcecode" id="section-4.6.1-9">
<pre>
  Cache-Control: max-age=86400
</pre><a href="#section-4.6.1-9" class="pilcrow">¶</a>
</div>
<p id="section-4.6.1-10">Servers should choose a <code>max-age</code> value appropriate to the lifetime of their
keys. Clients <span class="bcp14">SHOULD</span> follow the usual HTTP caching <span>[<a href="#RFC9111" class="cite xref">RFC9111</a>]</span> semantics for
HPKE configurations.<a href="#section-4.6.1-10" class="pilcrow">¶</a></p>
<p id="section-4.6.1-11">Note: Long cache lifetimes may result in Clients using stale HPKE
configurations; Aggregators <span class="bcp14">SHOULD</span> continue to accept reports with old keys for
at least twice the cache lifetime in order to avoid rejecting reports.<a href="#section-4.6.1-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="upload-request">
<section id="section-4.6.2">
          <h4 id="name-upload-request">
<a href="#section-4.6.2" class="section-number selfRef">4.6.2. </a><a href="#name-upload-request" class="section-name selfRef">Upload Request</a>
          </h4>
<p id="section-4.6.2-1">Clients upload reports by using an HTTP POST to
<code>{leader}/tasks/{task-id}/reports</code>. The payload is a <code>Report</code>, with media type
"application/dap-report", structured as follows:<a href="#section-4.6.2-1" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.6.2-2">
<pre>
struct {
  ReportID report_id;
  Time time;
  Extension public_extensions&lt;0..2^16-1&gt;;
} ReportMetadata;

struct {
  ReportMetadata report_metadata;
  opaque public_share&lt;0..2^32-1&gt;;
  HpkeCiphertext leader_encrypted_input_share;
  HpkeCiphertext helper_encrypted_input_share;
} Report;
</pre><a href="#section-4.6.2-2" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-4.6.2-3.1">
              <p id="section-4.6.2-3.1.1"><code>report_metadata</code> is public metadata describing the report.<a href="#section-4.6.2-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.2-3.1.2.1">
                  <p id="section-4.6.2-3.1.2.1.1"><code>report_id</code> is used by the Aggregators to ensure the report is not
 replayed (<a href="#agg-flow" class="auto internal xref">Figure 2</a>). The Client <span class="bcp14">MUST</span> generate this by generating 16
 random bytes using a cryptographically secure random number generator.<a href="#section-4.6.2-3.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-4.6.2-3.1.2.2">
                  <p id="section-4.6.2-3.1.2.2.1"><code>time</code> is the time at which the report was generated. The Client <span class="bcp14">MUST</span>
truncate their timestamp as described in <a href="#timestamps" class="auto internal xref">Section 4.5</a>.<a href="#section-4.6.2-3.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-4.6.2-3.1.2.3">
                  <p id="section-4.6.2-3.1.2.3.1"><code>public_extensions</code> is the list of public report extensions; see
<a href="#report-extensions" class="auto internal xref">Section 4.6.3</a>.<a href="#section-4.6.2-3.1.2.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-4.6.2-3.2">
              <p id="section-4.6.2-3.2.1"><code>public_share</code> is the public share output by the VDAF sharding algorithm. Note
that the public share might be empty, depending on the VDAF.<a href="#section-4.6.2-3.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.6.2-3.3">
              <p id="section-4.6.2-3.3.1"><code>leader_encrypted_input_share</code> is the Leader's encrypted input share.<a href="#section-4.6.2-3.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.6.2-3.4">
              <p id="section-4.6.2-3.4.1"><code>helper_encrypted_input_share</code> is the Helper's encrypted input share.<a href="#section-4.6.2-3.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.6.2-4">Aggregators <span class="bcp14">MAY</span> require Clients to authenticate when uploading reports (see
<a href="#client-auth" class="auto internal xref">Section 8.3</a>). If it is used, HTTP client authentication <span class="bcp14">MUST</span> use a scheme
that meets the requirements in <a href="#request-authentication" class="auto internal xref">Section 3.1</a>.<a href="#section-4.6.2-4" class="pilcrow">¶</a></p>
<p id="section-4.6.2-5">The handling of the upload request by the Leader <span class="bcp14">MUST</span> be idempotent as discussed
in <span><a href="https://rfc-editor.org/rfc/rfc9110#section-9.2.2" class="relref">Section 9.2.2</a> of [<a href="#RFC9110" class="cite xref">RFC9110</a>]</span>.<a href="#section-4.6.2-5" class="pilcrow">¶</a></p>
<p id="section-4.6.2-6">To generate a report, the Client begins by sharding its measurement into input
shares and the public share using the VDAF's sharding algorithm (<span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-5.1" class="relref">Section 5.1</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>), using the report ID as the nonce:<a href="#section-4.6.2-6" class="pilcrow">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-4.6.2-7">
<pre>
(public_share, input_shares) = Vdaf.shard(
    "dap-13" || task_id,
    measurement, /* plaintext measurement */
    report_id,   /* nonce */
    rand,        /* randomness for sharding algorithm */
)
</pre><a href="#section-4.6.2-7" class="pilcrow">¶</a>
</div>
<p id="section-4.6.2-8">where <code>task_id</code> is the task ID. The last input comprises the randomness
consumed by the sharding algorithm. The sharding randomness is a random byte
string of length specified by the VDAF. The Client <span class="bcp14">MUST</span> generate this using a
cryptographically secure random number generator.<a href="#section-4.6.2-8" class="pilcrow">¶</a></p>
<p id="section-4.6.2-9">The sharding algorithm will return two input shares. The first input share
returned from the sharding algorithm is considered to be the Leader's input
share, and the second input share is considered to be the Helper's input share.<a href="#section-4.6.2-9" class="pilcrow">¶</a></p>
<p id="section-4.6.2-10">The Client then wraps each input share in the following structure:<a href="#section-4.6.2-10" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.6.2-11">
<pre>
struct {
  Extension private_extensions&lt;0..2^16-1&gt;;
  opaque payload&lt;0..2^32-1&gt;;
} PlaintextInputShare;
</pre><a href="#section-4.6.2-11" class="pilcrow">¶</a>
</div>
<p id="section-4.6.2-12">Field <code>private_extensions</code> is set to the list of private report extensions
intended to be consumed by the given Aggregator. (See <a href="#report-extensions" class="auto internal xref">Section 4.6.3</a>.)
Field <code>payload</code> is set to the Aggregator's input share output by the VDAF
sharding algorithm.<a href="#section-4.6.2-12" class="pilcrow">¶</a></p>
<p id="section-4.6.2-13">Next, the Client encrypts each PlaintextInputShare <code>plaintext_input_share</code> as
follows:<a href="#section-4.6.2-13" class="pilcrow">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-4.6.2-14">
<pre>
enc, payload = SealBase(pk,
  "dap-13 input share" || 0x01 || server_role,
  input_share_aad, plaintext_input_share)
</pre><a href="#section-4.6.2-14" class="pilcrow">¶</a>
</div>
<p id="section-4.6.2-15">where <code>pk</code> is the Aggregator's public key; <code>0x01</code> represents the Role of the
sender (always the Client); <code>server_role</code> is the Role of the intended recipient
(<code>0x02</code> for the Leader and <code>0x03</code> for the Helper), <code>plaintext_input_share</code> is
the Aggregator's PlaintextInputShare, and <code>input_share_aad</code> is an encoded
message of type InputShareAad defined below, constructed from the same values as
the corresponding fields in the report. The <code>SealBase()</code> function is as
specified in <span>[<a href="#HPKE" class="cite xref">HPKE</a>], <a href="https://rfc-editor.org/rfc/rfc9180#section-6.1" class="relref">Section 6.1</a></span> for the ciphersuite indicated by the HPKE
configuration.<a href="#section-4.6.2-15" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.6.2-16">
<pre>
struct {
  TaskID task_id;
  ReportMetadata report_metadata;
  opaque public_share&lt;0..2^32-1&gt;;
} InputShareAad;
</pre><a href="#section-4.6.2-16" class="pilcrow">¶</a>
</div>
<p id="section-4.6.2-17">The Leader responds to well-formed requests with HTTP status code 201
Created. Malformed requests are handled as described in <a href="#errors" class="auto internal xref">Section 3.2</a>.
Clients <span class="bcp14">SHOULD NOT</span> upload the same measurement value in more than one report if
the Leader responds with HTTP status code 201 Created.<a href="#section-4.6.2-17" class="pilcrow">¶</a></p>
<p id="section-4.6.2-18">If the Leader does not recognize the task ID, then it <span class="bcp14">MUST</span> abort with error
<code>unrecognizedTask</code>.<a href="#section-4.6.2-18" class="pilcrow">¶</a></p>
<p id="section-4.6.2-19">The Leader responds to requests whose Leader encrypted input share uses an
out-of-date or unknown <code>HpkeConfig.id</code> value, indicated by
<code>HpkeCiphertext.config_id</code>, with error of type 'outdatedConfig'. When the Client
receives an 'outdatedConfig' error, it <span class="bcp14">SHOULD</span> invalidate any cached
HpkeConfigList and retry with a freshly generated Report. If this retried upload
does not succeed, the Client <span class="bcp14">SHOULD</span> abort and discontinue retrying.<a href="#section-4.6.2-19" class="pilcrow">¶</a></p>
<p id="section-4.6.2-20">If a report's ID matches that of a previously uploaded report, the Leader <span class="bcp14">MUST</span>
ignore it. In addition, it <span class="bcp14">MAY</span> alert the Client with error <code>reportRejected</code>.<a href="#section-4.6.2-20" class="pilcrow">¶</a></p>
<p id="section-4.6.2-21">The Leader <span class="bcp14">MUST</span> ignore any report pertaining to a batch that has already been
collected (see <a href="#input-share-validation" class="auto internal xref">Section 4.7.1.4</a> for details). Otherwise, comparing
the aggregate result to the previous aggregate result may result in a privacy
violation. Note that this is also enforced by the Helper during the aggregation
interaction. The Leader <span class="bcp14">MAY</span> also abort the upload interaction and alert the
Client with error <code>reportRejected</code>.<a href="#section-4.6.2-21" class="pilcrow">¶</a></p>
<p id="section-4.6.2-22">The Leader <span class="bcp14">MUST</span> ignore any report whose timestamp is before the task's
<code>task_start</code>, or is past the end time <code>task_start + task_duration</code>. When it does
so, it <span class="bcp14">SHOULD</span> also abort the upload interaction and alert the Client with error
<code>reportRejected</code>. Clients <span class="bcp14">MUST NOT</span> upload a report if its timestamp would be
earlier than <code>task_start</code> or later than <code>task_start + task_duration</code>.<a href="#section-4.6.2-22" class="pilcrow">¶</a></p>
<p id="section-4.6.2-23">The Leader may need to buffer reports while waiting to aggregate them (e.g.,
while waiting for an aggregation parameter from the Collector; see
<a href="#collect-flow" class="auto internal xref">Section 4.8</a>). The Leader <span class="bcp14">SHOULD NOT</span> accept reports whose timestamps are too
far in the future. Implementors <span class="bcp14">MAY</span> provide for some small leeway, usually no
more than a few minutes, to account for clock skew. If the Leader rejects a
report for this reason, it <span class="bcp14">SHOULD</span> abort the upload interaction and alert the
Client with error <code>reportTooEarly</code>. In this situation, the Client <span class="bcp14">MAY</span> re-upload
the report later on.<a href="#section-4.6.2-23" class="pilcrow">¶</a></p>
<p id="section-4.6.2-24">If the report contains an unrecognized public report extension, or if the
Leader's input share contains an unrecognized private report extension, then the
Leader <span class="bcp14">MAY</span> abort the upload request with error "unsupportedExtension." If the
Leader does abort for this reason, it <span class="bcp14">MAY</span> indicate the unsupported extensions in
the resulting problem document via an extension member (<span><a href="https://rfc-editor.org/rfc/rfc9457#section-3.2" class="relref">Section 3.2</a> of [<a href="#RFC9457" class="cite xref">RFC9457</a>]</span>) "unsupported_extensions" on the problem document; this member <span class="bcp14">MUST</span>
contain an array of numeric values indicating the extension code points which
were not recognized. For example, if the report upload contained two unsupported
extensions with code points <code>23</code> and <code>42</code>, the "unsupported_extensions" member
would contain the value <code>[23, 42]</code>.<a href="#section-4.6.2-24" class="pilcrow">¶</a></p>
<p id="section-4.6.2-25">If the same extension type appears more than once among the public extensions
and the private extensions in the Leader's input share, then the Leader <span class="bcp14">MAY</span>
abort the upload request with error "invalidMessage".<a href="#section-4.6.2-25" class="pilcrow">¶</a></p>
<p id="section-4.6.2-26">(Note that validation of extensions is not mandatory here because it requires
the Leader to decrypt its input share. The Leader also cannot validate the
Helper's extensions because it cannot decrypt the Helper's input share.
Mandatory validation of extensions will occur during aggregation.)<a href="#section-4.6.2-26" class="pilcrow">¶</a></p>
</section>
</div>
<div id="report-extensions">
<section id="section-4.6.3">
          <h4 id="name-report-extensions">
<a href="#section-4.6.3" class="section-number selfRef">4.6.3. </a><a href="#name-report-extensions" class="section-name selfRef">Report Extensions</a>
          </h4>
<p id="section-4.6.3-1">Each <code>ReportMetadata</code> contains a list of extensions public to both aggregators,
and each <code>PlaintextInputShare</code> contains a list of extensions private to the
relevant Aggregator. Clients use these extensions to convey additional
information to the Aggregators. Some extensions might be intended for both
Aggregators; others may only be intended for a specific Aggregator. (For
example, a DAP deployment might use some out-of-band mechanism for an Aggregator
to verify that reports come from authenticated Clients. It will likely be useful
to bind the extension to the input share via HPKE encryption.)<a href="#section-4.6.3-1" class="pilcrow">¶</a></p>
<p id="section-4.6.3-2">Each extension is a tag-length encoded value of the following form:<a href="#section-4.6.3-2" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.6.3-3">
<pre>
struct {
  ExtensionType extension_type;
  opaque extension_data&lt;0..2^16-1&gt;;
} Extension;

enum {
  reserved(0),
  (65535)
} ExtensionType;
</pre><a href="#section-4.6.3-3" class="pilcrow">¶</a>
</div>
<p id="section-4.6.3-4">Field "extension_type" indicates the type of extension, and "extension_data"
contains information specific to the extension.<a href="#section-4.6.3-4" class="pilcrow">¶</a></p>
<p id="section-4.6.3-5">Extensions are mandatory-to-implement: If an Aggregator receives a report
containing an extension it does not recognize, then it <span class="bcp14">MUST</span> reject the report.
(See <a href="#input-share-validation" class="auto internal xref">Section 4.7.1.4</a> for details.)<a href="#section-4.6.3-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="aggregate-flow">
<section id="section-4.7">
        <h3 id="name-verifying-and-aggregating-r">
<a href="#section-4.7" class="section-number selfRef">4.7. </a><a href="#name-verifying-and-aggregating-r" class="section-name selfRef">Verifying and Aggregating Reports</a>
        </h3>
<p id="section-4.7-1">Once a set of Clients have uploaded their reports to the Leader, the Leader can
begin the process of validating and aggregating them with the Helper. To enable
the system to handle large batches of reports, this process can be parallelized
across many "aggregation jobs" in which small subsets of the reports are
processed independently. Each aggregation job is associated with exactly one DAP
task, but a task can have many aggregation jobs.<a href="#section-4.7-1" class="pilcrow">¶</a></p>
<p id="section-4.7-2">The primary objective of an aggregation job is to run the VDAF preparation
process described in <span>[<a href="#VDAF" class="cite xref">VDAF</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-5.2" class="relref">Section 5.2</a></span> for each report in the job.
Preparation has two purposes:<a href="#section-4.7-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.7-3">
<li id="section-4.7-3.1">
            <p id="section-4.7-3.1.1">To "refine" the input shares into "output shares" that have the desired
aggregatable form. For some VDAFs, like Prio3, the mapping from input to
output shares is a fixed operation depending only on the input share, but in
general the mapping involves an aggregation parameter chosen by the
Collector.<a href="#section-4.7-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.7-3.2">
            <p id="section-4.7-3.2.1">To verify that the output shares, when combined, correspond to a valid,
refined measurement, where validity is determined by the VDAF itself. For
example, the Prio3Sum variant of Prio3 (<span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-7.4.2" class="relref">Section 7.4.2</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>) requires
that the output shares sum up to an integer in a specific range, while the
Prio3Histogram variant (<span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-7.4.4" class="relref">Section 7.4.4</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>) proves that output shares
sum up to a one-hot vector representing a contribution to a single bucket of
the histogram.<a href="#section-4.7-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-4.7-4">In general, refinement and verification are not distinct computations, since for
some VDAFs, verification may only be achieved implicitly as a result of the
refinement process. We instead think of these as properties of the output shares
themselves: if preparation succeeds, then the resulting output shares are
guaranteed to combine into a valid, refined measurement.<a href="#section-4.7-4" class="pilcrow">¶</a></p>
<p id="section-4.7-5">VDAF preparation is mapped onto an aggregation job as illustrated in
<a href="#agg-flow" class="auto internal xref">Figure 2</a>. The protocol is comprised of a sequence of HTTP requests from the
Leader to the Helper, the first of which includes the aggregation parameter, the
Helper's report share for each report in the job, and for each report the
initialization step for preparation. The Helper's response, along with each
subsequent request and response, carries the remaining messages exchanged during
preparation.<a href="#section-4.7-5" class="pilcrow">¶</a></p>
<span id="name-overview-of-the-dap-aggrega"></span><div id="agg-flow">
<figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-4.7-6.1">
<pre>
  report, agg_param
   |
   v
+--------+                                         +--------+
| Leader |                                         | Helper |
+--------+                                         +--------+
   | AggregationJobInitReq:                              |
   |   agg_param, prep_init                              |
   |----------------------------------------------------&gt;|
   |                                 AggregationJobResp: |
   |                               prep_resp(continue)   |
   |&lt;----------------------------------------------------|
   | AggregationJobContinueReq:                          |
   |   prep_continue                                     |
   |----------------------------------------------------&gt;|
   |                                 AggregationJobResp: |
   |                               prep_resp(continue)   |
   |&lt;----------------------------------------------------|
   |                                                     |
  ...                                                   ...
   |                                                     |
   | AggregationJobContinueReq:                          |
   |   prep_continue                                     |
   |----------------------------------------------------&gt;|
   |                                 AggregationJobResp: |
   |                      prep_resp(continue|finished)   |
   |&lt;----------------------------------------------------|
   |                                                     |
   v                                                     v
  leader_out_share                         helper_out_share
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-overview-of-the-dap-aggrega" class="selfRef">Overview of the DAP aggregation interaction.</a>
          </figcaption></figure>
</div>
<p id="section-4.7-7">The number of steps, and the type of the responses, depends on the VDAF. The
message structures and processing rules are specified in the following
subsections.<a href="#section-4.7-7" class="pilcrow">¶</a></p>
<p id="section-4.7-8">Normally, the Helper processes each step synchronously, meaning it computes
each step of the computation before producing a response to the Leader's HTTP
request. The Helper can optionally instead process each step asynchronously,
meaning the Helper responds to requests immediately, while deferring processing
to a background worker. To continue, the Leader polls the Helper until it
responds with the next step. This choice allows a Helper implementation
flexibility in choosing a request model that best supports its architecture
and use case. For instance, resource-intensive use cases, such as replay checks
across vast numbers of reports and preparation of large histograms, may be
better suited for the asynchronous model. For use cases where datastore
performance is a concern, the synchronous model may be better suited.<a href="#section-4.7-8" class="pilcrow">¶</a></p>
<p id="section-4.7-9">In general, aggregation cannot begin until the Collector specifies a query and
an aggregation parameter. However, depending on the VDAF and batch mode in use,
it is often possible to begin aggregation as soon as reports arrive. For
example, Prio3 has just one valid aggregation parameter (the empty string), and
thus allows for eager aggregation; and both the time-interval
(<a href="#time-interval-batch-mode" class="auto internal xref">Section 5.1</a>) and leader-selected
(<a href="#leader-selected-batch-mode" class="auto internal xref">Section 5.2</a>) batch modes defined in this document allow for
eager aggregation.<a href="#section-4.7-9" class="pilcrow">¶</a></p>
<p id="section-4.7-10">An aggregation job can be thought of as having three phases, which are
described in the remaining subsections:<a href="#section-4.7-10" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.7-11.1">
            <p id="section-4.7-11.1.1">Initialization: Begin the aggregation flow by disseminating report shares and
initializing the VDAF prep state for each report.<a href="#section-4.7-11.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.7-11.2">
            <p id="section-4.7-11.2.1">Continuation: Continue the aggregation flow by exchanging prep shares and
messages until preparation completes or an error occurs.<a href="#section-4.7-11.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.7-11.3">
            <p id="section-4.7-11.3.1">Completion: Finish the aggregation flow, yielding an output share
corresponding to each report share in the aggregation job, and update the
appropriate aggregate shares with these output shares.<a href="#section-4.7-11.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.7-12">After an aggregation job is completed, each Aggregator updates running-total
aggregate shares and other values for each "batch bucket" associated with a
recovered output share, as described in <a href="#batch-buckets" class="auto internal xref">Section 4.7.2.3</a>. These values are
stored until the batch is collected as described in <a href="#collect-flow" class="auto internal xref">Section 4.8</a>.<a href="#section-4.7-12" class="pilcrow">¶</a></p>
<p id="section-4.7-13">Apart from VDAF preparation, another important task of the aggregation
interaction is to provide replay protection (<a href="#replay-protection" class="auto internal xref">Section 2.3</a>). Along with
the output shares, each Aggregator records the IDs of all reports it is has
aggregated for a given task: before committing to an output share, it checks
whether the corresponding report ID is in the set of stored IDs.<a href="#section-4.7-13" class="pilcrow">¶</a></p>
<div id="agg-init">
<section id="section-4.7.1">
          <h4 id="name-aggregate-initialization">
<a href="#section-4.7.1" class="section-number selfRef">4.7.1. </a><a href="#name-aggregate-initialization" class="section-name selfRef">Aggregate Initialization</a>
          </h4>
<p id="section-4.7.1-1">The Leader begins an aggregation job by choosing a set of candidate reports that
pertain to the same DAP task and a job ID which <span class="bcp14">MUST</span> be unique within the scope
of the task. The job ID is a 16-byte value, structured as follows:<a href="#section-4.7.1-1" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.7.1-2">
<pre>
opaque AggregationJobID[16];
</pre><a href="#section-4.7.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.7.1-3">The Leader can run this process for many sets of candidate reports in parallel
as needed. After choosing a set of candidates, the Leader begins aggregation by
splitting each report into report shares, one for each Aggregator. The Leader
and Helper then run the aggregate initialization flow to accomplish two tasks:<a href="#section-4.7.1-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.7.1-4">
<li id="section-4.7.1-4.1">
              <p id="section-4.7.1-4.1.1">Recover and determine which input report shares are valid.<a href="#section-4.7.1-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-4.7.1-4.2">
              <p id="section-4.7.1-4.2.1">For each valid report share, initialize the VDAF preparation process (see
<span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-5.2" class="relref">Section 5.2</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>).<a href="#section-4.7.1-4.2.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-4.7.1-5">The Leader and Helper initialization behavior is detailed below.<a href="#section-4.7.1-5" class="pilcrow">¶</a></p>
<p id="section-4.7.1-6">Implementation note: the Leader will generally want to associate each report
with a single aggregation job, as otherwise the duplicated reports will
eventually be discarded as a replay. However, it is likely not appropriate to
directly use the used-ID storage used for replay protection to determine which
reports can be added to an aggregation job: certain errors (e.g.
<code>report_too_early</code>) allow the report to be added to another aggregation job in
the future; but storage into the used-ID storage is permanent.<a href="#section-4.7.1-6" class="pilcrow">¶</a></p>
<div id="leader-init">
<section id="section-4.7.1.1">
            <h5 id="name-leader-initialization">
<a href="#section-4.7.1.1" class="section-number selfRef">4.7.1.1. </a><a href="#name-leader-initialization" class="section-name selfRef">Leader Initialization</a>
            </h5>
<p id="section-4.7.1.1-1">The Leader begins the aggregate initialization by sampling a fresh
AggregationJobID.<a href="#section-4.7.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.7.1.1-2">Next, for each report in the candidate set, it checks if the report ID
corresponds to a report ID it has previously stored for this task. If so, it
marks the report as invalid and removes it from the candidate set.<a href="#section-4.7.1.1-2" class="pilcrow">¶</a></p>
<p id="section-4.7.1.1-3">Next, the Leader decrypts each of its report shares as described in
<a href="#input-share-decryption" class="auto internal xref">Section 4.7.1.3</a>, then checks input share validity as described in
<a href="#input-share-validation" class="auto internal xref">Section 4.7.1.4</a>. If either step invalidates the report, the Leader
rejects the report and removes it from the set of candidate reports.<a href="#section-4.7.1.1-3" class="pilcrow">¶</a></p>
<p id="section-4.7.1.1-4">Next, for each report the Leader executes the following procedure:<a href="#section-4.7.1.1-4" class="pilcrow">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-4.7.1.1-5">
<pre>
(state, outbound) = Vdaf.ping_pong_leader_init(
    vdaf_verify_key,
    "dap-13" || task_id,
    agg_param,
    report_id,
    public_share,
    plaintext_input_share.payload)
</pre><a href="#section-4.7.1.1-5" class="pilcrow">¶</a>
</div>
<p id="section-4.7.1.1-6">where:<a href="#section-4.7.1.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.7.1.1-7.1">
                <p id="section-4.7.1.1-7.1.1"><code>vdaf_verify_key</code> is the VDAF verification key for the task<a href="#section-4.7.1.1-7.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.1.1-7.2">
                <p id="section-4.7.1.1-7.2.1"><code>task_id</code> is the task ID<a href="#section-4.7.1.1-7.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.1.1-7.3">
                <p id="section-4.7.1.1-7.3.1"><code>agg_param</code> is the VDAF aggregation parameter provided by the Collector (see
<a href="#collect-flow" class="auto internal xref">Section 4.8</a>)<a href="#section-4.7.1.1-7.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.1.1-7.4">
                <p id="section-4.7.1.1-7.4.1"><code>report_id</code> is the report ID, used as the nonce for VDAF sharding<a href="#section-4.7.1.1-7.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.1.1-7.5">
                <p id="section-4.7.1.1-7.5.1"><code>public_share</code> is the report's public share<a href="#section-4.7.1.1-7.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.1.1-7.6">
                <p id="section-4.7.1.1-7.6.1"><code>plaintext_input_share</code> is the Leader's <code>PlaintextInputShare</code><a href="#section-4.7.1.1-7.6.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-4.7.1.1-8">The methods are defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-5.8" class="relref">Section 5.8</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>. This process determines
the initial per-report <code>state</code>, as well as the initial <code>outbound</code> message to
send to the Helper. If <code>state</code> is of type <code>Rejected</code>, then the report is
rejected and removed from the set of candidate reports, and no message is sent
to the Helper.<a href="#section-4.7.1.1-8" class="pilcrow">¶</a></p>
<p id="section-4.7.1.1-9">If <code>state</code> is of type <code>Continued</code>, then the Leader constructs a <code>PrepareInit</code>
message structured as follows:<a href="#section-4.7.1.1-9" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.7.1.1-10">
<pre>
struct {
  ReportMetadata report_metadata;
  opaque public_share&lt;0..2^32-1&gt;;
  HpkeCiphertext encrypted_input_share;
} ReportShare;

struct {
  ReportShare report_share;
  opaque payload&lt;0..2^32-1&gt;;
} PrepareInit;
</pre><a href="#section-4.7.1.1-10" class="pilcrow">¶</a>
</div>
<p id="section-4.7.1.1-11">Each of these messages is constructed as follows:<a href="#section-4.7.1.1-11" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.7.1.1-12.1">
                <p id="section-4.7.1.1-12.1.1"><code>report_share.report_metadata</code> is the report's metadata.<a href="#section-4.7.1.1-12.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.1.1-12.2">
                <p id="section-4.7.1.1-12.2.1"><code>report_share.public_share</code> is the report's public share.<a href="#section-4.7.1.1-12.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.1.1-12.3">
                <p id="section-4.7.1.1-12.3.1"><code>report_share.encrypted_input_share</code> is the Helper's encrypted input share.<a href="#section-4.7.1.1-12.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.1.1-12.4">
                <p id="section-4.7.1.1-12.4.1"><code>payload</code> is set to the <code>outbound</code> message computed by the previous step.<a href="#section-4.7.1.1-12.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-4.7.1.1-13">It is not possible for <code>state</code> to be of type <code>Finished</code> during Leader
initialization.<a href="#section-4.7.1.1-13" class="pilcrow">¶</a></p>
<p id="section-4.7.1.1-14">Once all the report shares have been initialized, the Leader creates an
<code>AggregationJobInitReq</code> message structured as follows:<a href="#section-4.7.1.1-14" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.7.1.1-15">
<pre>
opaque BatchID[32];

struct {
  BatchMode batch_mode;
  opaque config&lt;0..2^16-1&gt;;
} PartialBatchSelector;

struct {
  opaque agg_param&lt;0..2^32-1&gt;;
  PartialBatchSelector part_batch_selector;
  PrepareInit prepare_inits&lt;0..2^32-1&gt;;
} AggregationJobInitReq;
</pre><a href="#section-4.7.1.1-15" class="pilcrow">¶</a>
</div>
<p id="section-4.7.1.1-16">This message consists of:<a href="#section-4.7.1.1-16" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.7.1.1-17.1">
                <p id="section-4.7.1.1-17.1.1"><code>agg_param</code>: The VDAF aggregation parameter.<a href="#section-4.7.1.1-17.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.1.1-17.2">
                <p id="section-4.7.1.1-17.2.1"><code>part_batch_selector</code>: The "partial batch selector" used by the Aggregators
to determine how to aggregate each report. Its contents depends on the
indicated batch mode: for time-interval mode, the <code>config</code> field is empty
(<a href="#time-interval-batch-mode" class="auto internal xref">Section 5.1</a>); for leader-selected tasks, the Leader
specifies a "batch ID" that determines the batch to which each report for
this aggregation job belongs (<a href="#leader-selected-batch-mode" class="auto internal xref">Section 5.2</a>).<a href="#section-4.7.1.1-17.2.1" class="pilcrow">¶</a></p>
<p id="section-4.7.1.1-17.2.2">
Documents that define batch modes <span class="bcp14">MUST</span> specify the content this field; see
<a href="#extending-this-doc" class="auto internal xref">Section 10</a> for details.<a href="#section-4.7.1.1-17.2.2" class="pilcrow">¶</a></p>
<p id="section-4.7.1.1-17.2.3">
The indicated batch mode <span class="bcp14">MUST</span> match the task's batch mode. Otherwise, the
Helper <span class="bcp14">MUST</span> abort with error <code>invalidMessage</code>.<a href="#section-4.7.1.1-17.2.3" class="pilcrow">¶</a></p>
<p id="section-4.7.1.1-17.2.4">
This field is called the "partial" batch selector because, depending on the
batch mode, it may not determine a batch. In particular, if the batch mode is
<code>time_interval</code>, the batch is not determined until the Collector's query is
issued (see <a href="#batch-mode" class="auto internal xref">Section 4.2</a>).<a href="#section-4.7.1.1-17.2.4" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.1.1-17.3">
                <p id="section-4.7.1.1-17.3.1"><code>prepare_inits</code>: the sequence of <code>PrepareInit</code> messages constructed in the
previous step.<a href="#section-4.7.1.1-17.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-4.7.1.1-18">Finally, the Leader sends an HTTP PUT request to
<code>{helper}/tasks/{task-id}/aggregation_jobs/{aggregation-job-id}</code> with a media
type of "application/dap-aggregation-job-init-req" and a body containing the
<code>AggregationJobInitReq</code>.<a href="#section-4.7.1.1-18" class="pilcrow">¶</a></p>
<p id="section-4.7.1.1-19">The Leader <span class="bcp14">MUST</span> authenticate its requests to the Helper using a scheme that
meets the requirements in <a href="#request-authentication" class="auto internal xref">Section 3.1</a>.<a href="#section-4.7.1.1-19" class="pilcrow">¶</a></p>
<p id="section-4.7.1.1-20">The Helper responds with HTTP status 201 Created with a body containing an
<code>AggregationJobResp</code> (see <a href="#aggregation-helper-init" class="auto internal xref">Section 4.7.1.2</a>). If the <code>status</code> field
is <code>ready</code>, the Leader proceeds onward. Otherwise, if the <code>status</code> field is
<code>processing</code>, the Leader polls the aggregation job by sending GET requests to
the URI indicated in the Location header field, until the <code>status</code> is <code>ready</code>.
The Helper's response when processing <span class="bcp14">SHOULD</span> include a Retry-After header to
suggest a polling interval to the Leader.<a href="#section-4.7.1.1-20" class="pilcrow">¶</a></p>
<p id="section-4.7.1.1-21">The <code>AggregationJobResp.prepare_resps</code> field must include exactly the same
report IDs in the same order as the Leader's <code>AggregationJobInitReq</code>. Otherwise,
the Leader <span class="bcp14">MUST</span> abort the aggregation job.<a href="#section-4.7.1.1-21" class="pilcrow">¶</a></p>
<p id="section-4.7.1.1-22">Otherwise, the Leader proceeds as follows with each report:<a href="#section-4.7.1.1-22" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.7.1.1-23">
<li id="section-4.7.1.1-23.1">
                <p id="section-4.7.1.1-23.1.1">If the inbound prep response has type "continue", then the Leader computes<a href="#section-4.7.1.1-23.1.1" class="pilcrow">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-4.7.1.1-23.1.2">
<pre>
(state, outbound) = Vdaf.ping_pong_leader_continued(
    "dap-13" || task_id,
    agg_param,
    prev_state,
    inbound,
)
</pre><a href="#section-4.7.1.1-23.1.2" class="pilcrow">¶</a>
</div>
<p id="section-4.7.1.1-23.1.3">
where:<a href="#section-4.7.1.1-23.1.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.7.1.1-23.1.4.1">
                    <p id="section-4.7.1.1-23.1.4.1.1"><code>task_id</code> is the task ID<a href="#section-4.7.1.1-23.1.4.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-4.7.1.1-23.1.4.2">
                    <p id="section-4.7.1.1-23.1.4.2.1"><code>agg_param</code> is the VDAF aggregation parameter provided by the Collector (see
<a href="#collect-flow" class="auto internal xref">Section 4.8</a>)<a href="#section-4.7.1.1-23.1.4.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-4.7.1.1-23.1.4.3">
                    <p id="section-4.7.1.1-23.1.4.3.1"><code>prev_state</code> is the state computed earlier by calling
<code>Vdaf.ping_pong_leader_init</code> or <code>Vdaf.ping_pong_leader_continued</code><a href="#section-4.7.1.1-23.1.4.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-4.7.1.1-23.1.4.4">
                    <p id="section-4.7.1.1-23.1.4.4.1"><code>inbound</code> is the message payload in the <code>PrepareResp</code><a href="#section-4.7.1.1-23.1.4.4.1" class="pilcrow">¶</a></p>
</li>
                </ul>
<p id="section-4.7.1.1-23.1.5">
If <code>outbound != None</code>, then the Leader stores <code>state</code> and <code>outbound</code> and
proceeds to <a href="#aggregation-leader-continuation" class="auto internal xref">Section 4.7.2.1</a>. If <code>outbound == None</code>, then
the preparation process is complete: either <code>state == Rejected()</code>, in which
case the Leader rejects the report and removes it from the candidate set; or
<code>state == Finished(out_share)</code>, in which case preparation is complete and the
Leader updates the relevant batch bucket with <code>out_share</code> as described in
<a href="#batch-buckets" class="auto internal xref">Section 4.7.2.3</a>.<a href="#section-4.7.1.1-23.1.5" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.7.1.1-23.2">
                <p id="section-4.7.1.1-23.2.1">Else if the type is "reject", then the Leader rejects the report and removes
it from the candidate set. The Leader <span class="bcp14">MUST NOT</span> include the report in a
subsequent aggregation job, unless the error is <code>report_too_early</code>, in which
case the Leader <span class="bcp14">MAY</span> include the report in a subsequent aggregation job.<a href="#section-4.7.1.1-23.2.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.7.1.1-23.3">
                <p id="section-4.7.1.1-23.3.1">Else the type is invalid, in which case the Leader <span class="bcp14">MUST</span> abort the
aggregation job.<a href="#section-4.7.1.1-23.3.1" class="pilcrow">¶</a></p>
</li>
            </ol>
<p id="section-4.7.1.1-24">When the Leader updates a batch bucket based on <code>out_share</code>, it <span class="bcp14">MUST</span> also store
the report ID for replay protection.<a href="#section-4.7.1.1-24" class="pilcrow">¶</a></p>
<p id="section-4.7.1.1-25">(Note: Since VDAF preparation completes in a constant number of rounds, it will
never be the case that some reports are completed and others are not.)<a href="#section-4.7.1.1-25" class="pilcrow">¶</a></p>
<p id="section-4.7.1.1-26">If the Leader fails to process the response from the Helper, for example because
of a transient failure such as a network connection failure or process crash,
the Leader <span class="bcp14">SHOULD</span> re-send the original request unmodified in order to attempt
recovery (see <a href="#aggregation-step-skew-recovery" class="auto internal xref">Section 4.7.2.4</a>).<a href="#section-4.7.1.1-26" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aggregation-helper-init">
<section id="section-4.7.1.2">
            <h5 id="name-helper-initialization">
<a href="#section-4.7.1.2" class="section-number selfRef">4.7.1.2. </a><a href="#name-helper-initialization" class="section-name selfRef">Helper Initialization</a>
            </h5>
<p id="section-4.7.1.2-1">The Helper begins an aggregation job when it receives an <code>AggregationJobInitReq</code>
message from the Leader. For each <code>PrepareInit</code> conveyed by this message, the
Helper attempts to initialize VDAF preparation (see <span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-5.1" class="relref">Section 5.1</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>)
just as the Leader does. If successful, it includes the result in its response
that the Leader will use to continue preparing the report.<a href="#section-4.7.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.7.1.2-2">Upon receipt of an <code>AggregationJobInitReq</code>, the Helper checks if it recognizes
the task ID. If not, then it <span class="bcp14">MUST</span> abort with error <code>unrecognizedTask</code>.<a href="#section-4.7.1.2-2" class="pilcrow">¶</a></p>
<p id="section-4.7.1.2-3">Next, the Helper checks that the report IDs in
<code>AggregationJobInitReq.prepare_inits</code> are all distinct. If two preparation
initialization messages have the same report ID, then the Helper <span class="bcp14">MUST</span> abort with
error <code>invalidMessage</code>.<a href="#section-4.7.1.2-3" class="pilcrow">¶</a></p>
<p id="section-4.7.1.2-4">To process the aggregation job, the Helper computes an outbound prepare step
for each report share. This includes the following structures:<a href="#section-4.7.1.2-4" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.7.1.2-5">
<pre>
enum {
  continue(0),
  finished(1)
  reject(2),
  (255)
} PrepareRespState;

enum {
  reserved(0),
  batch_collected(1),
  report_replayed(2),
  report_dropped(3),
  hpke_unknown_config_id(4),
  hpke_decrypt_error(5),
  vdaf_prep_error(6),
  task_expired(7),
  invalid_message(8),
  report_too_early(9),
  task_not_started(10),
  (255)
} ReportError;

struct {
  ReportID report_id;
  PrepareRespState prepare_resp_state;
  select (PrepareResp.prepare_resp_state) {
    case continue: opaque payload&lt;0..2^32-1&gt;;
    case finished: Empty;
    case reject:   ReportError report_error;
  };
} PrepareResp;
</pre><a href="#section-4.7.1.2-5" class="pilcrow">¶</a>
</div>
<p id="section-4.7.1.2-6">First, for each report in the request, the Helper <span class="bcp14">MAY</span> check if the report ID
corresponds to a report ID it has previously stored for this task. If so, it
rejects the report by setting the outbound preparation response to<a href="#section-4.7.1.2-6" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.7.1.2-7">
<pre>
variant {
  ReportID report_id;
  PrepareRespState prepare_resp_state = reject;
  ReportError report_error = report_replayed;
} PrepareResp;
</pre><a href="#section-4.7.1.2-7" class="pilcrow">¶</a>
</div>
<p id="section-4.7.1.2-8">where <code>report_id</code> is the report ID. Note that the Helper must perform this
check before completing the aggregation job.<a href="#section-4.7.1.2-8" class="pilcrow">¶</a></p>
<p id="section-4.7.1.2-9">Next the Helper decrypts each of its remaining report shares as described in
<a href="#input-share-decryption" class="auto internal xref">Section 4.7.1.3</a>, then checks input share validity as described in
<a href="#input-share-validation" class="auto internal xref">Section 4.7.1.4</a>. For any report that was rejected, the Helper sets
the outbound preparation response to<a href="#section-4.7.1.2-9" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.7.1.2-10">
<pre>
variant {
  ReportID report_id;
  PrepareRespState prepare_resp_state = reject;
  ReportError report_error;
} PrepareResp;
</pre><a href="#section-4.7.1.2-10" class="pilcrow">¶</a>
</div>
<p id="section-4.7.1.2-11">where <code>report_id</code> is the report ID and <code>report_error</code> is the indicated error.
For all other reports it initializes the VDAF prep state as follows (let
<code>inbound</code> denote the payload of the prep step sent by the Leader):<a href="#section-4.7.1.2-11" class="pilcrow">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-4.7.1.2-12">
<pre>
(state, outbound) = Vdaf.ping_pong_helper_init(
    vdaf_verify_key,
    "dap-13" || task_id,
    agg_param,
    report_id,
    public_share,
    plaintext_input_share.payload)
</pre><a href="#section-4.7.1.2-12" class="pilcrow">¶</a>
</div>
<p id="section-4.7.1.2-13">where:<a href="#section-4.7.1.2-13" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.7.1.2-14.1">
                <p id="section-4.7.1.2-14.1.1"><code>vdaf_verify_key</code> is the VDAF verification key for the task<a href="#section-4.7.1.2-14.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.1.2-14.2">
                <p id="section-4.7.1.2-14.2.1"><code>task_id</code> is the task ID<a href="#section-4.7.1.2-14.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.1.2-14.3">
                <p id="section-4.7.1.2-14.3.1"><code>agg_param</code> is the VDAF aggregation parameter sent in the
<code>AggregationJobInitReq</code><a href="#section-4.7.1.2-14.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.1.2-14.4">
                <p id="section-4.7.1.2-14.4.1"><code>report_id</code> is the report ID<a href="#section-4.7.1.2-14.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.1.2-14.5">
                <p id="section-4.7.1.2-14.5.1"><code>public_share</code> is the report's public share<a href="#section-4.7.1.2-14.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.1.2-14.6">
                <p id="section-4.7.1.2-14.6.1"><code>plaintext_input_share</code> is the Helper's <code>PlaintextInputShare</code><a href="#section-4.7.1.2-14.6.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-4.7.1.2-15">This procedure determines the initial per-report <code>state</code>, as well as the
initial <code>outbound</code> message to send in response to the Leader. If <code>state</code> is of
type <code>Rejected</code>, then the Helper responds with<a href="#section-4.7.1.2-15" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.7.1.2-16">
<pre>
variant {
  ReportID report_id;
  PrepareRespState prepare_resp_state = reject;
  ReportError report_error = vdaf_prep_error;
} PrepareResp;
</pre><a href="#section-4.7.1.2-16" class="pilcrow">¶</a>
</div>
<p id="section-4.7.1.2-17">Otherwise the Helper responds with<a href="#section-4.7.1.2-17" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.7.1.2-18">
<pre>
variant {
  ReportID report_id;
  PrepareRespState prepare_resp_state = continue;
  opaque payload&lt;0..2^32-1&gt; = outbound;
} PrepareResp;
</pre><a href="#section-4.7.1.2-18" class="pilcrow">¶</a>
</div>
<p id="section-4.7.1.2-19">If <code>state == Continued(prep_state)</code>, then the Helper stores <code>state</code> to
prepare for the next continuation step (<a href="#aggregation-helper-continuation" class="auto internal xref">Section 4.7.2.2</a>).<a href="#section-4.7.1.2-19" class="pilcrow">¶</a></p>
<p id="section-4.7.1.2-20">If <code>state == Finished(out_share)</code>, the Helper <span class="bcp14">MUST</span> resolve replay of the
report. It does so by checking if the report ID was previously stored for this
task. If so, it responds with<a href="#section-4.7.1.2-20" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.7.1.2-21">
<pre>
variant {
  ReportID report_id;
  PrepareRespState prepare_resp_state = reject;
  Reporterror report_error = report_replayed;
} PrepareResp;
</pre><a href="#section-4.7.1.2-21" class="pilcrow">¶</a>
</div>
<p id="section-4.7.1.2-22">Otherwise it stores the report ID for replay protection and updates the relevant
batch bucket with <code>out_share</code> as described in <a href="#batch-buckets" class="auto internal xref">Section 4.7.2.3</a>.<a href="#section-4.7.1.2-22" class="pilcrow">¶</a></p>
<p id="section-4.7.1.2-23">Finally, the Helper creates an <code>AggregationJobResp</code> to send to the Leader. This
message is structured as follows:<a href="#section-4.7.1.2-23" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.7.1.2-24">
<pre>
enum {
  processing(0),
  ready(1),
  (255)
} AggregationJobStatus;

struct {
  AggregationJobStatus status;
  select (AggregationJobResp.status) {
    case processing: Empty;
    case ready:      PrepareResp prepare_resps&lt;0..2^32-1&gt;;
  };
} AggregationJobResp;
</pre><a href="#section-4.7.1.2-24" class="pilcrow">¶</a>
</div>
<p id="section-4.7.1.2-25">where <code>prepare_resps</code> are the outbound prep steps computed in the previous step.
The order <span class="bcp14">MUST</span> match <code>AggregationJobInitReq.prepare_inits</code>.<a href="#section-4.7.1.2-25" class="pilcrow">¶</a></p>
<p id="section-4.7.1.2-26">The Helper responds to the Leader with HTTP status 201 Created, a body
consisting of the <code>AggregationJobResp</code>, and the media type
"application/dap-aggregation-job-resp".<a href="#section-4.7.1.2-26" class="pilcrow">¶</a></p>
<p id="section-4.7.1.2-27">Depending on the task parameters, processing an aggregation job may take some
time, so the Helper <span class="bcp14">MAY</span> defer computation to a background process. It does so
by responding with the field <code>status</code> set to <code>processing</code> and a Location header
field set to the relative reference
<code>/tasks/{task-id}/aggregation_jobs/{aggregation-job-id}?step=0</code>. The Leader
then polls the Helper by making HTTP GET requests to the aforementioned
Location. The Helper responds to GET requests with HTTP status 200 and the
<code>status</code> field reflecting the current state of the job. When the aggregation
job is <code>processing</code>, the response <span class="bcp14">SHOULD</span> include a Retry-After header field to
suggest a polling interval to the Leader.<a href="#section-4.7.1.2-27" class="pilcrow">¶</a></p>
<p id="section-4.7.1.2-28">Changing an aggregation job's parameters is illegal, so further HTTP PUT
requests to <code>/tasks/{task-id}/aggregation_jobs/{aggregation-job-id}</code> for the
same <code>aggregation-job-id</code> but with a different <code>AggregationJobInitReq</code> in the
body <span class="bcp14">MUST</span> fail with an HTTP client error status code. For further requests with
the same <code>AggregationJobInitReq</code> in the body, the Helper <span class="bcp14">SHOULD</span> respond as it
did for the original <code>AggregationJobInitReq</code>, or otherwise fail with an HTTP
client error status code.<a href="#section-4.7.1.2-28" class="pilcrow">¶</a></p>
<p id="section-4.7.1.2-29">Additionally, it is not possible to rewind or reset the state of an aggregation
job. Once an aggregation job has been continued at least once (see
<a href="#agg-continue-flow" class="auto internal xref">Section 4.7.2</a>), further requests to initialize that aggregation job <span class="bcp14">MUST</span>
fail with an HTTP client error status code.<a href="#section-4.7.1.2-29" class="pilcrow">¶</a></p>
</section>
</div>
<div id="input-share-decryption">
<section id="section-4.7.1.3">
            <h5 id="name-input-share-decryption">
<a href="#section-4.7.1.3" class="section-number selfRef">4.7.1.3. </a><a href="#name-input-share-decryption" class="section-name selfRef">Input Share Decryption</a>
            </h5>
<p id="section-4.7.1.3-1">Each report share has a corresponding task ID, report metadata (report ID,
timestamp, and public extensions), public share, and the Aggregator's encrypted
input share. Let <code>task_id</code>, <code>report_metadata</code>, <code>public_share</code>, and
<code>encrypted_input_share</code> denote these values, respectively. Given these values,
an Aggregator decrypts the input share as follows. First, it constructs an
<code>InputShareAad</code> message from <code>task_id</code>, <code>report_metadata</code>, and <code>public_share</code>.
Let this be denoted by <code>input_share_aad</code>. Then, the Aggregator looks up the HPKE
config and corresponding secret key indicated by
<code>encrypted_input_share.config_id</code> and attempts decryption of the payload with
the following procedure:<a href="#section-4.7.1.3-1" class="pilcrow">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-4.7.1.3-2">
<pre>
plaintext_input_share = OpenBase(encrypted_input_share.enc, sk,
  "dap-13 input share" || 0x01 || server_role,
  input_share_aad, encrypted_input_share.payload)
</pre><a href="#section-4.7.1.3-2" class="pilcrow">¶</a>
</div>
<p id="section-4.7.1.3-3">where <code>sk</code> is the HPKE secret key, <code>0x01</code> represents the Role of the sender
(always the Client), and <code>server_role</code> is the Role of the recipient Aggregator
(<code>0x02</code> for the Leader and <code>0x03</code> for the Helper). The <code>OpenBase()</code> function is
as specified in <span>[<a href="#HPKE" class="cite xref">HPKE</a>], <a href="https://rfc-editor.org/rfc/rfc9180#section-6.1" class="relref">Section 6.1</a></span> for the ciphersuite indicated by the HPKE
configuration. If decryption fails, the Aggregator marks the report share as
invalid with the error <code>hpke_decrypt_error</code>. Otherwise, the Aggregator outputs
the resulting PlaintextInputShare <code>plaintext_input_share</code>.<a href="#section-4.7.1.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="input-share-validation">
<section id="section-4.7.1.4">
            <h5 id="name-input-share-validation">
<a href="#section-4.7.1.4" class="section-number selfRef">4.7.1.4. </a><a href="#name-input-share-validation" class="section-name selfRef">Input Share Validation</a>
            </h5>
<p id="section-4.7.1.4-1">Validating an input share will either succeed or fail. In the case of failure,
the input share is marked as invalid with a corresponding report error.<a href="#section-4.7.1.4-1" class="pilcrow">¶</a></p>
<p id="section-4.7.1.4-2">Before beginning the preparation step, Aggregators are required to perform the
following checks:<a href="#section-4.7.1.4-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.7.1.4-3">
<li id="section-4.7.1.4-3.1">
                <p id="section-4.7.1.4-3.1.1">Check that the input share can be decoded as specified by the VDAF. If not,
the input share <span class="bcp14">MUST</span> be marked as invalid with the error <code>invalid_message</code>.<a href="#section-4.7.1.4-3.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.7.1.4-3.2">
                <p id="section-4.7.1.4-3.2.1">Check that the report's timestamp is well-formed as specified in
<a href="#timestamps" class="auto internal xref">Section 4.5</a>. If not, the Aggregator <span class="bcp14">MUST</span> mark the input share as invalid
with error <code>invalid_message</code>.<a href="#section-4.7.1.4-3.2.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.7.1.4-3.3">
                <p id="section-4.7.1.4-3.3.1">Check if the report's timestamp is too far in the future. If the report's
timestamp is more than a few minutes ahead of the current time, then the
Aggregator <span class="bcp14">SHOULD</span> mark the input share as invalid with error
<code>report_too_early</code>.<a href="#section-4.7.1.4-3.3.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.7.1.4-3.4">
                <p id="section-4.7.1.4-3.4.1">Check if the report's timestamp is before the task's <code>task_start</code> time. If
so, the Aggregator <span class="bcp14">MUST</span> mark the input share as invalid with the error
<code>task_not_started</code>.<a href="#section-4.7.1.4-3.4.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.7.1.4-3.5">
                <p id="section-4.7.1.4-3.5.1">Check if the report's timestamp is past the task's end time, given by
<code>task_start + task_duration</code>. If so, the Aggregator <span class="bcp14">MUST</span> mark the input
share as invalid with the error <code>task_expired</code>.<a href="#section-4.7.1.4-3.5.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.7.1.4-3.6">
                <p id="section-4.7.1.4-3.6.1">Check if the public or private report extensions contain any unrecognized
report extension types. If so, the Aggregator <span class="bcp14">MUST</span> mark the input share as
invalid with error <code>invalid_message</code>.<a href="#section-4.7.1.4-3.6.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.7.1.4-3.7">
                <p id="section-4.7.1.4-3.7.1">Check if any two public or private report extensions have the same extension
type. (For the purposes of this check, a private report extension can
conflict with a public report extension.) If so, the Aggregator <span class="bcp14">MUST</span> mark the
input share as invalid with error <code>invalid_message</code>.<a href="#section-4.7.1.4-3.7.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.7.1.4-3.8">
                <p id="section-4.7.1.4-3.8.1">If the report pertains to a batch that was previously collected, then the
input share <span class="bcp14">MUST</span> be marked as invalid with error <code>batch_collected</code>.<a href="#section-4.7.1.4-3.8.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.7.1.4-3.8.2.1">
                    <p id="section-4.7.1.4-3.8.2.1.1">Implementation note: The Leader considers a batch to be collected once it
has completed a collection job for a CollectionJobReq message from the
Collector; the Helper considers a batch to be collected once it has
responded to an <code>AggregateShareReq</code> message from the Leader. A batch is
determined by query (<a href="#batch-mode" class="auto internal xref">Section 4.2</a>) conveyed in these messages. Queries
must satisfy the criteria covered in <a href="#batch-validation" class="auto internal xref">Section 4.8.5</a>. These criteria
are meant to restrict queries in a way that makes it easy to determine
whether a report pertains to a batch that was collected. See
<a href="#distributed-systems" class="auto internal xref">Section 6.4.2</a> for more information.<a href="#section-4.7.1.4-3.8.2.1.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li id="section-4.7.1.4-3.9">
                <p id="section-4.7.1.4-3.9.1">Finally, if an Aggregator cannot determine if an input share is valid, it
<span class="bcp14">MUST</span> mark the input share as invalid with error <code>report_dropped</code>. For
example, if the Aggregator has evicted the state required to perform the
check from long-term storage. (See <a href="#sharding-storage" class="auto internal xref">Section 6.4.1</a> for
details.)<a href="#section-4.7.1.4-3.9.1" class="pilcrow">¶</a></p>
</li>
            </ol>
<p id="section-4.7.1.4-4">If all of the above checks succeed, the input share is not marked as invalid.<a href="#section-4.7.1.4-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="agg-continue-flow">
<section id="section-4.7.2">
          <h4 id="name-aggregate-continuation">
<a href="#section-4.7.2" class="section-number selfRef">4.7.2. </a><a href="#name-aggregate-continuation" class="section-name selfRef">Aggregate Continuation</a>
          </h4>
<p id="section-4.7.2-1">In the continuation phase, the Leader drives the VDAF preparation of each report
in the candidate report set until the underlying VDAF moves into a terminal
state, yielding an output share for both Aggregators or a rejection.<a href="#section-4.7.2-1" class="pilcrow">¶</a></p>
<p id="section-4.7.2-2">Whether this phase is reached depends on the VDAF: for 1-round VDAFs, like
Prio3, processing has already completed. Continuation is required for VDAFs
that require more than one round.<a href="#section-4.7.2-2" class="pilcrow">¶</a></p>
<div id="aggregation-leader-continuation">
<section id="section-4.7.2.1">
            <h5 id="name-leader-continuation">
<a href="#section-4.7.2.1" class="section-number selfRef">4.7.2.1. </a><a href="#name-leader-continuation" class="section-name selfRef">Leader Continuation</a>
            </h5>
<p id="section-4.7.2.1-1">The Leader begins each step of aggregation continuation with a prep state object
<code>state</code> and an outbound message <code>outbound</code> for each report in the candidate set.<a href="#section-4.7.2.1-1" class="pilcrow">¶</a></p>
<p id="section-4.7.2.1-2">The Leader advances its aggregation job to the next step (step 1 if this is the
first continuation after initialization). Then it instructs the Helper to
advance the aggregation job to the step the Leader has just reached. For each
report the Leader constructs a preparation continuation message:<a href="#section-4.7.2.1-2" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.7.2.1-3">
<pre>
struct {
  ReportID report_id;
  opaque payload&lt;0..2^32-1&gt;;
} PrepareContinue;
</pre><a href="#section-4.7.2.1-3" class="pilcrow">¶</a>
</div>
<p id="section-4.7.2.1-4">where <code>report_id</code> is the report ID associated with <code>state</code> and <code>outbound</code>, and
<code>payload</code> is set to the <code>outbound</code> message.<a href="#section-4.7.2.1-4" class="pilcrow">¶</a></p>
<p id="section-4.7.2.1-5">Next, the Leader sends a POST request to
<code>{helper}/tasks/{task-id}/aggregation_jobs/{aggregation-job-id}</code> with media
type "application/dap-aggregation-job-continue-req" and body structured as:<a href="#section-4.7.2.1-5" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.7.2.1-6">
<pre>
struct {
  uint16 step;
  PrepareContinue prepare_continues&lt;0..2^32-1&gt;;
} AggregationJobContinueReq;
</pre><a href="#section-4.7.2.1-6" class="pilcrow">¶</a>
</div>
<p id="section-4.7.2.1-7">The <code>step</code> field is the step of DAP aggregation that the Leader just reached and
wants the Helper to advance to. The <code>prepare_continues</code> field is the sequence of
preparation continuation messages constructed in the previous step. The
<code>PrepareContinue</code>s <span class="bcp14">MUST</span> be in the same order as the previous aggregate request.<a href="#section-4.7.2.1-7" class="pilcrow">¶</a></p>
<p id="section-4.7.2.1-8">The Leader <span class="bcp14">MUST</span> authenticate its requests to the Helper using a scheme that
meets the requirements in <a href="#request-authentication" class="auto internal xref">Section 3.1</a>.<a href="#section-4.7.2.1-8" class="pilcrow">¶</a></p>
<p id="section-4.7.2.1-9">The Helper responds with HTTP status 202 Accepted with a body containing an
<code>AggregationJobResp</code> (see <a href="#aggregation-helper-init" class="auto internal xref">Section 4.7.1.2</a>). If the <code>status</code> field
is <code>ready</code>, the Leader proceeds onward. Otherwise, if the <code>status</code> field is
<code>processing</code>, the Leader polls the aggregation job by sending GET requests to
the URI indicated in the Location header field, until the <code>status</code> is
<code>ready</code>. The Helper's response when processing <span class="bcp14">SHOULD</span> include a Retry-After
header to suggest a polling interval to the Leader.<a href="#section-4.7.2.1-9" class="pilcrow">¶</a></p>
<p id="section-4.7.2.1-10">The response's <code>prepare_resps</code> <span class="bcp14">MUST</span> include exactly the same report IDs in the
same order as the Leader's <code>AggregationJobContinueReq</code>. Otherwise, the Leader
<span class="bcp14">MUST</span> abort the aggregation job.<a href="#section-4.7.2.1-10" class="pilcrow">¶</a></p>
<p id="section-4.7.2.1-11">Otherwise, the Leader proceeds as follows with each report:<a href="#section-4.7.2.1-11" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.7.2.1-12">
<li id="section-4.7.2.1-12.1">
                <p id="section-4.7.2.1-12.1.1">If the inbound prep response type is "continue" and the state is
<code>Continued(prep_state)</code>, then the Leader computes<a href="#section-4.7.2.1-12.1.1" class="pilcrow">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-4.7.2.1-12.1.2">
<pre>
(state, outbound) = Vdaf.ping_pong_leader_continued(
    "dap-13" || task_id,
    agg_param,
    state,
    inbound,
)
</pre><a href="#section-4.7.2.1-12.1.2" class="pilcrow">¶</a>
</div>
<p id="section-4.7.2.1-12.1.3">
where <code>task_id</code> is the task ID and <code>inbound</code> is the message payload. If
<code>outbound != None</code>, then the Leader stores <code>state</code> and <code>outbound</code> and
proceeds to another continuation step. If <code>outbound == None</code>, then the
preparation process is complete: either <code>state == Rejected()</code>, in which case
the Leader rejects the report and removes it from the candidate set; or
<code>state == Finished(out_share)</code>, in which case preparation is complete and
the Leader updates the relevant batch bucket with <code>out_share</code> as described in
<a href="#batch-buckets" class="auto internal xref">Section 4.7.2.3</a>.<a href="#section-4.7.2.1-12.1.3" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.7.2.1-12.2">
                <p id="section-4.7.2.1-12.2.1">Else if the type is "finished" and <code>state == Finished(out_share)</code>, then
preparation is complete and the Leader stores the output share for use in
the collection interaction (<a href="#collect-flow" class="auto internal xref">Section 4.8</a>).<a href="#section-4.7.2.1-12.2.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.7.2.1-12.3">
                <p id="section-4.7.2.1-12.3.1">Else if the type is "reject", then the Leader rejects the report and removes
it from the candidate set.<a href="#section-4.7.2.1-12.3.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.7.2.1-12.4">
                <p id="section-4.7.2.1-12.4.1">Else the type is invalid, in which case the Leader <span class="bcp14">MUST</span> abort the
aggregation job.<a href="#section-4.7.2.1-12.4.1" class="pilcrow">¶</a></p>
</li>
            </ol>
<p id="section-4.7.2.1-13">When the Leader stores the <code>out_share</code>, it <span class="bcp14">MUST</span> also store the report ID for
replay protection.<a href="#section-4.7.2.1-13" class="pilcrow">¶</a></p>
<p id="section-4.7.2.1-14">If the Leader fails to process the response from the Helper, for example because
of a transient failure such as a network connection failure or process crash,
the Leader <span class="bcp14">SHOULD</span> re-send the original request unmodified in order to attempt
recovery (see <a href="#aggregation-step-skew-recovery" class="auto internal xref">Section 4.7.2.4</a>).<a href="#section-4.7.2.1-14" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aggregation-helper-continuation">
<section id="section-4.7.2.2">
            <h5 id="name-helper-continuation">
<a href="#section-4.7.2.2" class="section-number selfRef">4.7.2.2. </a><a href="#name-helper-continuation" class="section-name selfRef">Helper Continuation</a>
            </h5>
<p id="section-4.7.2.2-1">The Helper begins each step of continuation with a sequence of <code>state</code> objects,
which will be <code>Continued(prep_state)</code>, one for each report in the candidate set.<a href="#section-4.7.2.2-1" class="pilcrow">¶</a></p>
<p id="section-4.7.2.2-2">The Helper awaits an HTTP POST request to
<code>{helper}/tasks/{task-id}/aggregation_jobs/{aggregation-job-id}</code> from the
Leader, the body of which is an <code>AggregationJobContinueReq</code> as specified in
<a href="#aggregation-leader-continuation" class="auto internal xref">Section 4.7.2.1</a>.<a href="#section-4.7.2.2-2" class="pilcrow">¶</a></p>
<p id="section-4.7.2.2-3">Next, it checks that it recognizes the task ID. If not, then it <span class="bcp14">MUST</span> abort with
error <code>unrecognizedTask</code>.<a href="#section-4.7.2.2-3" class="pilcrow">¶</a></p>
<p id="section-4.7.2.2-4">Next, it checks if it recognizes the indicated aggregation job ID. If not, it
<span class="bcp14">MUST</span> abort with error <code>unrecognizedAggregationJob</code>.<a href="#section-4.7.2.2-4" class="pilcrow">¶</a></p>
<p id="section-4.7.2.2-5">Next, the Helper checks that:<a href="#section-4.7.2.2-5" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.7.2.2-6">
<li id="section-4.7.2.2-6.1">
                <p id="section-4.7.2.2-6.1.1">the report IDs are all distinct<a href="#section-4.7.2.2-6.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.7.2.2-6.2">
                <p id="section-4.7.2.2-6.2.1">each report ID corresponds to one of the <code>state</code> objects<a href="#section-4.7.2.2-6.2.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.7.2.2-6.3">
                <p id="section-4.7.2.2-6.3.1"><code>AggregationJobContinueReq.step</code> is not equal to <code>0</code><a href="#section-4.7.2.2-6.3.1" class="pilcrow">¶</a></p>
</li>
            </ol>
<p id="section-4.7.2.2-7">If any of these checks fail, then the Helper <span class="bcp14">MUST</span> abort with error
<code>invalidMessage</code>. Additionally, if any prep step appears out of order relative
to the previous request, then the Helper <span class="bcp14">MAY</span> abort with error <code>invalidMessage</code>.
(Note that a report may be missing, in which case the Helper should assume the
Leader rejected it.)<a href="#section-4.7.2.2-7" class="pilcrow">¶</a></p>
<p id="section-4.7.2.2-8">Next, the Helper checks if the continuation step indicated by the request is
correct. (For the first <code>AggregationJobContinueReq</code> the value should be <code>1</code>; for
the second the value should be <code>2</code>; and so on.) If the Leader is one step behind
(e.g., the Leader has resent the previous HTTP request), then the Helper <span class="bcp14">MAY</span>
attempt to recover by sending the same response as it did for the previous
<code>AggregationJobContinueReq</code>, without performing any additional work on the
aggregation job. In this case it <span class="bcp14">SHOULD</span> verify that the contents of the
<code>AggregationJobContinueReq</code> are identical to the previous message (see
<a href="#aggregation-step-skew-recovery" class="auto internal xref">Section 4.7.2.4</a>). Otherwise, if the step is incorrect or if
the Helper does not wish to attempt recovery, the Helper <span class="bcp14">MUST</span> abort with error
<code>stepMismatch</code>.<a href="#section-4.7.2.2-8" class="pilcrow">¶</a></p>
<p id="section-4.7.2.2-9">Let <code>inbound</code> denote the payload of the prep step. For each report, the Helper
computes the following:<a href="#section-4.7.2.2-9" class="pilcrow">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-4.7.2.2-10">
<pre>
(state, outbound) = Vdaf.ping_pong_helper_continued(
    "dap-13" || task_id,
    agg_param,
    state,
    inbound,
)
</pre><a href="#section-4.7.2.2-10" class="pilcrow">¶</a>
</div>
<p id="section-4.7.2.2-11">where <code>task_id</code> is the task ID. If <code>state == Rejected()</code>, then the Helper's
response is<a href="#section-4.7.2.2-11" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.7.2.2-12">
<pre>
variant {
  ReportID report_id;
  PrepareRespState prepare_resp_state = reject;
  ReportError report_error = vdaf_prep_error;
} PrepareResp;
</pre><a href="#section-4.7.2.2-12" class="pilcrow">¶</a>
</div>
<p id="section-4.7.2.2-13">If <code>state == Continued(prep_state)</code>, then the Helper stores <code>state</code> to
prepare for the next continuation step (<a href="#aggregation-helper-continuation" class="auto internal xref">Section 4.7.2.2</a>).<a href="#section-4.7.2.2-13" class="pilcrow">¶</a></p>
<p id="section-4.7.2.2-14">If <code>state == Finished(out_share)</code>, the Helper <span class="bcp14">MUST</span> resolve replay of the
report. It does so by checking if the report ID was previously stored for this
task. If so, it responds with<a href="#section-4.7.2.2-14" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.7.2.2-15">
<pre>
variant {
  ReportID report_id;
  PrepareRespState prepare_resp_state = reject;
  ReportError report_error = report_replayed;
} PrepareResp;
</pre><a href="#section-4.7.2.2-15" class="pilcrow">¶</a>
</div>
<p id="section-4.7.2.2-16">Otherwise it stores the report ID for replay protection and updates the relevant
batch bucket with <code>out_share</code> as described in <a href="#batch-buckets" class="auto internal xref">Section 4.7.2.3</a>.<a href="#section-4.7.2.2-16" class="pilcrow">¶</a></p>
<p id="section-4.7.2.2-17">The Helper's response depends on the value of <code>outbound</code>. If <code>outbound !=
None</code>, then the Helper's response is<a href="#section-4.7.2.2-17" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.7.2.2-18">
<pre>
variant {
  ReportID report_id;
  PrepareRespState prepare_resp_state = continue;
  opaque payload&lt;0..2^32-1&gt; = outbound;
} PrepareResp;
</pre><a href="#section-4.7.2.2-18" class="pilcrow">¶</a>
</div>
<p id="section-4.7.2.2-19">Otherwise, if <code>outbound == None</code>, then the Helper's response is<a href="#section-4.7.2.2-19" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.7.2.2-20">
<pre>
variant {
  ReportID report_id;
  PrepareRespState prepare_resp_state = finished;
} PrepareResp;
</pre><a href="#section-4.7.2.2-20" class="pilcrow">¶</a>
</div>
<p id="section-4.7.2.2-21">The Helper constructs an <code>AggregationJobResp</code> message (see
<a href="#aggregation-helper-init" class="auto internal xref">Section 4.7.1.2</a>) with each prep step. The order of the prep steps
<span class="bcp14">MUST</span> match the Leader's <code>AggregationJobContinueReq</code>.<a href="#section-4.7.2.2-21" class="pilcrow">¶</a></p>
<p id="section-4.7.2.2-22">The Helper responds to the Leader with HTTP status 202 Accepted, a body
consisting of the <code>AggregationJobResp</code>, and the media type
"application/dap-aggregation-job-resp".<a href="#section-4.7.2.2-22" class="pilcrow">¶</a></p>
<p id="section-4.7.2.2-23">Depending on the task parameters, processing an aggregation job may take some
time, so the Helper <span class="bcp14">MAY</span> defer computation to a background process by responding
with the field <code>status</code> set to <code>processing</code> and Location header field set to the
relative reference
<code>/tasks/{task-id}/aggregation_jobs/{aggregation-job-id}?step={step}</code>, where
<code>step</code> is the step indicated in the <code>AggregationJobContinueReq</code>. If so, the
Leader polls the Helper by making HTTP GET requests to the aforementioned
Location. The Helper responds to GET requests with HTTP status 200 and the
<code>status</code> field reflecting the current state of the job. When the aggregation
job is <code>processing</code>, the response <span class="bcp14">SHOULD</span> include a Retry-After header field to
suggest a polling interval to the Leader.<a href="#section-4.7.2.2-23" class="pilcrow">¶</a></p>
<p id="section-4.7.2.2-24">If for whatever reason the Leader must abandon the aggregation job, it <span class="bcp14">SHOULD</span>
send an HTTP DELETE request to
<code>{helper}/tasks/{task-id}/aggregation_jobs/{aggregation-job-id}</code> so that the
Helper knows it can clean up its state.<a href="#section-4.7.2.2-24" class="pilcrow">¶</a></p>
</section>
</div>
<div id="batch-buckets">
<section id="section-4.7.2.3">
            <h5 id="name-batch-buckets">
<a href="#section-4.7.2.3" class="section-number selfRef">4.7.2.3. </a><a href="#name-batch-buckets" class="section-name selfRef">Batch Buckets</a>
            </h5>
<p id="section-4.7.2.3-1">When aggregation recovers an output share, it must be stored into an appropriate
"batch bucket", which is defined in this section. The data stored in a batch
bucket is kept for eventual use in the <a href="#collect-flow" class="auto internal xref">Section 4.8</a>.<a href="#section-4.7.2.3-1" class="pilcrow">¶</a></p>
<p id="section-4.7.2.3-2">Batch buckets are indexed by a "batch bucket identifier" as as specified by the
task's batch mode:<a href="#section-4.7.2.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.7.2.3-3.1">
                <p id="section-4.7.2.3-3.1.1">For the time-interval batch mode (<a href="#time-interval-batch-mode" class="auto internal xref">Section 5.1</a>, the batch
bucket identifier is an interval of time and is determined by the report's timestamp.<a href="#section-4.7.2.3-3.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.2.3-3.2">
                <p id="section-4.7.2.3-3.2.1">For the leader-selected batch mode (<a href="#leader-selected-batch-mode" class="auto internal xref">Section 5.2</a>), the
batch bucket identifier is the batch ID and indicated in the aggregation job.<a href="#section-4.7.2.3-3.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-4.7.2.3-4">A few different pieces of information are associated with each batch bucket:<a href="#section-4.7.2.3-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.7.2.3-5.1">
                <p id="section-4.7.2.3-5.1.1">A VDAF-specific aggregate share, as defined in <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-4.7.2.3-5.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.2.3-5.2">
                <p id="section-4.7.2.3-5.2.1">A count of a number of reports included in the batch bucket.<a href="#section-4.7.2.3-5.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.2.3-5.3">
                <p id="section-4.7.2.3-5.3.1">A 32-byte checksum value, as defined below.<a href="#section-4.7.2.3-5.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-4.7.2.3-6">When processing an output share <code>out_share</code>, the following procedure is used to
update the batch buckets:<a href="#section-4.7.2.3-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.7.2.3-7.1">
                <p id="section-4.7.2.3-7.1.1">Look up the existing batch bucket for the batch bucket identifier
associated with the aggregation job and output share.<a href="#section-4.7.2.3-7.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.7.2.3-7.1.2.1">
                    <p id="section-4.7.2.3-7.1.2.1.1">If there is no existing batch bucket, initialize a new one. The initial
aggregate share value is computed as <code>Vdaf.agg_init(agg_param)</code>, where
<code>agg_param</code> is the aggregation parameter associated with the aggregation job
(see <span>[<a href="#VDAF" class="cite xref">VDAF</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-4.4" class="relref">Section 4.4</a></span>); the initial count is <code>0</code>; and the initial
checksum is 32 zero bytes.<a href="#section-4.7.2.3-7.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="normal" id="section-4.7.2.3-7.2">
                <p id="section-4.7.2.3-7.2.1">Update the aggregate share <code>agg_share</code> to <code>Vdaf.agg_update(agg_param,
agg_share, out_share)</code>.<a href="#section-4.7.2.3-7.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.2.3-7.3">
                <p id="section-4.7.2.3-7.3.1">Increment the count by 1.<a href="#section-4.7.2.3-7.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.7.2.3-7.4">
                <p id="section-4.7.2.3-7.4.1">Update the checksum value to the bitwise-XOR of the checksum value with the
SHA256 <span>[<a href="#SHS" class="cite xref">SHS</a>]</span> hash of the report ID associated
with the output share.<a href="#section-4.7.2.3-7.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-4.7.2.3-8">Implementation note: this section describes a single set of values associated
with each batch bucket. However, implementations are free to shard the aggregate
share/count/checksum values associated with the batch bucket, combining them
back into a single set of values when reading the batch bucket. This may be
useful to avoid write contention. The aggregate share values are combined using
<code>Vdaf.merge(agg_param, agg_shares)</code> (see <span>[<a href="#VDAF" class="cite xref">VDAF</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-4.4" class="relref">Section 4.4</a></span>), the count
values are combined by summing, and the checksum values are combined by bitwise
XOR.<a href="#section-4.7.2.3-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aggregation-step-skew-recovery">
<section id="section-4.7.2.4">
            <h5 id="name-recovering-from-aggregation">
<a href="#section-4.7.2.4" class="section-number selfRef">4.7.2.4. </a><a href="#name-recovering-from-aggregation" class="section-name selfRef">Recovering from Aggregation Step Skew</a>
            </h5>
<p id="section-4.7.2.4-1"><code>AggregationJobContinueReq</code> messages contain a <code>step</code> field, allowing
Aggregators to ensure that their peer is on an expected step of DAP
aggregation. In particular, the intent is to allow recovery from a scenario
where the Helper successfully advances from step <code>n</code> to <code>n+1</code>, but its
<code>AggregationJobResp</code> response to the Leader gets dropped due to something like
a transient network failure. The Leader could then resend the request to have
the Helper advance to step <code>n+1</code> and the Helper should be able to retransmit
the <code>AggregationJobResp</code> that was previously dropped. To make that kind of
recovery possible, Aggregator implementations <span class="bcp14">SHOULD</span> checkpoint the most recent
step's prep state and messages to durable storage such that the Leader can
re-construct continuation requests and the Helper can re-construct continuation
responses as needed.<a href="#section-4.7.2.4-1" class="pilcrow">¶</a></p>
<p id="section-4.7.2.4-2">When implementing an aggregation step skew recovery strategy, the Helper <span class="bcp14">SHOULD</span>
ensure that the Leader's <code>AggregationJobContinueReq</code> message did not change when
it was re-sent (i.e., the two messages must be identical). This prevents the
Leader from re-winding an aggregation job and re-running an aggregation step
with different parameters.<a href="#section-4.7.2.4-2" class="pilcrow">¶</a></p>
<p id="section-4.7.2.4-3">One way the Helper could address this would be to store a digest of the Leader's
request, indexed by aggregation job ID and step, and refuse to service a request
for a given aggregation step unless it matches the previously seen request (if
any).<a href="#section-4.7.2.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="collect-flow">
<section id="section-4.8">
        <h3 id="name-collecting-results">
<a href="#section-4.8" class="section-number selfRef">4.8. </a><a href="#name-collecting-results" class="section-name selfRef">Collecting Results</a>
        </h3>
<p id="section-4.8-1">In this phase, the Collector requests aggregate shares from each Aggregator and
then locally combines them to yield a single aggregate result. In particular,
the Collector issues a query to the Leader (<a href="#batch-mode" class="auto internal xref">Section 4.2</a>), which the
Aggregators use to select a batch of reports to aggregate. Each Aggregator emits
an aggregate share encrypted to the Collector so that it can decrypt and combine
them to yield the aggregate result. This entire process is composed of two
interactions:<a href="#section-4.8-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.8-2">
<li id="section-4.8-2.1">
            <p id="section-4.8-2.1.1">Collect request and response between the Collector and Leader, specified in
<a href="#collect-init" class="auto internal xref">Section 4.8.1</a><a href="#section-4.8-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.8-2.2">
            <p id="section-4.8-2.2.1">Aggregate share request and response between the Leader and the Helper,
specified in <a href="#collect-aggregate" class="auto internal xref">Section 4.8.2</a><a href="#section-4.8-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-4.8-3">Once complete, the Collector computes the final aggregate result as specified in
<a href="#collect-finalization" class="auto internal xref">Section 4.8.3</a>.<a href="#section-4.8-3" class="pilcrow">¶</a></p>
<p id="section-4.8-4">This overall process is referred to as a "collection job".<a href="#section-4.8-4" class="pilcrow">¶</a></p>
<div id="collect-init">
<section id="section-4.8.1">
          <h4 id="name-collection-job-initializati">
<a href="#section-4.8.1" class="section-number selfRef">4.8.1. </a><a href="#name-collection-job-initializati" class="section-name selfRef">Collection Job Initialization</a>
          </h4>
<p id="section-4.8.1-1">First, the Collector chooses a collection job ID:<a href="#section-4.8.1-1" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.8.1-2">
<pre>
opaque CollectionJobID[16];
</pre><a href="#section-4.8.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.8.1-3">This ID value <span class="bcp14">MUST</span> be unique within the scope of the corresponding DAP task.<a href="#section-4.8.1-3" class="pilcrow">¶</a></p>
<p id="section-4.8.1-4">To initiate the collection job, the collector issues a PUT request to
<code>{leader}/tasks/{task-id}/collection_jobs/{collection-job-id}</code>. The body of the
request has media type "application/dap-collection-job-req", and it is structured
as follows:<a href="#section-4.8.1-4" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.8.1-5">
<pre>
struct {
  BatchMode batch_mode;
  opaque config&lt;0..2^16-1&gt;;
} Query;

struct {
  Query query;
  opaque agg_param&lt;0..2^32-1&gt;; /* VDAF aggregation parameter */
} CollectionJobReq;
</pre><a href="#section-4.8.1-5" class="pilcrow">¶</a>
</div>
<p id="section-4.8.1-6">The named parameters are:<a href="#section-4.8.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.8.1-7.1">
              <p id="section-4.8.1-7.1.1"><code>query</code>, the Collector's query. The content of this field depends on the
indicated batch mode: for time-interval mode, the <code>config</code> field contains the
requested time interval (<a href="#time-interval-batch-mode" class="auto internal xref">Section 5.1</a>); for leader-selected
mode, the <code>config</code> field is empty, and the Collector gets the aggregate
result for the next batch selected by the Leader
(<a href="#leader-selected-batch-mode" class="auto internal xref">Section 5.2</a>).<a href="#section-4.8.1-7.1.1" class="pilcrow">¶</a></p>
<p id="section-4.8.1-7.1.2">
Batch modes defined by future documents <span class="bcp14">MUST</span> specify the content of this field;
see <a href="#extending-this-doc" class="auto internal xref">Section 10</a> for details.<a href="#section-4.8.1-7.1.2" class="pilcrow">¶</a></p>
<p id="section-4.8.1-7.1.3">
The indicated batch mode <span class="bcp14">MUST</span> match the task's batch mode. Otherwise, the
Leader <span class="bcp14">MUST</span> abort with error "invalidMessage".<a href="#section-4.8.1-7.1.3" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.8.1-7.2">
              <p id="section-4.8.1-7.2.1"><code>agg_param</code>, an aggregation parameter for the VDAF being executed. This is the
same value as in <code>AggregationJobInitReq</code> (see <a href="#leader-init" class="auto internal xref">Section 4.7.1.1</a>).<a href="#section-4.8.1-7.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.8.1-8">Collectors <span class="bcp14">MUST</span> authenticate their requests to Leaders using a scheme that meets
the requirements in <a href="#request-authentication" class="auto internal xref">Section 3.1</a>.<a href="#section-4.8.1-8" class="pilcrow">¶</a></p>
<p id="section-4.8.1-9">Depending on the VDAF scheme and how the Leader is configured, the Leader and
Helper may already have prepared a sufficient number of reports satisfying the
query and be ready to return the aggregate shares right away. However, this is
not always the case. In fact, for some VDAFs, it is not be possible to begin
running aggregation jobs (<a href="#aggregate-flow" class="auto internal xref">Section 4.7</a>) until the Collector initiates a
collection job. This is because, in general, the aggregation parameter is not
known until this point. In certain situations it is possible to predict the
aggregation parameter in advance. For example, for Prio3 the only valid
aggregation parameter is the empty string. For these reasons, the collection job
is handled asynchronously. If aggregation is performed eagerly, the Leader <span class="bcp14">MUST</span>
validate that the aggregation parameter received in the <code>CollectionJobReq</code>
matches the aggregation parameter used in aggregations.<a href="#section-4.8.1-9" class="pilcrow">¶</a></p>
<p id="section-4.8.1-10">Upon receipt of a <code>CollectionJobReq</code>, the Leader begins by checking that it
recognizes the task ID in the request path. If not, it <span class="bcp14">MUST</span> abort with error
<code>unrecognizedTask</code>.<a href="#section-4.8.1-10" class="pilcrow">¶</a></p>
<p id="section-4.8.1-11">The Leader <span class="bcp14">MAY</span> further validate the request according to the requirements in
<a href="#batch-validation" class="auto internal xref">Section 4.8.5</a> and abort with the indicated error, though some conditions
such as the number of valid reports may not be verifiable while handling the
<code>CollectionJobReq</code> message, and the batch will have to be re-validated later on
regardless.<a href="#section-4.8.1-11" class="pilcrow">¶</a></p>
<p id="section-4.8.1-12">Changing a collection job's parameters is illegal, so further requests to
<code>PUT /tasks/{task-id}/collection_jobs/{collection-job-id}</code> for the same
<code>collection-job-id</code> but with a different <code>CollectionJobReq</code> in the body <span class="bcp14">MUST</span>
fail with an HTTP client error status code.<a href="#section-4.8.1-12" class="pilcrow">¶</a></p>
<p id="section-4.8.1-13">The Leader responds to <code>CollectionJobReq</code>s with a <code>CollectionJobResp</code>, which is
structured as follows:<a href="#section-4.8.1-13" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.8.1-14">
<pre>
enum {
  processing(0),
  ready(1),
  (255)
} CollectionJobStatus;

struct {
  PartialBatchSelector part_batch_selector;
  uint64 report_count;
  Interval interval;
  HpkeCiphertext leader_encrypted_agg_share;
  HpkeCiphertext helper_encrypted_agg_share;
} Collection;

struct {
  CollectionJobStatus status;
  select (CollectionJob.status) {
    case processing: Empty;
    case ready:      Collection;
  }
} CollectionJobResp;
</pre><a href="#section-4.8.1-14" class="pilcrow">¶</a>
</div>
<p id="section-4.8.1-15">The body's media type is "application/dap-collection-job-resp". The <code>Collection</code>
structure includes the following:<a href="#section-4.8.1-15" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.8.1-16.1">
              <p id="section-4.8.1-16.1.1"><code>part_batch_selector</code>: Information used to bind the aggregate result to the
query. For leader-selected tasks, this includes the batch ID assigned to the
batch by the Leader. The indicated batch mode <span class="bcp14">MUST</span> match the task's batch
mode.<a href="#section-4.8.1-16.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.8.1-16.2">
              <p id="section-4.8.1-16.2.1"><code>report_count</code>: The number of reports included in the batch.<a href="#section-4.8.1-16.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.8.1-16.3">
              <p id="section-4.8.1-16.3.1"><code>interval</code>: The smallest interval of time that contains the timestamps of all
reports included in the batch. Note that in the case of a time-interval query
(<a href="#time-interval-batch-mode" class="auto internal xref">Section 5.1</a>), this interval can be smaller than the one in
the corresponding <code>CollectionJobReq.query</code>.<a href="#section-4.8.1-16.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.8.1-16.4">
              <p id="section-4.8.1-16.4.1"><code>leader_encrypted_agg_share</code>: The Leader's aggregate share, encrypted to the
Collector (see <a href="#aggregate-share-encrypt" class="auto internal xref">Section 4.8.4</a>).<a href="#section-4.8.1-16.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.8.1-16.5">
              <p id="section-4.8.1-16.5.1"><code>helper_encrypted_agg_share</code>: The Helper's aggregate share, encrypted to the
Collector (see <a href="#aggregate-share-encrypt" class="auto internal xref">Section 4.8.4</a>).<a href="#section-4.8.1-16.5.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.8.1-17">If the Leader finds the <code>CollectionJobReq</code> to be valid, it immediately responds
with HTTP status 201 Created with a body containing a <code>CollectionJobResp</code> with
the <code>status</code> field set to <code>processing</code>. The Leader <span class="bcp14">SHOULD</span> include a Retry-After
header field to suggest a polling interval to the Collector.<a href="#section-4.8.1-17" class="pilcrow">¶</a></p>
<p id="section-4.8.1-18">After receiving the response to its <code>CollectionJobReq</code>, the Collector
periodically makes HTTP GET requests
<code>/tasks/{task-id}/collection_jobs/{collection-job-id}</code> to check on the status
of the collect job and eventually obtain the result. The Leader responds to GET
requests with HTTP status 200 and the <code>status</code> field reflecting the current
state of the job. When the collection job is <code>processing</code>, the response <span class="bcp14">SHOULD</span>
include a Retry-After header field to suggest a polling interval to the
Collector.<a href="#section-4.8.1-18" class="pilcrow">¶</a></p>
<p id="section-4.8.1-19">The Leader then begins working with the Helper to aggregate the reports
satisfying the query (or continues this process, depending on the VDAF) as
described in <a href="#aggregate-flow" class="auto internal xref">Section 4.7</a>.<a href="#section-4.8.1-19" class="pilcrow">¶</a></p>
<p id="section-4.8.1-20">The Leader first checks whether it can construct a batch for the
collection job by applying the requirements in <a href="#batch-validation" class="auto internal xref">Section 4.8.5</a>. If so, then
the Leader obtains the Helper's aggregate share following the aggregate-share
request flow described in <a href="#collect-aggregate" class="auto internal xref">Section 4.8.2</a>. If not, it either aborts the
collection job or tries again later, depending on which requirement in
<a href="#batch-validation" class="auto internal xref">Section 4.8.5</a> was not met. If the Leader has a pending aggregation job
that overlaps with the batch and aggregation parameter for the collection job,
the Leader <span class="bcp14">MUST</span> first complete the aggregation job before proceeding and
requesting an aggregate share from the Helper. This avoids a race condition
between aggregation and collection jobs that can yield trivial batch mismatch
errors.<a href="#section-4.8.1-20" class="pilcrow">¶</a></p>
<p id="section-4.8.1-21">Once both aggregate shares are successfully obtained, the Leader responds to
subsequent HTTP GET requests with the <code>status</code> field set to <code>ready</code> and the
<code>Collection</code> field populated with the encrypted aggregate shares. The Collector
stops polling once receiving this final request.<a href="#section-4.8.1-21" class="pilcrow">¶</a></p>
<p id="section-4.8.1-22">If obtaining aggregate shares fails, then the Leader responds to subsequent HTTP
GET requests to the collection job with an HTTP error status and a problem
document as described in <a href="#errors" class="auto internal xref">Section 3.2</a>.<a href="#section-4.8.1-22" class="pilcrow">¶</a></p>
<p id="section-4.8.1-23">The Leader <span class="bcp14">MAY</span> respond with HTTP status 204 No Content to requests to a
collection job if the results have been deleted.<a href="#section-4.8.1-23" class="pilcrow">¶</a></p>
<p id="section-4.8.1-24">The Collector can send an HTTP DELETE request to the collection job, which
indicates to the Leader that it can abandon the collection job and discard all
state related to it.<a href="#section-4.8.1-24" class="pilcrow">¶</a></p>
</section>
</div>
<div id="collect-aggregate">
<section id="section-4.8.2">
          <h4 id="name-obtaining-aggregate-shares">
<a href="#section-4.8.2" class="section-number selfRef">4.8.2. </a><a href="#name-obtaining-aggregate-shares" class="section-name selfRef">Obtaining Aggregate Shares</a>
          </h4>
<p id="section-4.8.2-1">The Leader must compute its own aggregate share, as well as obtaining the
Helper's encrypted aggregate share, before it can complete a collection job.<a href="#section-4.8.2-1" class="pilcrow">¶</a></p>
<p id="section-4.8.2-2">First, the Leader retrieves all batch buckets (<a href="#batch-buckets" class="auto internal xref">Section 4.7.2.3</a>) associated
with this collection job. The batch buckets to retrieve depend on the batch mode
of this task:<a href="#section-4.8.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.8.2-3.1">
              <p id="section-4.8.2-3.1.1">For time-interval (<a href="#time-interval-batch-mode" class="auto internal xref">Section 5.1</a>), this is all batch buckets
whose batch bucket identifiers are contained within the batch interval
specified in the <code>CollectionJobReq</code>'s query.<a href="#section-4.8.2-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.8.2-3.2">
              <p id="section-4.8.2-3.2.1">For leader-selected (<a href="#leader-selected-batch-mode" class="auto internal xref">Section 5.2</a>), this is the batch
bucket associated with the batch ID the Leader has chosen for this collection
job.<a href="#section-4.8.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.8.2-4">The Leader then combines the values inside the batch bucket as follows:<a href="#section-4.8.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.8.2-5.1">
              <p id="section-4.8.2-5.1.1">Aggregate shares are combined via <code>Vdaf.merge(agg_param, agg_shares)</code> ((see
<span>[<a href="#VDAF" class="cite xref">VDAF</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-4.4" class="relref">Section 4.4</a></span>)), where <code>agg_param</code> is the aggregation parameter
provided in the <code>CollectionJobReq</code>, and <code>agg_shares</code> are the (partial)
aggregate shares in the batch buckets. The result is the final aggregate share
for this collection job.<a href="#section-4.8.2-5.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.8.2-5.2">
              <p id="section-4.8.2-5.2.1">Report counts are combined via summing.<a href="#section-4.8.2-5.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.8.2-5.3">
              <p id="section-4.8.2-5.3.1">Checksums are combined via bitwise XOR.<a href="#section-4.8.2-5.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.8.2-6">Then the Leader sends a POST request to
<code>{helper}/tasks/{task-id}/aggregate_shares</code> with the following message:<a href="#section-4.8.2-6" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.8.2-7">
<pre>
struct {
  BatchMode batch_mode;
  opaque config&lt;0..2^16-1&gt;;
} BatchSelector;

struct {
  BatchSelector batch_selector;
  opaque agg_param&lt;0..2^32-1&gt;;
  uint64 report_count;
  opaque checksum[32];
} AggregateShareReq;
</pre><a href="#section-4.8.2-7" class="pilcrow">¶</a>
</div>
<p id="section-4.8.2-8">The media type of the request is "application/dap-aggregate-share-req". The
message contains the following parameters:<a href="#section-4.8.2-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.8.2-9.1">
              <p id="section-4.8.2-9.1.1"><code>batch_selector</code>: The "batch selector", the contents of which depends on the
indicated batch mode: for time-interval mode, the <code>config</code> field contains the
time interval selected by the Collector (<a href="#time-interval-batch-mode" class="auto internal xref">Section 5.1</a>); in
leader-selected mode, the field contains the batch ID selected by the Leader
(<a href="#leader-selected-batch-mode" class="auto internal xref">Section 5.2</a>).<a href="#section-4.8.2-9.1.1" class="pilcrow">¶</a></p>
<p id="section-4.8.2-9.1.2">
Future documents that new batch modes <span class="bcp14">MUST</span> specify the contents of the
<code>config</code> field; see <a href="#extending-this-doc" class="auto internal xref">Section 10</a> for details.<a href="#section-4.8.2-9.1.2" class="pilcrow">¶</a></p>
<p id="section-4.8.2-9.1.3">
The indicated batch mode <span class="bcp14">MUST</span> match the task's batch mode. Otherwise, the
Helper <span class="bcp14">MUST</span> abort with "invalidMessage".<a href="#section-4.8.2-9.1.3" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.8.2-9.2">
              <p id="section-4.8.2-9.2.1"><code>agg_param</code>: The opaque aggregation parameter for the VDAF being executed.
This value <span class="bcp14">MUST</span> match the <code>AggregationJobInitReq</code> message for each aggregation
job used to compute the aggregate shares (see <a href="#leader-init" class="auto internal xref">Section 4.7.1.1</a>) and the
aggregation parameter indicated by the Collector in the CollectionJobReq
message (see <a href="#collect-init" class="auto internal xref">Section 4.8.1</a>).<a href="#section-4.8.2-9.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.8.2-9.3">
              <p id="section-4.8.2-9.3.1"><code>report_count</code>: The number number of reports included in the batch, as
computed above.<a href="#section-4.8.2-9.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.8.2-9.4">
              <p id="section-4.8.2-9.4.1"><code>checksum</code>: The batch checksum, as computed above.<a href="#section-4.8.2-9.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.8.2-10">Leaders <span class="bcp14">MUST</span> authenticate their requests to Helpers using a scheme that meets
the requirements in <a href="#request-authentication" class="auto internal xref">Section 3.1</a>.<a href="#section-4.8.2-10" class="pilcrow">¶</a></p>
<p id="section-4.8.2-11">To handle the Leader's request, the Helper first ensures that it recognizes the
task ID in the request path. If not, it <span class="bcp14">MUST</span> abort with error
<code>unrecognizedTask</code>. The Helper then verifies that the request meets the
requirements for batch parameters following the procedure in
<a href="#batch-validation" class="auto internal xref">Section 4.8.5</a>. The Helper <span class="bcp14">MUST</span> validate that the aggregation parameter
matches the aggregation parameter used during aggregation of this batch;
otherwise, it aborts with "invalidMessage".<a href="#section-4.8.2-11" class="pilcrow">¶</a></p>
<p id="section-4.8.2-12">Next, the Helper retrieves and combines the batch buckets associated with the
request using the same process used by the Leader (as described at the beginning
of this section <a href="#collect-aggregate" class="auto internal xref">Section 4.8.2</a>), arriving at its final aggregate share,
report count, and checksum values. If the Helper's computed report count and
checksum values do not match the values provided in the <code>AggregateShareReq</code>, it
<span class="bcp14">MUST</span> abort with an error of type "batchMismatch".<a href="#section-4.8.2-12" class="pilcrow">¶</a></p>
<p id="section-4.8.2-13">The Helper then encrypts <code>agg_share</code> under the Collector's HPKE public key as
described in <a href="#aggregate-share-encrypt" class="auto internal xref">Section 4.8.4</a>, yielding <code>encrypted_agg_share</code>.
Encryption prevents the Leader from learning the actual result, as it only has
its own aggregate share and cannot compute the Helper's.<a href="#section-4.8.2-13" class="pilcrow">¶</a></p>
<p id="section-4.8.2-14">The Helper responds to the Leader with HTTP status code 200 OK and a body
consisting of an <code>AggregateShare</code>, with media type
"application/dap-aggregate-share":<a href="#section-4.8.2-14" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.8.2-15">
<pre>
struct {
  HpkeCiphertext encrypted_aggregate_share;
} AggregateShare;
</pre><a href="#section-4.8.2-15" class="pilcrow">¶</a>
</div>
<p id="section-4.8.2-16"><code>encrypted_aggregate_share.config_id</code> is set to the Collector's HPKE config ID.
<code>encrypted_aggregate_share.enc</code> is set to the encapsulated HPKE context <code>enc</code>
computed above and <code>encrypted_aggregate_share.ciphertext</code> is the ciphertext
<code>encrypted_agg_share</code> computed above.<a href="#section-4.8.2-16" class="pilcrow">¶</a></p>
<p id="section-4.8.2-17">The Helper's handling of this request <span class="bcp14">MUST</span> be idempotent. That is, if multiple
identical, valid <code>AggregateShareReq</code>s are received, they should all yield the
same response.<a href="#section-4.8.2-17" class="pilcrow">¶</a></p>
<p id="section-4.8.2-18">After receiving the Helper's response, the Leader uses the HpkeCiphertext to
finalize a collection job (see <a href="#collect-finalization" class="auto internal xref">Section 4.8.3</a>).<a href="#section-4.8.2-18" class="pilcrow">¶</a></p>
<p id="section-4.8.2-19">Once an <code>AggregateShareReq</code> has been issued for the batch determined by a given
query, it is an error for the Leader to issue any more aggregation jobs for
additional reports that satisfy the query. These reports will be rejected by the
Helper as described in <a href="#input-share-validation" class="auto internal xref">Section 4.7.1.4</a>.<a href="#section-4.8.2-19" class="pilcrow">¶</a></p>
<p id="section-4.8.2-20">Before completing the collection job, the Leader encrypts its aggregate share
under the Collector's HPKE public key as described in
<a href="#aggregate-share-encrypt" class="auto internal xref">Section 4.8.4</a>.<a href="#section-4.8.2-20" class="pilcrow">¶</a></p>
</section>
</div>
<div id="collect-finalization">
<section id="section-4.8.3">
          <h4 id="name-collection-job-finalization">
<a href="#section-4.8.3" class="section-number selfRef">4.8.3. </a><a href="#name-collection-job-finalization" class="section-name selfRef">Collection Job Finalization</a>
          </h4>
<p id="section-4.8.3-1">Once the Collector has received a collection job from the Leader, it can decrypt
the aggregate shares and produce an aggregate result. The Collector decrypts
each aggregate share as described in <a href="#aggregate-share-encrypt" class="auto internal xref">Section 4.8.4</a>. Once the
Collector successfully decrypts all aggregate shares, it unshards the aggregate
shares into an aggregate result using the VDAF's <code>unshard</code> algorithm. In
particular, let <code>leader_agg_share</code> denote the Leader's aggregate share,
<code>helper_agg_share</code> denote the Helper's aggregate share, let <code>report_count</code>
denote the report count sent by the Leader, and let <code>agg_param</code> be the opaque
aggregation parameter. The final aggregate result is computed as follows:<a href="#section-4.8.3-1" class="pilcrow">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-4.8.3-2">
<pre>
agg_result = Vdaf.unshard(agg_param,
                          [leader_agg_share, helper_agg_share],
                          report_count)
</pre><a href="#section-4.8.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="aggregate-share-encrypt">
<section id="section-4.8.4">
          <h4 id="name-aggregate-share-encryption">
<a href="#section-4.8.4" class="section-number selfRef">4.8.4. </a><a href="#name-aggregate-share-encryption" class="section-name selfRef">Aggregate Share Encryption</a>
          </h4>
<p id="section-4.8.4-1">Encrypting an aggregate share <code>agg_share</code> for a given <code>AggregateShareReq</code> is
done as follows:<a href="#section-4.8.4-1" class="pilcrow">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-4.8.4-2">
<pre>
(enc, payload) = SealBase(
    pk,
    "dap-13 aggregate share" || server_role || 0x00,
    agg_share_aad,
    agg_share)
</pre><a href="#section-4.8.4-2" class="pilcrow">¶</a>
</div>
<p id="section-4.8.4-3">where <code>pk</code> is the HPKE public key encoded by the Collector's HPKE key,
<code>server_role</code> is the Role of the encrypting server (<code>0x02</code> for the Leader and
<code>0x03</code> for a Helper), <code>0x00</code> represents the Role of the recipient (always the
Collector), and <code>agg_share_aad</code> is a value of type <code>AggregateShareAad</code>. The
<code>SealBase()</code> function is as specified in <span>[<a href="#HPKE" class="cite xref">HPKE</a>], <a href="https://rfc-editor.org/rfc/rfc9180#section-6.1" class="relref">Section 6.1</a></span> for the
ciphersuite indicated by the HPKE configuration.<a href="#section-4.8.4-3" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.8.4-4">
<pre>
struct {
  TaskID task_id;
  opaque agg_param&lt;0..2^32-1&gt;;
  BatchSelector batch_selector;
} AggregateShareAad;
</pre><a href="#section-4.8.4-4" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-4.8.4-5.1">
              <p id="section-4.8.4-5.1.1"><code>task_id</code> is the ID of the task the aggregate share was computed in.<a href="#section-4.8.4-5.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.8.4-5.2">
              <p id="section-4.8.4-5.2.1"><code>agg_param</code> is the aggregation parameter used to compute the aggregate share.<a href="#section-4.8.4-5.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.8.4-5.3">
              <p id="section-4.8.4-5.3.1"><code>batch_selector</code> is the is the batch selector from the <code>AggregateShareReq</code>
(for the Helper) or the batch selector computed from the Collector's query
(for the Leader).<a href="#section-4.8.4-5.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.8.4-6">The Collector decrypts these aggregate shares using the opposite process.
Specifically, given an encrypted input share, denoted <code>enc_share</code>, for a given
batch selector, decryption works as follows:<a href="#section-4.8.4-6" class="pilcrow">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-4.8.4-7">
<pre>
agg_share = OpenBase(
    enc_share.enc,
    sk,
    "dap-13 aggregate share" || server_role || 0x00,
    agg_share_aad,
    enc_share.payload)
</pre><a href="#section-4.8.4-7" class="pilcrow">¶</a>
</div>
<p id="section-4.8.4-8">where <code>sk</code> is the HPKE secret key, <code>server_role</code> is the Role of the server that
sent the aggregate share (<code>0x02</code> for the Leader and <code>0x03</code> for the Helper),
<code>0x00</code> represents the Role of the recipient (always the Collector), and
<code>agg_share_aad</code> is an <code>AggregateShareAad</code> message constructed from the task ID
and the aggregation parameter in the collect request, and a batch selector. The
value of the batch selector used in <code>agg_share_aad</code> is determined by the batch mode.<a href="#section-4.8.4-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.8.4-9.1">
              <p id="section-4.8.4-9.1.1">For time-interval (<a href="#time-interval-batch-mode" class="auto internal xref">Section 5.1</a>), the batch selector is the
batch interval specified in the query.<a href="#section-4.8.4-9.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.8.4-9.2">
              <p id="section-4.8.4-9.2.1">For leader-selected (<a href="#leader-selected-batch-mode" class="auto internal xref">Section 5.2</a>), the batch selector is
the batch ID sent in the response.<a href="#section-4.8.4-9.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.8.4-10">The <code>OpenBase()</code> function is as specified in <span>[<a href="#HPKE" class="cite xref">HPKE</a>], <a href="https://rfc-editor.org/rfc/rfc9180#section-6.1" class="relref">Section 6.1</a></span> for the
ciphersuite indicated by the HPKE configuration.<a href="#section-4.8.4-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="batch-validation">
<section id="section-4.8.5">
          <h4 id="name-batch-validation">
<a href="#section-4.8.5" class="section-number selfRef">4.8.5. </a><a href="#name-batch-validation" class="section-name selfRef">Batch Validation</a>
          </h4>
<p id="section-4.8.5-1">When the Leader receives a <code>Query</code> in the request from the Collector during
collection initialization (<a href="#collect-init" class="auto internal xref">Section 4.8.1</a>), it must first check that the
batch determined by the query can be collected. It does so as described here.
The Helper performs the same check when it receives a <code>BatchSelector</code> in the
request from the Leader for its aggregate share (<a href="#collect-aggregate" class="auto internal xref">Section 4.8.2</a>).<a href="#section-4.8.5-1" class="pilcrow">¶</a></p>
<p id="section-4.8.5-2">First, the Aggregator checks if the request (the <code>CollectionJobReq</code> for the
Leader and the <code>AggregateShareReq</code> for the Helper) identifies a valid set of
batch buckets (<a href="#batch-buckets" class="auto internal xref">Section 4.7.2.3</a>). If not, it <span class="bcp14">MUST</span> abort the request with
"batchInvalid".<a href="#section-4.8.5-2" class="pilcrow">¶</a></p>
<p id="section-4.8.5-3">Next, the Aggregator checks that batch contains a valid number of reports. The
Aggregator checks that <code>len(X) &gt;= min_batch_size</code>, where <code>X</code> is the set of
reports successfully aggregated into the batch and <code>min_batch_size</code> is the
minimum batch size for the task. If this check fails, then Helpers <span class="bcp14">MUST</span> abort
with an error of type "invalidBatchSize". Leaders <span class="bcp14">SHOULD</span> wait for more reports
to be validated and try the collection job again later.<a href="#section-4.8.5-3" class="pilcrow">¶</a></p>
<p id="section-4.8.5-4">Next, the Aggregator checks that the batch has not been queried with multiple
distinct aggregation parameters. If the batch has been queried with more than
one distinct aggregation parameter, the Aggregator <span class="bcp14">MUST</span> abort with error of type
"batchQueriedMultipleTimes".<a href="#section-4.8.5-4" class="pilcrow">¶</a></p>
<p id="section-4.8.5-5">Next, the Aggregator checks if the set of batch buckets identified by the
request overlaps with the batch buckets that have already been collected. If
so, it <span class="bcp14">MUST</span> abort with "batchOverlap".<a href="#section-4.8.5-5" class="pilcrow">¶</a></p>
<p id="section-4.8.5-6">Finally, the batch mode may define additional batch validation rules.<a href="#section-4.8.5-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="batch-modes">
<section id="section-5">
      <h2 id="name-batch-modes">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-batch-modes" class="section-name selfRef">Batch Modes</a>
      </h2>
<p id="section-5-1">This section defines an initial set of batch modes for DAP. New batch modes may
be defined by future documents following the guidelines in
<a href="#extending-this-doc" class="auto internal xref">Section 10</a>.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">Each batch mode specifies the following:<a href="#section-5-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5-3">
<li id="section-5-3.1">
          <p id="section-5-3.1.1">The value of the <code>config</code> field of <code>Query</code>, <code>PartialBatchSelector</code>, and
<code>BatchSelector</code><a href="#section-5-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-5-3.2">
          <p id="section-5-3.2.1">Batch buckets (<a href="#batch-buckets" class="auto internal xref">Section 4.7.2.3</a>): how reports are assigned to batch
buckets; how each bucket is identified; and how batch buckets are mapped to
batches and how batch buckets<a href="#section-5-3.2.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<div id="time-interval-batch-mode">
<section id="section-5.1">
        <h3 id="name-time-interval">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-time-interval" class="section-name selfRef">Time Interval</a>
        </h3>
<div class="lang-tls-presentation sourcecode" id="section-5.1-1">
<pre>
enum {
  time_interval(1),
  (255)
} BatchMode;
</pre><a href="#section-5.1-1" class="pilcrow">¶</a>
</div>
<p id="section-5.1-2">The time-interval batch mode is designed to support applications in which
reports are collected into batches grouped by an interval of time. The Collector
specifies a "batch interval" that determines the time range for reports included
in the batch. For each report in the batch, the time at which that report was
generated (see <a href="#upload-flow" class="auto internal xref">Section 4.6</a>) <span class="bcp14">MUST</span> fall within the batch interval specified by
the Collector.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1-3">Typically the Collector issues queries for which the batch intervals are
continuous, monotonically increasing, and have the same duration. For example,
the sequence of batch intervals <code>(1659544000, 1000)</code>, <code>(1659545000, 1000)</code>,
<code>(1659546000, 1000)</code>, <code>(1659547000, 1000)</code> satisfies these conditions. (The
first element of the pair denotes the start of the batch interval and the second
denotes the duration.) However, this is not a requirement--the Collector may
decide to issue queries out-of-order. In addition, the Collector may need to
vary the duration to adjust to changing report upload rates.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<div id="query-configuration">
<section id="section-5.1.1">
          <h4 id="name-query-configuration">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-query-configuration" class="section-name selfRef">Query Configuration</a>
          </h4>
<p id="section-5.1.1-1">The payload of <code>Query.config</code> is<a href="#section-5.1.1-1" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-5.1.1-2">
<pre>
struct {
  Interval batch_interval;
} TimeIntervalQueryConfig;
</pre><a href="#section-5.1.1-2" class="pilcrow">¶</a>
</div>
<p id="section-5.1.1-3">where <code>batch_interval</code> is the batch interval requested by the Collector. The
interval <span class="bcp14">MUST</span> be well-formed as specified in <a href="#timestamps" class="auto internal xref">Section 4.5</a>. Otherwise, the
query does not specify a set of valid batch buckets.<a href="#section-5.1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="partial-batch-selector-configuration">
<section id="section-5.1.2">
          <h4 id="name-partial-batch-selector-conf">
<a href="#section-5.1.2" class="section-number selfRef">5.1.2. </a><a href="#name-partial-batch-selector-conf" class="section-name selfRef">Partial Batch Selector Configuration</a>
          </h4>
<p id="section-5.1.2-1">The payload of <code>PartialBatchSelector.config</code> is empty.<a href="#section-5.1.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="batch-selector-configuration">
<section id="section-5.1.3">
          <h4 id="name-batch-selector-configuratio">
<a href="#section-5.1.3" class="section-number selfRef">5.1.3. </a><a href="#name-batch-selector-configuratio" class="section-name selfRef">Batch Selector Configuration</a>
          </h4>
<p id="section-5.1.3-1">The payload of <code>BatchSelector.config</code> is<a href="#section-5.1.3-1" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-5.1.3-2">
<pre>
struct {
  Interval batch_interval;
} TimeIntervalBatchSelectorConfig;
</pre><a href="#section-5.1.3-2" class="pilcrow">¶</a>
</div>
<p id="section-5.1.3-3">where <code>batch_interval</code> is the batch interval requested by the Collector.<a href="#section-5.1.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="time-interval-batch-buckets">
<section id="section-5.1.4">
          <h4 id="name-batch-buckets-2">
<a href="#section-5.1.4" class="section-number selfRef">5.1.4. </a><a href="#name-batch-buckets-2" class="section-name selfRef">Batch Buckets</a>
          </h4>
<p id="section-5.1.4-1">Each batch bucket is identified by an interval of time whose beginning is a
multiple of the task's <code>time_precision</code> and whose duration is equal to the
task's <code>time_precision</code>. The identifier associated with a given report is the
unique such interval containing the timestamp of the report; for example, if
the task's <code>time_precision</code> is 1000 seconds and the report's timestamp is
1729629081, the relevant batch bucket identifier is <code>(1729629000, 1000)</code>. The
first element of the pair denotes the start of the batch interval and the
second denotes the duration.<a href="#section-5.1.4-1" class="pilcrow">¶</a></p>
<p id="section-5.1.4-2">The <code>Query</code> received by the Leader determines a valid set of batch bucket
identifiers if the following conditions hold (likewise for the <code>BatchSelector</code>
received by the Helper):<a href="#section-5.1.4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.4-3.1">
              <p id="section-5.1.4-3.1.1"><code>batch_interval.duration &gt;= time_precision</code> (this field determines,
effectively, the minimum batch duration)<a href="#section-5.1.4-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.4-3.2">
              <p id="section-5.1.4-3.2.1">both <code>batch_interval.start</code> and <code>batch_interval.duration</code> are divisible by
<code>time_precision</code><a href="#section-5.1.4-3.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.1.4-4">A batch consists of a sequence of contiguous batch buckets. That is, the set of
batch buckets identifiers for the batch interval is
<code>(batch_interval.start,
  batch_interval.start + time_precision)</code>,
<code>(batch_interval.start + time_precision,
  batch_interval.start + 2*time_precision)</code>, ...,
<code>(batch_interval.start + batch_interval.duration - time_precision) +
  batch_interval.start + batch_interval.duration)</code>.<a href="#section-5.1.4-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="leader-selected-batch-mode">
<section id="section-5.2">
        <h3 id="name-leader-selected-batch-mode">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-leader-selected-batch-mode" class="section-name selfRef">Leader-selected Batch Mode</a>
        </h3>
<div class="lang-tls-presentation sourcecode" id="section-5.2-1">
<pre>
enum {
  leader_selected(2),
  (255)
} BatchMode;
</pre><a href="#section-5.2-1" class="pilcrow">¶</a>
</div>
<p id="section-5.2-2">The leader-selected batch mode is used to support applications in which it is
acceptable for reports to be batched in an arbitrary fashion by the Leader. Each
batch of reports is identified by an opaque "batch ID". Both the reports
included in each batch and the ID for each batch are allocated in an arbitrary
fashion by the Leader.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2-3">The Collector will not know the set of batch IDs available for collection. To
get the aggregate of a batch, the Collector issues a query, which does not
include any information specifying a particular batch (see <a href="#batch-mode" class="auto internal xref">Section 4.2</a>). The
Leader selects a recent batch to aggregate. The Leader <span class="bcp14">MUST</span> select a batch that
has not yet been associated with a collection job.<a href="#section-5.2-3" class="pilcrow">¶</a></p>
<p id="section-5.2-4">The Aggregators can output batches of any size that is larger than or equal to
<code>min_batch_size</code>. The target batch size, if any, is implementation-specific, and
may be equal to or greater than the minimum batch size. Deciding how soon
batches should be output is also implementation-specific. Exactly sizing batches
may be challenging for Leader deployments in which multiple, independent nodes
running the aggregate interaction (see <a href="#aggregate-flow" class="auto internal xref">Section 4.7</a>) need to be
coordinated.<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<div id="query-configuration-1">
<section id="section-5.2.1">
          <h4 id="name-query-configuration-2">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-query-configuration-2" class="section-name selfRef">Query Configuration</a>
          </h4>
<p id="section-5.2.1-1">They payload of <code>Query.config</code> is empty; the request merely indicates the
Collector would like the next batch selected by the Leader.<a href="#section-5.2.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="partial-batch-selector-configuration-1">
<section id="section-5.2.2">
          <h4 id="name-partial-batch-selector-confi">
<a href="#section-5.2.2" class="section-number selfRef">5.2.2. </a><a href="#name-partial-batch-selector-confi" class="section-name selfRef">Partial Batch Selector Configuration</a>
          </h4>
<p id="section-5.2.2-1">The payload of <code>PartialBatchSelector.config</code> is:<a href="#section-5.2.2-1" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-5.2.2-2">
<pre>
struct {
  BatchID batch_id;
} LeaderSelectedPartialBatchSelectorConfig;
</pre><a href="#section-5.2.2-2" class="pilcrow">¶</a>
</div>
<p id="section-5.2.2-3">where <code>batch_id</code> is the batch ID selected by the Leader.<a href="#section-5.2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="batch-selector-configuration-1">
<section id="section-5.2.3">
          <h4 id="name-batch-selector-configuration">
<a href="#section-5.2.3" class="section-number selfRef">5.2.3. </a><a href="#name-batch-selector-configuration" class="section-name selfRef">Batch Selector Configuration</a>
          </h4>
<p id="section-5.2.3-1">The payload of <code>BatchSelector.config</code> is:<a href="#section-5.2.3-1" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-5.2.3-2">
<pre>
struct {
  BatchID batch_id;
} LeaderSelectedBatchSelectorConfig;
</pre><a href="#section-5.2.3-2" class="pilcrow">¶</a>
</div>
<p id="section-5.2.3-3">where <code>batch_id</code> is the batch ID selected by the Leader.<a href="#section-5.2.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="leader-selected-batch-buckets">
<section id="section-5.2.4">
          <h4 id="name-batch-buckets-3">
<a href="#section-5.2.4" class="section-number selfRef">5.2.4. </a><a href="#name-batch-buckets-3" class="section-name selfRef">Batch Buckets</a>
          </h4>
<p id="section-5.2.4-1">Each batch consists of a single bucket and is identified by the batch ID
selected by the Leader. A report is assigned to the batch indicated by the
<code>PartialBatchSelector</code> during aggregation.<a href="#section-5.2.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="operational-capabilities">
<section id="section-6">
      <h2 id="name-operational-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-operational-considerations" class="section-name selfRef">Operational Considerations</a>
      </h2>
<p id="section-6-1">The DAP protocol has inherent constraints derived from the tradeoff between
privacy guarantees and computational complexity. These tradeoffs influence how
applications may choose to utilize services implementing the specification.<a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="entity-capabilities">
<section id="section-6.1">
        <h3 id="name-protocol-participant-capabi">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-protocol-participant-capabi" class="section-name selfRef">Protocol Participant Capabilities</a>
        </h3>
<p id="section-6.1-1">The design in this document has different assumptions and requirements for
different protocol participants, including Clients, Aggregators, and Collectors.
This section describes these capabilities in more detail.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<div id="client-capabilities">
<section id="section-6.1.1">
          <h4 id="name-client-capabilities">
<a href="#section-6.1.1" class="section-number selfRef">6.1.1. </a><a href="#name-client-capabilities" class="section-name selfRef">Client Capabilities</a>
          </h4>
<p id="section-6.1.1-1">Clients have limited capabilities and requirements. Their only inputs to the
protocol are (1) the parameters configured out of band and (2) a measurement.
Clients are not expected to store any state across any upload flows, nor are
they required to implement any sort of report upload retry mechanism. By design,
the protocol in this document is robust against individual Client upload
failures since the protocol output is an aggregate over all inputs.<a href="#section-6.1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aggregator-capabilities">
<section id="section-6.1.2">
          <h4 id="name-aggregator-capabilities">
<a href="#section-6.1.2" class="section-number selfRef">6.1.2. </a><a href="#name-aggregator-capabilities" class="section-name selfRef">Aggregator Capabilities</a>
          </h4>
<p id="section-6.1.2-1">Leaders and Helpers have different operational requirements. The design in this
document assumes an operationally competent Leader, i.e., one that has no
storage or computation limitations or constraints, but only a modestly
provisioned Helper, i.e., one that has computation, bandwidth, and storage
constraints. By design, Leaders must be at least as capable as Helpers, where
Helpers are generally required to:<a href="#section-6.1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1.2-2.1">
              <p id="section-6.1.2-2.1.1">Support the aggregate interaction, which includes validating and aggregating
reports; and<a href="#section-6.1.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-6.1.2-2.2">
              <p id="section-6.1.2-2.2.1">Publish and manage an HPKE configuration that can be used for the upload
interaction.<a href="#section-6.1.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-6.1.2-3">In addition, for each DAP task, the Helper is required to:<a href="#section-6.1.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1.2-4.1">
              <p id="section-6.1.2-4.1.1">Implement some form of batch-to-report index, as well as inter- and
intra-batch replay mitigation storage, which includes some way of tracking
batch report size. Some of this state may be used for replay attack
mitigation. The replay mitigation strategy is described in
<a href="#input-share-validation" class="auto internal xref">Section 4.7.1.4</a>.<a href="#section-6.1.2-4.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-6.1.2-5">Beyond the minimal capabilities required of Helpers, Leaders are generally
required to:<a href="#section-6.1.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1.2-6.1">
              <p id="section-6.1.2-6.1.1">Support the upload interaction and store reports; and<a href="#section-6.1.2-6.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-6.1.2-6.2">
              <p id="section-6.1.2-6.2.1">Track batch report size during each collect flow and request encrypted output
shares from Helpers.<a href="#section-6.1.2-6.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-6.1.2-7">In addition, for each DAP task, the Leader is required to:<a href="#section-6.1.2-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1.2-8.1">
              <p id="section-6.1.2-8.1.1">Implement and store state for the form of inter- and intra-batch replay
mitigation in <a href="#agg-flow" class="auto internal xref">Figure 2</a>. This requires storing the report IDs of all
reports processed for a given task. Implementations may find it helpful to
track additional information, like the timestamp, so that the storage used
for anti-replay can be sharded efficiently.<a href="#section-6.1.2-8.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="collector-capabilities">
<section id="section-6.1.3">
          <h4 id="name-collector-capabilities">
<a href="#section-6.1.3" class="section-number selfRef">6.1.3. </a><a href="#name-collector-capabilities" class="section-name selfRef">Collector Capabilities</a>
          </h4>
<p id="section-6.1.3-1">Collectors statefully interact with Aggregators to produce an aggregate output.
Their input to the protocol is the task parameters, configured out of band,
which include the corresponding batch window and size. For each collect
invocation, Collectors are required to keep state from the start of the protocol
to the end as needed to produce the final aggregate output.<a href="#section-6.1.3-1" class="pilcrow">¶</a></p>
<p id="section-6.1.3-2">Collectors must also maintain state for the lifetime of each task, which
includes key material associated with the HPKE key configuration.<a href="#section-6.1.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="vdafs-and-compute-requirements">
<section id="section-6.2">
        <h3 id="name-vdafs-and-compute-requireme">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-vdafs-and-compute-requireme" class="section-name selfRef">VDAFs and Compute Requirements</a>
        </h3>
<p id="section-6.2-1">The choice of VDAF can impact the computation and storage required for a DAP
task:<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2-2.1">
            <p id="section-6.2-2.1.1">The runtime of VDAF sharding and preparation is related to the "size" of the
underlying measurements. For example, the Prio3SumVec VDAF defined in
<span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-7" class="relref">Section 7</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span> requires each measurement to be a vector of the same
length, which all parties need to agree on prior to VDAF execution. The
computation required for such tasks increases linearly as a function of the
chosen length, as each vector element must be processed in turn.<a href="#section-6.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.2-2.2">
            <p id="section-6.2-2.2.1">The runtime of VDAF preparation is related to the size of the aggregation
parameter. For example for Poplar1 defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-8" class="relref">Section 8</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>,
preparation takes as input a sequence of so-called "candidate prefixes", and
the amount of computation is linear in the number of prefixes.<a href="#section-6.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.2-2.3">
            <p id="section-6.2-2.3.1">The storage requirements for aggregate shares vary depending on the size of
the measurements and/or the aggregation parameter.<a href="#section-6.2-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-6.2-3">To account for these factors, care must be taken that a DAP deployment can
handle VDAF execution of all possible configurations for any tasks which the
deployment may be configured for. Otherwise, an attacker may deny service by
uploading many expensive reports to a suitably-configured VDAF.<a href="#section-6.2-3" class="pilcrow">¶</a></p>
<p id="section-6.2-4">The varying cost of VDAF computation means that Aggregators should negotiate
reasonable limits for each VDAF configuration, out of band with the protocol.
For example, Aggregators may agree on a maximum size for an aggregation job or
on a maximum rate of incoming reports.<a href="#section-6.2-4" class="pilcrow">¶</a></p>
<p id="section-6.2-5">Applications which require computationally-expensive VDAFs can mitigate the
computation cost of aggregation in a few ways, such as producing aggregates over
a sample of the data or choosing a representation of the data permitting a
simpler aggregation scheme.<a href="#section-6.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aggregation-utility-and-soft-batch-deadlines">
<section id="section-6.3">
        <h3 id="name-aggregation-utility-and-sof">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-aggregation-utility-and-sof" class="section-name selfRef">Aggregation Utility and Soft Batch Deadlines</a>
        </h3>
<p id="section-6.3-1">A soft real-time system should produce a response within a deadline to be
useful. This constraint may be relevant when the value of an aggregate decreases
over time. A missed deadline can reduce an aggregate's utility but not
necessarily cause failure in the system.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">An example of a soft real-time constraint is the expectation that input data can
be verified and aggregated in a period equal to data collection, given some
computational budget. Meeting these deadlines will require efficient
implementations of the VDAF. Applications might batch requests or utilize more
efficient serialization to improve throughput.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<p id="section-6.3-3">Some applications may be constrained by the time that it takes to reach a
privacy threshold defined by a minimum number of reports. One possible solution
is to increase the reporting period so more samples can be collected, balanced
against the urgency of responding to a soft deadline.<a href="#section-6.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="protocol-specific-optimizations">
<section id="section-6.4">
        <h3 id="name-protocol-specific-optimizat">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-protocol-specific-optimizat" class="section-name selfRef">Protocol-specific Optimizations</a>
        </h3>
<p id="section-6.4-1">Not all DAP tasks have the same operational requirements, so the protocol is
designed to allow implementations to reduce operational costs in certain cases.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
<div id="sharding-storage">
<section id="section-6.4.1">
          <h4 id="name-reducing-storage-requiremen">
<a href="#section-6.4.1" class="section-number selfRef">6.4.1. </a><a href="#name-reducing-storage-requiremen" class="section-name selfRef">Reducing Storage Requirements</a>
          </h4>
<p id="section-6.4.1-1">In general, the Aggregators are required to keep state for tasks and all valid
reports for as long as collection requests can be made for them. However, it is
not necessary to store the complete reports. Each Aggregator only needs to
store an aggregate share for each possible batch bucket i.e., the batch
interval for time-interval or batch ID for leader-selected, along with a flag
indicating whether the aggregate share has been collected. This is due to the
requirement for queries to respect bucket boundaries. See <a href="#batch-validation" class="auto internal xref">Section 4.8.5</a>.<a href="#section-6.4.1-1" class="pilcrow">¶</a></p>
<p id="section-6.4.1-2">However, Aggregators are also required to implement several per-report checks
that require retaining a number of data artifacts. For example, to detect replay
attacks, it is necessary for each Aggregator to retain the set of report IDs of
reports that have been aggregated for the task so far. Depending on the task
lifetime and report upload rate, this can result in high storage costs. To
alleviate this burden, DAP allows Aggregators to drop this state as needed, so
long as reports are dropped properly as described in <a href="#input-share-validation" class="auto internal xref">Section 4.7.1.4</a>.
Aggregators <span class="bcp14">SHOULD</span> take steps to mitigate the risk of dropping reports (e.g., by
evicting the oldest data first).<a href="#section-6.4.1-2" class="pilcrow">¶</a></p>
<p id="section-6.4.1-3">Furthermore, the Aggregators must store data related to a task as long as the
current time has not passed this task's end time <code>task_start + task_duration</code>.
Aggregator <span class="bcp14">MAY</span> delete the task and all data pertaining to this task after the
end time. Implementors <span class="bcp14">SHOULD</span> provide for some leeway so the Collector can
collect the batch after some delay.<a href="#section-6.4.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="distributed-systems">
<section id="section-6.4.2">
          <h4 id="name-distributed-systems-and-syn">
<a href="#section-6.4.2" class="section-number selfRef">6.4.2. </a><a href="#name-distributed-systems-and-syn" class="section-name selfRef">Distributed-systems and Synchronization Concerns</a>
          </h4>
<p id="section-6.4.2-1">Various parts of a DAP implementation will need to synchronize in order to
ensure correctness during concurrent operation. This section describes the
relevant concerns and makes suggestions as to potential implementation
tradeoffs.<a href="#section-6.4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.4.2-2.1">
              <p id="section-6.4.2-2.1.1">The upload interaction requires the Leader to ignore uploaded reports with a
duplicated ID, including concurrently-uploaded reports. This might be
implemented by synchronization or via an eventually-consistent process. If the
Leader wishes to alert the Client with a <code>reportRejected</code> error,
synchronization will be necessary to ensure all but one concurrent request
receive the error.<a href="#section-6.4.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-6.4.2-2.2">
              <p id="section-6.4.2-2.2.1">The Leader is responsible for generating aggregation jobs, and will generally
want to place each report in exactly one aggregation job. (The only event in
which a Leader will want to place a report in multiple aggregation jobs is if
the Helper rejects the report with <code>report_too_early</code>, in which case the
Leader can place the report into a later aggregation job.) This may require
synchronization between different components of the system which are
generating aggregation jobs. Note that placing a report into more than one
aggregation job will result in a loss of throughput, rather than a loss of
correctness, privacy, or robustness, so it is acceptable for implementations
to use an eventually-consistent scheme which may rarely place a report into
multiple aggregation jobs.<a href="#section-6.4.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-6.4.2-2.3">
              <p id="section-6.4.2-2.3.1">Aggregation is implemented as a sequence of aggregation steps by both the
Leader and the Helper. The Leader must ensure that each aggregation job is
only processed once concurrently, which may require synchronization between
the components responsible for performing aggregation. The Helper must ensure
that concurrent requests against the same aggregation job are handled
appropriately, which requires synchronization between the components handling
aggregation requests.<a href="#section-6.4.2-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-6.4.2-2.4">
              <p id="section-6.4.2-2.4.1">Aggregation requires checking and updating used-report storage as part of
implementing replay protection. This must be done while processing the
aggregation job, though which steps the checks are performed at is up to the
implementation. The checks and storage require synchronization, so that if two
aggregation jobs contianing the same report are processed, at most one
instance of the report will be aggregated. However, the interaction with the
used-report storage does not necessarily have to be synchronized with the
processing and storage for the remainder of the aggregation process. For
example, used-report storage could be implemented in a separate datastore than
is used for the remainder of data storage, without any transactionality
between updates to the two datastores.<a href="#section-6.4.2-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-6.4.2-2.5">
              <p id="section-6.4.2-2.5.1">The aggregation and collection interactions require synchronization to avoid
modifying the aggregate of a batch after it has already been collected. Any
reports being aggregated which pertain to a batch which has already been
collected must fail with a <code>batch_collected</code> error; correctly determining this
requires synchronizing aggregation with the completion of collection jobs (for
the Leader) or aggregate share requests (for the Helper). Also, the Leader
must complete all outstanding aggregation jobs for a batch before requesting
aggregate shares from the Helper, again requiring synchronization between the
Leader's collection and aggregation interactions. Further, the Helper must
determine the aggregated report count and checksum of aggregated report IDs
before responding to an aggregate share request, requiring synchronization
between the Helper's collection and aggregation interactions.<a href="#section-6.4.2-2.5.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="compliance">
<section id="section-7">
      <h2 id="name-compliance-requirements">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-compliance-requirements" class="section-name selfRef">Compliance Requirements</a>
      </h2>
<p id="section-7-1">In the absence of an application or deployment-specific profile specifying
otherwise, a compliant DAP application <span class="bcp14">MUST</span> implement the following HPKE cipher
suite:<a href="#section-7-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-2.1">
          <p id="section-7-2.1.1">KEM: DHKEM(X25519, HKDF-SHA256) (see <span>[<a href="#HPKE" class="cite xref">HPKE</a>], <a href="https://rfc-editor.org/rfc/rfc9180#section-7.1" class="relref">Section 7.1</a></span>)<a href="#section-7-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-2.2">
          <p id="section-7-2.2.1">KDF: HKDF-SHA256 (see <span>[<a href="#HPKE" class="cite xref">HPKE</a>], <a href="https://rfc-editor.org/rfc/rfc9180#section-7.2" class="relref">Section 7.2</a></span>)<a href="#section-7-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-2.3">
          <p id="section-7-2.3.1">AEAD: AES-128-GCM (see <span>[<a href="#HPKE" class="cite xref">HPKE</a>], <a href="https://rfc-editor.org/rfc/rfc9180#section-7.3" class="relref">Section 7.3</a></span>)<a href="#section-7-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="sec-considerations">
<section id="section-8">
      <h2 id="name-security-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-8-1">DAP aims to achieve the privacy and robustness security goals defined in
<span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14#section-9" class="relref">Section 9</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>, even in the presence of an active attacker. It is
assumed that the attacker may control the network and have the ability to
control a subset of of Clients, one of the Aggregators, and the Collector for a
given task.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">In the presence of this adversary, there are some threats DAP does not defend
against and which are considered outside of DAP's threat model. These are
enumerated below, along with potential mitigations.<a href="#section-8-2" class="pilcrow">¶</a></p>
<p id="section-8-3">Attacks on robustness:<a href="#section-8-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8-4">
<li id="section-8-4.1">
          <p id="section-8-4.1.1">Aggregators can defeat robustness by emitting incorrect aggregate shares, by
omitting reports from the aggregation process, or by manipulating the VDAF
preparation process for a single report. DAP follows VDAF in providing
robustness only if both Aggregators honestly follow the protocol.<a href="#section-8-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-8-4.2">
          <p id="section-8-4.2.1">Clients may affect the quality of aggregate results by reporting false
measurements. A VDAF can only verify that a submitted measurement is valid,
not that it is true.<a href="#section-8-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-8-4.3">
          <p id="section-8-4.3.1">An attacker can impersonate multiple Clients, or a single malicious Client
can upload an unexpectedly-large number of reports, in order to skew
aggregate results or to reduce the number of measurements from honest Clients
in a batch below the minimum batch size. See <a href="#sybil" class="auto internal xref">Section 8.1</a> for discussion and
potential mitigations.<a href="#section-8-4.3.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-8-5">Attacks on privacy:<a href="#section-8-5" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8-6">
<li id="section-8-6.1">
          <p id="section-8-6.1.1">Clients can intentionally leak their own measurements and compromise their
own privacy.<a href="#section-8-6.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-8-6.2">
          <p id="section-8-6.2.1">Both Aggregators together can, purposefully or accidentally, share
unencrypted input shares in order to defeat the privacy of individual
reports. DAP follows VDAF in providing privacy only if at least one
Aggregator honestly follows the protocol.<a href="#section-8-6.2.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-8-7">Attacks on other properties of the system:<a href="#section-8-7" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8-8">
<li id="section-8-8.1">
          <p id="section-8-8.1.1">Both Aggregators together can, purposefully or accidentally, share
unencrypted aggregate shares in order to reveal the aggregation result for a
given batch.<a href="#section-8-8.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-8-8.2">
          <p id="section-8-8.2.1">Aggregators, or a passive network attacker between the Clients and the
Leader, can examine metadata such as HTTP client IP in order to infer which
Clients are submitting reports. Depending on the particulars of the
deployment, this may be used to infer sensitive information about the Client.
This can be mitigated for the Aggregator by deploying an anonymizing proxy
(see <a href="#anon-proxy" class="auto internal xref">Section 8.4</a>), or in general by requiring Clients to submit reports at
regular intervals independently of the measurement value such that the
existence of a report does not imply the occurrence of a sensitive event.<a href="#section-8-8.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-8-8.3">
          <p id="section-8-8.3.1">Aggregators can deny service by refusing to respond to collection requests or
aggregate share requests.<a href="#section-8-8.3.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-8-8.4">
          <p id="section-8-8.4.1">Some VDAFs could leak information to either Aggregator or the Collector
beyond what the protocol intended to learn. It may be possible to mitigate
such leakages using differential privacy (<a href="#dp" class="auto internal xref">Section 8.5</a>).<a href="#section-8-8.4.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<div id="sybil">
<section id="section-8.1">
        <h3 id="name-sybil-attacks">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-sybil-attacks" class="section-name selfRef">Sybil Attacks</a>
        </h3>
<p id="section-8.1-1">Several attacks on privacy or robustness involve malicious Clients uploading
reports that are valid under the chosen VDAF but incorrect.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">For example, a DAP deployment might be measuring the heights of a human
population and configure a variant of Prio3 to prove that measurements are
values in the range of 80-250 cm. A malicious Client would not be able to claim
a height of 400 cm, but they could submit multiple bogus reports inside the
acceptable range, which would yield incorrect averages. More generally, DAP
deployments are susceptible to Sybil attacks <span>[<a href="#Dou02" class="cite xref">Dou02</a>]</span>, especially when carried
out by the Leader.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
<p id="section-8.1-3">In this type of attack, the adversary adds to a batch a number of reports that
skew the aggregate result in its favor. For example, sending known measurements
to the Aggregators can allow a Collector to shrink the effective anonymity set
by subtracting the known measurements from the aggregate result. The result may
reveal additional information about the honest measurements, leading to a
privacy violation; or the result may have some property that is desirable to the
adversary ("stats poisoning").<a href="#section-8.1-3" class="pilcrow">¶</a></p>
<p id="section-8.1-4">Depending on the deployment and the specific threat being mitigated, there are
different ways to address Sybil attacks, such as:<a href="#section-8.1-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8.1-5">
<li id="section-8.1-5.1">
            <p id="section-8.1-5.1.1">Implementing Client authentication, as described in <a href="#client-auth" class="auto internal xref">Section 8.3</a>, likely
paired with rate-limiting uploads from individual Clients.<a href="#section-8.1-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-8.1-5.2">
            <p id="section-8.1-5.2.1">Removing Client-specific metadata on individual reports, such as through the
use of anonymizing proxies in the upload flow, as described in
<a href="#anon-proxy" class="auto internal xref">Section 8.4</a>.<a href="#section-8.1-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-8.1-5.3">
            <p id="section-8.1-5.3.1">Some mechanisms for differential privacy (<a href="#dp" class="auto internal xref">Section 8.5</a>) can help mitigate Sybil
attacks against privacy to some extent.<a href="#section-8.1-5.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
</section>
</div>
<div id="batch-selection">
<section id="section-8.2">
        <h3 id="name-batch-selection-attacks">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-batch-selection-attacks" class="section-name selfRef">Batch-selection Attacks</a>
        </h3>
<p id="section-8.2-1">Depending on the batch mode, the privacy of an individual Client may be
infringed upon by selection of the batch. For example, in the leader-selected
batch mode, the Leader is free to select the reports that compose a given batch
almost arbitrarily; a malicious Leader might choose a batch composed of reports
arriving from a single client. The aggregate derived from this batch might then
reveal information about that Client.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">The mitigations for this attack are similar to those used for Sybil attacks
(<a href="#sybil" class="auto internal xref">Section 8.1</a>):<a href="#section-8.2-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8.2-3">
<li id="section-8.2-3.1">
            <p id="section-8.2-3.1.1">Implementing Client authentication, as described in <a href="#client-auth" class="auto internal xref">Section 8.3</a>, and
having each aggregator verify that each batch contains reports from a
suitable number of distinct clients.<a href="#section-8.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-8.2-3.2">
            <p id="section-8.2-3.2.1">Disassociating each report from the Client which generated it, via the use of
anonymizing proxies (<a href="#anon-proxy" class="auto internal xref">Section 8.4</a>) or similar techniques.<a href="#section-8.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-8.2-3.3">
            <p id="section-8.2-3.3.1">Differential privacy (<a href="#dp" class="auto internal xref">Section 8.5</a>) can help mitigate the impact of this attack.<a href="#section-8.2-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-8.2-3.4">
            <p id="section-8.2-3.4.1">Deployment-specific mitigations may also be possible: for example, if every
Client is sending reports at a given rate, it may be possible for aggregators
to bound the accepted age of reports such that the number of aggregatable
reports from a given Client is small enough to effectively mitigate this
attack.<a href="#section-8.2-3.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
</section>
</div>
<div id="client-auth">
<section id="section-8.3">
        <h3 id="name-client-authentication">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-client-authentication" class="section-name selfRef">Client Authentication</a>
        </h3>
<p id="section-8.3-1">In settings where it is practical for each Client to have an identity
provisioned (e.g., a user logged into a backend service or a hardware device
programmed with an identity), Client authentication can help Aggregators (or an
authenticating proxy deployed between Clients and the Aggregators; see
<a href="#anon-proxy" class="auto internal xref">Section 8.4</a>) ensure that all reports come from authentic Clients. Note that
because the Helper never handles messages directly from the Clients, reports
would need to include an extension (<a href="#report-extensions" class="auto internal xref">Section 4.6.3</a>) to convey
authentication information to the Helper. For example, a deployment might
include a Privacy Pass token (<span>[<a href="#I-D.draft-ietf-privacypass-architecture-16" class="cite xref">I-D.draft-ietf-privacypass-architecture-16</a>]</span>)
in a report extension to allow both Aggregators to independently verify the
Client's identity.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">However, in some deployments, it will not be practical to require Clients to
authenticate, so Client authentication is not mandatory in DAP. For example, a
widely distributed application that does not require its users to log in to any
service has no obvious way to authenticate its report uploads.<a href="#section-8.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="anon-proxy">
<section id="section-8.4">
        <h3 id="name-anonymizing-proxies">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-anonymizing-proxies" class="section-name selfRef">Anonymizing Proxies</a>
        </h3>
<p id="section-8.4-1">Client reports may be transmitted alongside auxiliary information such as
source IP, HTTP user agent, or Client authentication information (in
deployments which use it, see <a href="#client-auth" class="auto internal xref">Section 8.3</a>). This metadata can be used by
Aggregators to identify participating Clients or permit some attacks on
robustness. This auxiliary information can be removed by having Clients submit
reports to an anonymizing proxy server which would then use Oblivious HTTP
<span>[<a href="#RFC9458" class="cite xref">RFC9458</a>]</span> to forward reports to the DAP Leader. In this scenario, Client
authentication would be performed by the proxy rather than any of the
participants in the DAP protocol.<a href="#section-8.4-1" class="pilcrow">¶</a></p>
<p id="section-8.4-2">The report itself may contain deanonmyizing information that cannot be removed
by a proxy:<a href="#section-8.4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.4-3.1">
            <p id="section-8.4-3.1.1">The report timestamp indicates when a report was generated and may help an
attacker to deduce which Client generated it. Truncating this timestamp as
described in <a href="#timestamps" class="auto internal xref">Section 4.5</a> can help.<a href="#section-8.4-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.4-3.2">
            <p id="section-8.4-3.2.1">The public extensions may help the attacker to profile the Client's
configuration.<a href="#section-8.4-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="dp">
<section id="section-8.5">
        <h3 id="name-differential-privacy">
<a href="#section-8.5" class="section-number selfRef">8.5. </a><a href="#name-differential-privacy" class="section-name selfRef">Differential Privacy</a>
        </h3>
<p id="section-8.5-1">DAP deployments can choose to ensure their aggregate results achieve
differential privacy (<span>[<a href="#Vad16" class="cite xref">Vad16</a>]</span>). A simple approach would require the
Aggregators to add two-sided noise (e.g. sampled from a two-sided geometric
distribution) to aggregate shares. Since each Aggregator is adding noise
independently, privacy can be guaranteed even if all but one of the Aggregators
is malicious. Differential privacy is a strong privacy definition, and protects
users in extreme circumstances: even if an adversary has prior knowledge of
every measurement in a batch except for one, that one measurement is still
formally protected.<a href="#section-8.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="task-parameters">
<section id="section-8.6">
        <h3 id="name-task-parameters">
<a href="#section-8.6" class="section-number selfRef">8.6. </a><a href="#name-task-parameters" class="section-name selfRef">Task Parameters</a>
        </h3>
<p id="section-8.6-1">Distribution of DAP task parameters is out of band from DAP itself and thus not
discussed in this document. This section examines the security tradeoffs
involved in the selection of the DAP task parameters. Generally, attacks
involving crafted DAP task parameters can be mitigated by having the Aggregators
refuse shared parameters that are trivially insecure (e.g., a minimum batch size
of 1 report).<a href="#section-8.6-1" class="pilcrow">¶</a></p>
<div id="verification-key">
<section id="section-8.6.1">
          <h4 id="name-vdaf-verification-key-requi">
<a href="#section-8.6.1" class="section-number selfRef">8.6.1. </a><a href="#name-vdaf-verification-key-requi" class="section-name selfRef">VDAF Verification Key Requirements</a>
          </h4>
<p id="section-8.6.1-1">Knowledge of the verification key would allow a Client to forge a report with
invalid values that will nevertheless pass verification. Therefore, the
verification key must be kept secret from Clients.<a href="#section-8.6.1-1" class="pilcrow">¶</a></p>
<p id="section-8.6.1-2">Furthermore, for a given report, it may be possible to craft a verification key
which leaks information about that report's measurement during VDAF preparation.
Therefore, the verification key for a task <span class="bcp14">SHOULD</span> be chosen before any reports
are generated. Moreover, it <span class="bcp14">SHOULD</span> be fixed for the lifetime of the task and not
be rotated. One way to ensure that the verification key is generated
independently from any given report is to derive the key based on the task ID
and some previously agreed upon secret (verify_key_seed) between Aggregators, as
follows:<a href="#section-8.6.1-2" class="pilcrow">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-8.6.1-3">
<pre>
verify_key = HKDF-Expand(
    HKDF-Extract(
        "verify_key",    # salt
        verify_key_seed, # IKM
    ),
    task_id,             # info
    VERIFY_KEY_SIZE,     # L
)
</pre><a href="#section-8.6.1-3" class="pilcrow">¶</a>
</div>
<p id="section-8.6.1-4">Here, VERIFY_KEY_SIZE is the length of the verification key, and HKDF-Extract
and HKDF-Expand are as defined in <span>[<a href="#RFC5869" class="cite xref">RFC5869</a>]</span>.<a href="#section-8.6.1-4" class="pilcrow">¶</a></p>
<p id="section-8.6.1-5">This requirement comes from current security analysis for existing VDAFs. In
particular, the security proofs for Prio3 require that the verification key is
chosen independently of the generated reports.<a href="#section-8.6.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="batch-parameters">
<section id="section-8.6.2">
          <h4 id="name-batch-parameters">
<a href="#section-8.6.2" class="section-number selfRef">8.6.2. </a><a href="#name-batch-parameters" class="section-name selfRef">Batch Parameters</a>
          </h4>
<p id="section-8.6.2-1">An important parameter of a DAP deployment is the minimum batch size. If a batch
includes too few reports, then the aggregate result can reveal information
about individual measurements. Aggregators enforce the agreed-upon minimum
batch size during collection, but implementations <span class="bcp14">SHOULD</span> also opt out of
participating in a DAP task if the minimum batch size is too small. This
document does not specify how to choose an appropriate minimum batch size, but
an appropriate value may be determined from the differential privacy (<a href="#dp" class="auto internal xref">Section 8.5</a>)
parameters in use, if any.<a href="#section-8.6.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="task-configuration-agreement-and-consistency">
<section id="section-8.6.3">
          <h4 id="name-task-configuration-agreemen">
<a href="#section-8.6.3" class="section-number selfRef">8.6.3. </a><a href="#name-task-configuration-agreemen" class="section-name selfRef">Task Configuration Agreement and Consistency</a>
          </h4>
<p id="section-8.6.3-1">In order to execute a DAP task, it is necessary for all parties to ensure they
agree on the configuration of the task. However, it is possible for a party to
participate in the execution of DAP without knowing all of the task's
parameters. For example, a Client can upload a report (<a href="#upload-flow" class="auto internal xref">Section 4.6</a>) without
knowing the minimum batch size that is enforced by the Aggregators during
collection (<a href="#collect-flow" class="auto internal xref">Section 4.8</a>).<a href="#section-8.6.3-1" class="pilcrow">¶</a></p>
<p id="section-8.6.3-2">Depending on the deployment model, agreement can require that task parameters
are visible to all parties such that each party can choose whether to
participate based on the value of any parameter. This includes the parameters
enumerated in <a href="#task-configuration" class="auto internal xref">Section 4.3</a> and any additional parameters implied by
report extensions <a href="#report-extensions" class="auto internal xref">Section 4.6.3</a> used by the task. Since meaningful
privacy requires that multiple Clients contribute to a task, they should also
share a consistent view of the task configuration.<a href="#section-8.6.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="infrastructure-diversity">
<section id="section-8.7">
        <h3 id="name-infrastructure-diversity">
<a href="#section-8.7" class="section-number selfRef">8.7. </a><a href="#name-infrastructure-diversity" class="section-name selfRef">Infrastructure Diversity</a>
        </h3>
<p id="section-8.7-1">DAP deployments should ensure that Aggregators do not have common dependencies
that would enable a single vendor to reassemble measurements. For example, if
all participating Aggregators stored unencrypted input shares on the same cloud
object storage service, then that cloud vendor would be able to reassemble all
the input shares and defeat privacy.<a href="#section-8.7-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana">
<section id="section-9">
      <h2 id="name-iana-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-9-1">This document requests registry of new media types (<a href="#iana-media-types" class="auto internal xref">Section 9.1</a>),
creation of new codepoint registries (<a href="#iana-codepoints" class="auto internal xref">Section 9.2</a>), and registration of
an IETF URN sub-namespace (<a href="#urn-space" class="auto internal xref">Section 9.3</a>).<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">(RFC EDITOR: In the remainder of this section, replace "RFC XXXX" with the RFC
number assigned to this document.)<a href="#section-9-2" class="pilcrow">¶</a></p>
<div id="iana-media-types">
<section id="section-9.1">
        <h3 id="name-protocol-message-media-type">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-protocol-message-media-type" class="section-name selfRef">Protocol Message Media Types</a>
        </h3>
<p id="section-9.1-1">This specification defines the following protocol messages, along with their
corresponding media types types:<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.1-2.1">
            <p id="section-9.1-2.1.1">HpkeConfigList <a href="#hpke-config" class="auto internal xref">Section 4.6.1</a>: "application/dap-hpke-config-list"<a href="#section-9.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.1-2.2">
            <p id="section-9.1-2.2.1">Report <a href="#upload-request" class="auto internal xref">Section 4.6.2</a>: "application/dap-report"<a href="#section-9.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.1-2.3">
            <p id="section-9.1-2.3.1">AggregationJobInitReq <a href="#leader-init" class="auto internal xref">Section 4.7.1.1</a>: "application/dap-aggregation-job-init-req"<a href="#section-9.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.1-2.4">
            <p id="section-9.1-2.4.1">AggregationJobResp <a href="#aggregation-helper-init" class="auto internal xref">Section 4.7.1.2</a>: "application/dap-aggregation-job-resp"<a href="#section-9.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.1-2.5">
            <p id="section-9.1-2.5.1">AggregationJobContinueReq <a href="#aggregation-leader-continuation" class="auto internal xref">Section 4.7.2.1</a>: "application/dap-aggregation-job-continue-req"<a href="#section-9.1-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.1-2.6">
            <p id="section-9.1-2.6.1">AggregateShareReq <a href="#collect-aggregate" class="auto internal xref">Section 4.8.2</a>: "application/dap-aggregate-share-req"<a href="#section-9.1-2.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.1-2.7">
            <p id="section-9.1-2.7.1">AggregateShare <a href="#collect-aggregate" class="auto internal xref">Section 4.8.2</a>: "application/dap-aggregate-share"<a href="#section-9.1-2.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.1-2.8">
            <p id="section-9.1-2.8.1">CollectionJobReq <a href="#collect-init" class="auto internal xref">Section 4.8.1</a>: "application/dap-collection-job-req"<a href="#section-9.1-2.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.1-2.9">
            <p id="section-9.1-2.9.1">CollectionJobResp <a href="#collect-init" class="auto internal xref">Section 4.8.1</a>: "application/dap-collection-job-resp"<a href="#section-9.1-2.9.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-9.1-3">Protocol message format evolution is supported through the definition of new
formats that are identified by new media types. The messages above are specific
to this specification. When a new major enhancement is proposed that results in
newer IETF specification for DAP, a new set of media types will be defined. In
other words, newer versions of DAP will not be backward compatible with this
version of DAP.<a href="#section-9.1-3" class="pilcrow">¶</a></p>
<p id="section-9.1-4">(RFC EDITOR: Remove this paragraph.) HTTP requests with DAP media types <span class="bcp14">MAY</span>
express an optional parameter 'version', following <span><a href="https://rfc-editor.org/rfc/rfc9110#section-8.3" class="relref">Section 8.3</a> of [<a href="#RFC9110" class="cite xref">RFC9110</a>]</span>.
Value of this parameter indicates current draft version of the protocol the
component is using. This <span class="bcp14">MAY</span> be used as a hint by the receiver of the request
to do compatibility checks between client and server.
For example, A report submission to leader from a client that supports
draft-ietf-ppm-dap-09 could have the header
<code>Media-Type: application/dap-report;version=09</code>.<a href="#section-9.1-4" class="pilcrow">¶</a></p>
<p id="section-9.1-5">The "Media Types" registry at https://www.iana.org/assignments/media-types will
be (RFC EDITOR: replace "will be" with "has been") updated to include each of
these media types. The information required for each media type is listed in
the remaining subsections.<a href="#section-9.1-5" class="pilcrow">¶</a></p>
<div id="applicationdap-hpke-config-list-media-type">
<section id="section-9.1.1">
          <h4 id="name-application-dap-hpke-config">
<a href="#section-9.1.1" class="section-number selfRef">9.1.1. </a><a href="#name-application-dap-hpke-config" class="section-name selfRef">"application/dap-hpke-config-list" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-9.1.1-1">
            <dt id="section-9.1.1-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-1.2">
              <p id="section-9.1.1-1.2.1">application<a href="#section-9.1.1-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.1-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-1.4">
              <p id="section-9.1.1-1.4.1">dap-hpke-config-list<a href="#section-9.1.1-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.1-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-1.6">
              <p id="section-9.1.1-1.6.1">N/A<a href="#section-9.1.1-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.1-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-1.8">
              <p id="section-9.1.1-1.8.1">None<a href="#section-9.1.1-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.1-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-1.10">
              <p id="section-9.1.1-1.10.1">only "8bit" or "binary" is permitted<a href="#section-9.1.1-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.1-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-1.12">
              <p id="section-9.1.1-1.12.1">see <a href="#upload-flow" class="auto internal xref">Section 4.6</a> of the published specification<a href="#section-9.1.1-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.1-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-1.14">
              <p id="section-9.1.1-1.14.1">N/A<a href="#section-9.1.1-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.1-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-1.16">
              <p id="section-9.1.1-1.16.1">RFC XXXX<a href="#section-9.1.1-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.1-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-1.18">
              <p id="section-9.1.1-1.18.1">N/A<a href="#section-9.1.1-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.1-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-1.20">
              <p id="section-9.1.1-1.20.1">N/A<a href="#section-9.1.1-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.1-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-9.1.1-1.22.1">
                <dt id="section-9.1.1-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.1-1.22.1.2">N/A<a href="#section-9.1.1-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.1-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.1-1.22.1.4">N/A<a href="#section-9.1.1-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.1-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.1-1.22.1.6">N/A<a href="#section-9.1.1-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.1-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.1-1.22.1.8">N/A<a href="#section-9.1.1-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.1-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-1.24">
              <p id="section-9.1.1-1.24.1">see Authors' Addresses section of the published specification<a href="#section-9.1.1-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.1-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-1.26">
              <p id="section-9.1.1-1.26.1">COMMON<a href="#section-9.1.1-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.1-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-1.28">
              <p id="section-9.1.1-1.28.1">N/A<a href="#section-9.1.1-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.1-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-1.30">
              <p id="section-9.1.1-1.30.1">see Authors' Addresses section of the published specification<a href="#section-9.1.1-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.1-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-1.32">
              <p id="section-9.1.1-1.32.1">IESG<a href="#section-9.1.1-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationdap-report-media-type">
<section id="section-9.1.2">
          <h4 id="name-application-dap-report-medi">
<a href="#section-9.1.2" class="section-number selfRef">9.1.2. </a><a href="#name-application-dap-report-medi" class="section-name selfRef">"application/dap-report" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-9.1.2-1">
            <dt id="section-9.1.2-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-1.2">
              <p id="section-9.1.2-1.2.1">application<a href="#section-9.1.2-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.2-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-1.4">
              <p id="section-9.1.2-1.4.1">dap-report<a href="#section-9.1.2-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.2-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-1.6">
              <p id="section-9.1.2-1.6.1">N/A<a href="#section-9.1.2-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.2-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-1.8">
              <p id="section-9.1.2-1.8.1">None<a href="#section-9.1.2-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.2-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-1.10">
              <p id="section-9.1.2-1.10.1">only "8bit" or "binary" is permitted<a href="#section-9.1.2-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.2-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-1.12">
              <p id="section-9.1.2-1.12.1">see <a href="#upload-flow" class="auto internal xref">Section 4.6</a> of the published specification<a href="#section-9.1.2-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.2-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-1.14">
              <p id="section-9.1.2-1.14.1">N/A<a href="#section-9.1.2-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.2-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-1.16">
              <p id="section-9.1.2-1.16.1">RFC XXXX<a href="#section-9.1.2-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.2-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-1.18">
              <p id="section-9.1.2-1.18.1">N/A<a href="#section-9.1.2-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.2-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-1.20">
              <p id="section-9.1.2-1.20.1">N/A<a href="#section-9.1.2-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.2-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-9.1.2-1.22.1">
                <dt id="section-9.1.2-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.2-1.22.1.2">N/A<a href="#section-9.1.2-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.2-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.2-1.22.1.4">N/A<a href="#section-9.1.2-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.2-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.2-1.22.1.6">N/A<a href="#section-9.1.2-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.2-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.2-1.22.1.8">N/A<a href="#section-9.1.2-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.2-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-1.24">
              <p id="section-9.1.2-1.24.1">see Authors' Addresses section of the published specification<a href="#section-9.1.2-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.2-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-1.26">
              <p id="section-9.1.2-1.26.1">COMMON<a href="#section-9.1.2-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.2-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-1.28">
              <p id="section-9.1.2-1.28.1">N/A<a href="#section-9.1.2-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.2-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-1.30">
              <p id="section-9.1.2-1.30.1">see Authors' Addresses section of the published specification<a href="#section-9.1.2-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.2-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-1.32">
              <p id="section-9.1.2-1.32.1">IESG<a href="#section-9.1.2-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationdap-aggregation-job-init-req-media-type">
<section id="section-9.1.3">
          <h4 id="name-application-dap-aggregation">
<a href="#section-9.1.3" class="section-number selfRef">9.1.3. </a><a href="#name-application-dap-aggregation" class="section-name selfRef">"application/dap-aggregation-job-init-req" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-9.1.3-1">
            <dt id="section-9.1.3-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.3-1.2">
              <p id="section-9.1.3-1.2.1">application<a href="#section-9.1.3-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.3-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.3-1.4">
              <p id="section-9.1.3-1.4.1">dap-aggregation-job-init-req<a href="#section-9.1.3-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.3-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.3-1.6">
              <p id="section-9.1.3-1.6.1">N/A<a href="#section-9.1.3-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.3-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.3-1.8">
              <p id="section-9.1.3-1.8.1">None<a href="#section-9.1.3-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.3-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.3-1.10">
              <p id="section-9.1.3-1.10.1">only "8bit" or "binary" is permitted<a href="#section-9.1.3-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.3-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.3-1.12">
              <p id="section-9.1.3-1.12.1">see <a href="#aggregate-flow" class="auto internal xref">Section 4.7</a> of the published specification<a href="#section-9.1.3-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.3-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.3-1.14">
              <p id="section-9.1.3-1.14.1">N/A<a href="#section-9.1.3-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.3-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.3-1.16">
              <p id="section-9.1.3-1.16.1">RFC XXXX<a href="#section-9.1.3-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.3-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.3-1.18">
              <p id="section-9.1.3-1.18.1">N/A<a href="#section-9.1.3-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.3-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.3-1.20">
              <p id="section-9.1.3-1.20.1">N/A<a href="#section-9.1.3-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.3-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.3-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-9.1.3-1.22.1">
                <dt id="section-9.1.3-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.3-1.22.1.2">N/A<a href="#section-9.1.3-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.3-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.3-1.22.1.4">N/A<a href="#section-9.1.3-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.3-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.3-1.22.1.6">N/A<a href="#section-9.1.3-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.3-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.3-1.22.1.8">N/A<a href="#section-9.1.3-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.3-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.3-1.24">
              <p id="section-9.1.3-1.24.1">see Authors' Addresses section of the published specification<a href="#section-9.1.3-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.3-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.3-1.26">
              <p id="section-9.1.3-1.26.1">COMMON<a href="#section-9.1.3-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.3-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.3-1.28">
              <p id="section-9.1.3-1.28.1">N/A<a href="#section-9.1.3-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.3-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.3-1.30">
              <p id="section-9.1.3-1.30.1">see Authors' Addresses section of the published specification<a href="#section-9.1.3-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.3-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.3-1.32">
              <p id="section-9.1.3-1.32.1">IESG<a href="#section-9.1.3-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationdap-aggregation-job-resp-media-type">
<section id="section-9.1.4">
          <h4 id="name-application-dap-aggregation-">
<a href="#section-9.1.4" class="section-number selfRef">9.1.4. </a><a href="#name-application-dap-aggregation-" class="section-name selfRef">"application/dap-aggregation-job-resp" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-9.1.4-1">
            <dt id="section-9.1.4-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.4-1.2">
              <p id="section-9.1.4-1.2.1">application<a href="#section-9.1.4-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.4-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.4-1.4">
              <p id="section-9.1.4-1.4.1">dap-aggregation-job-resp<a href="#section-9.1.4-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.4-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.4-1.6">
              <p id="section-9.1.4-1.6.1">N/A<a href="#section-9.1.4-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.4-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.4-1.8">
              <p id="section-9.1.4-1.8.1">None<a href="#section-9.1.4-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.4-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.4-1.10">
              <p id="section-9.1.4-1.10.1">only "8bit" or "binary" is permitted<a href="#section-9.1.4-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.4-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.4-1.12">
              <p id="section-9.1.4-1.12.1">see <a href="#aggregate-flow" class="auto internal xref">Section 4.7</a> of the published specification<a href="#section-9.1.4-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.4-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.4-1.14">
              <p id="section-9.1.4-1.14.1">N/A<a href="#section-9.1.4-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.4-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.4-1.16">
              <p id="section-9.1.4-1.16.1">RFC XXXX<a href="#section-9.1.4-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.4-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.4-1.18">
              <p id="section-9.1.4-1.18.1">N/A<a href="#section-9.1.4-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.4-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.4-1.20">
              <p id="section-9.1.4-1.20.1">N/A<a href="#section-9.1.4-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.4-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.4-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-9.1.4-1.22.1">
                <dt id="section-9.1.4-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.4-1.22.1.2">N/A<a href="#section-9.1.4-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.4-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.4-1.22.1.4">N/A<a href="#section-9.1.4-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.4-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.4-1.22.1.6">N/A<a href="#section-9.1.4-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.4-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.4-1.22.1.8">N/A<a href="#section-9.1.4-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.4-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.4-1.24">
              <p id="section-9.1.4-1.24.1">see Authors' Addresses section of the published specification<a href="#section-9.1.4-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.4-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.4-1.26">
              <p id="section-9.1.4-1.26.1">COMMON<a href="#section-9.1.4-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.4-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.4-1.28">
              <p id="section-9.1.4-1.28.1">N/A<a href="#section-9.1.4-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.4-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.4-1.30">
              <p id="section-9.1.4-1.30.1">see Authors' Addresses section of the published specification<a href="#section-9.1.4-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.4-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.4-1.32">
              <p id="section-9.1.4-1.32.1">IESG<a href="#section-9.1.4-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationdap-aggregation-job-continue-req-media-type">
<section id="section-9.1.5">
          <h4 id="name-application-dap-aggregation-j">
<a href="#section-9.1.5" class="section-number selfRef">9.1.5. </a><a href="#name-application-dap-aggregation-j" class="section-name selfRef">"application/dap-aggregation-job-continue-req" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-9.1.5-1">
            <dt id="section-9.1.5-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.5-1.2">
              <p id="section-9.1.5-1.2.1">application<a href="#section-9.1.5-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.5-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.5-1.4">
              <p id="section-9.1.5-1.4.1">dap-aggregation-job-continue-req<a href="#section-9.1.5-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.5-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.5-1.6">
              <p id="section-9.1.5-1.6.1">N/A<a href="#section-9.1.5-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.5-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.5-1.8">
              <p id="section-9.1.5-1.8.1">None<a href="#section-9.1.5-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.5-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.5-1.10">
              <p id="section-9.1.5-1.10.1">only "8bit" or "binary" is permitted<a href="#section-9.1.5-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.5-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.5-1.12">
              <p id="section-9.1.5-1.12.1">see <a href="#aggregate-flow" class="auto internal xref">Section 4.7</a> of the published specification<a href="#section-9.1.5-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.5-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.5-1.14">
              <p id="section-9.1.5-1.14.1">N/A<a href="#section-9.1.5-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.5-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.5-1.16">
              <p id="section-9.1.5-1.16.1">RFC XXXX<a href="#section-9.1.5-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.5-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.5-1.18">
              <p id="section-9.1.5-1.18.1">N/A<a href="#section-9.1.5-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.5-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.5-1.20">
              <p id="section-9.1.5-1.20.1">N/A<a href="#section-9.1.5-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.5-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.5-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-9.1.5-1.22.1">
                <dt id="section-9.1.5-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.5-1.22.1.2">N/A<a href="#section-9.1.5-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.5-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.5-1.22.1.4">N/A<a href="#section-9.1.5-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.5-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.5-1.22.1.6">N/A<a href="#section-9.1.5-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.5-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.5-1.22.1.8">N/A<a href="#section-9.1.5-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.5-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.5-1.24">
              <p id="section-9.1.5-1.24.1">see Authors' Addresses section of the published specification<a href="#section-9.1.5-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.5-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.5-1.26">
              <p id="section-9.1.5-1.26.1">COMMON<a href="#section-9.1.5-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.5-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.5-1.28">
              <p id="section-9.1.5-1.28.1">N/A<a href="#section-9.1.5-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.5-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.5-1.30">
              <p id="section-9.1.5-1.30.1">see Authors' Addresses section of the published specification<a href="#section-9.1.5-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.5-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.5-1.32">
              <p id="section-9.1.5-1.32.1">IESG<a href="#section-9.1.5-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationdap-aggregate-share-req-media-type">
<section id="section-9.1.6">
          <h4 id="name-application-dap-aggregate-s">
<a href="#section-9.1.6" class="section-number selfRef">9.1.6. </a><a href="#name-application-dap-aggregate-s" class="section-name selfRef">"application/dap-aggregate-share-req" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-9.1.6-1">
            <dt id="section-9.1.6-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.6-1.2">
              <p id="section-9.1.6-1.2.1">application<a href="#section-9.1.6-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.6-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.6-1.4">
              <p id="section-9.1.6-1.4.1">dap-aggregate-share-req<a href="#section-9.1.6-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.6-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.6-1.6">
              <p id="section-9.1.6-1.6.1">N/A<a href="#section-9.1.6-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.6-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.6-1.8">
              <p id="section-9.1.6-1.8.1">None<a href="#section-9.1.6-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.6-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.6-1.10">
              <p id="section-9.1.6-1.10.1">only "8bit" or "binary" is permitted<a href="#section-9.1.6-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.6-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.6-1.12">
              <p id="section-9.1.6-1.12.1">see <a href="#collect-flow" class="auto internal xref">Section 4.8</a> of the published specification<a href="#section-9.1.6-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.6-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.6-1.14">
              <p id="section-9.1.6-1.14.1">N/A<a href="#section-9.1.6-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.6-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.6-1.16">
              <p id="section-9.1.6-1.16.1">RFC XXXX<a href="#section-9.1.6-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.6-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.6-1.18">
              <p id="section-9.1.6-1.18.1">N/A<a href="#section-9.1.6-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.6-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.6-1.20">
              <p id="section-9.1.6-1.20.1">N/A<a href="#section-9.1.6-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.6-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.6-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-9.1.6-1.22.1">
                <dt id="section-9.1.6-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.6-1.22.1.2">N/A<a href="#section-9.1.6-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.6-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.6-1.22.1.4">N/A<a href="#section-9.1.6-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.6-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.6-1.22.1.6">N/A<a href="#section-9.1.6-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.6-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.6-1.22.1.8">N/A<a href="#section-9.1.6-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.6-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.6-1.24">
              <p id="section-9.1.6-1.24.1">see Authors' Addresses section of the published specification<a href="#section-9.1.6-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.6-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.6-1.26">
              <p id="section-9.1.6-1.26.1">COMMON<a href="#section-9.1.6-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.6-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.6-1.28">
              <p id="section-9.1.6-1.28.1">N/A<a href="#section-9.1.6-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.6-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.6-1.30">
              <p id="section-9.1.6-1.30.1">see Authors' Addresses section of the published specification<a href="#section-9.1.6-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.6-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.6-1.32">
              <p id="section-9.1.6-1.32.1">IESG<a href="#section-9.1.6-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationdap-aggregate-share-media-type">
<section id="section-9.1.7">
          <h4 id="name-application-dap-aggregate-sh">
<a href="#section-9.1.7" class="section-number selfRef">9.1.7. </a><a href="#name-application-dap-aggregate-sh" class="section-name selfRef">"application/dap-aggregate-share" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-9.1.7-1">
            <dt id="section-9.1.7-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.7-1.2">
              <p id="section-9.1.7-1.2.1">application<a href="#section-9.1.7-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.7-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.7-1.4">
              <p id="section-9.1.7-1.4.1">dap-aggregate-share<a href="#section-9.1.7-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.7-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.7-1.6">
              <p id="section-9.1.7-1.6.1">N/A<a href="#section-9.1.7-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.7-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.7-1.8">
              <p id="section-9.1.7-1.8.1">None<a href="#section-9.1.7-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.7-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.7-1.10">
              <p id="section-9.1.7-1.10.1">only "8bit" or "binary" is permitted<a href="#section-9.1.7-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.7-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.7-1.12">
              <p id="section-9.1.7-1.12.1">see <a href="#collect-flow" class="auto internal xref">Section 4.8</a> of the published specification<a href="#section-9.1.7-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.7-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.7-1.14">
              <p id="section-9.1.7-1.14.1">N/A<a href="#section-9.1.7-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.7-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.7-1.16">
              <p id="section-9.1.7-1.16.1">RFC XXXX<a href="#section-9.1.7-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.7-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.7-1.18">
              <p id="section-9.1.7-1.18.1">N/A<a href="#section-9.1.7-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.7-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.7-1.20">
              <p id="section-9.1.7-1.20.1">N/A<a href="#section-9.1.7-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.7-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.7-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-9.1.7-1.22.1">
                <dt id="section-9.1.7-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.7-1.22.1.2">N/A<a href="#section-9.1.7-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.7-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.7-1.22.1.4">N/A<a href="#section-9.1.7-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.7-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.7-1.22.1.6">N/A<a href="#section-9.1.7-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.7-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.7-1.22.1.8">N/A<a href="#section-9.1.7-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.7-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.7-1.24">
              <p id="section-9.1.7-1.24.1">see Authors' Addresses section of the published specification<a href="#section-9.1.7-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.7-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.7-1.26">
              <p id="section-9.1.7-1.26.1">COMMON<a href="#section-9.1.7-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.7-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.7-1.28">
              <p id="section-9.1.7-1.28.1">N/A<a href="#section-9.1.7-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.7-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.7-1.30">
              <p id="section-9.1.7-1.30.1">see Authors' Addresses section of the published specification<a href="#section-9.1.7-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.7-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.7-1.32">
              <p id="section-9.1.7-1.32.1">IESG<a href="#section-9.1.7-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationdap-collection-job-req-media-type">
<section id="section-9.1.8">
          <h4 id="name-application-dap-collection-">
<a href="#section-9.1.8" class="section-number selfRef">9.1.8. </a><a href="#name-application-dap-collection-" class="section-name selfRef">"application/dap-collection-job-req" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-9.1.8-1">
            <dt id="section-9.1.8-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.8-1.2">
              <p id="section-9.1.8-1.2.1">application<a href="#section-9.1.8-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.8-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.8-1.4">
              <p id="section-9.1.8-1.4.1">dap-collection-job-req<a href="#section-9.1.8-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.8-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.8-1.6">
              <p id="section-9.1.8-1.6.1">N/A<a href="#section-9.1.8-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.8-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.8-1.8">
              <p id="section-9.1.8-1.8.1">None<a href="#section-9.1.8-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.8-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.8-1.10">
              <p id="section-9.1.8-1.10.1">only "8bit" or "binary" is permitted<a href="#section-9.1.8-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.8-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.8-1.12">
              <p id="section-9.1.8-1.12.1">see <a href="#collect-flow" class="auto internal xref">Section 4.8</a> of the published specification<a href="#section-9.1.8-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.8-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.8-1.14">
              <p id="section-9.1.8-1.14.1">N/A<a href="#section-9.1.8-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.8-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.8-1.16">
              <p id="section-9.1.8-1.16.1">RFC XXXX<a href="#section-9.1.8-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.8-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.8-1.18">
              <p id="section-9.1.8-1.18.1">N/A<a href="#section-9.1.8-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.8-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.8-1.20">
              <p id="section-9.1.8-1.20.1">N/A<a href="#section-9.1.8-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.8-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.8-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-9.1.8-1.22.1">
                <dt id="section-9.1.8-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.8-1.22.1.2">N/A<a href="#section-9.1.8-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.8-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.8-1.22.1.4">N/A<a href="#section-9.1.8-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.8-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.8-1.22.1.6">N/A<a href="#section-9.1.8-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.8-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.8-1.22.1.8">N/A<a href="#section-9.1.8-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.8-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.8-1.24">
              <p id="section-9.1.8-1.24.1">see Authors' Addresses section of the published specification<a href="#section-9.1.8-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.8-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.8-1.26">
              <p id="section-9.1.8-1.26.1">COMMON<a href="#section-9.1.8-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.8-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.8-1.28">
              <p id="section-9.1.8-1.28.1">N/A<a href="#section-9.1.8-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.8-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.8-1.30">
              <p id="section-9.1.8-1.30.1">see Authors' Addresses section of the published specification<a href="#section-9.1.8-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.8-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.8-1.32">
              <p id="section-9.1.8-1.32.1">IESG<a href="#section-9.1.8-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationdap-collection-job-resp-media-type">
<section id="section-9.1.9">
          <h4 id="name-application-dap-collection-j">
<a href="#section-9.1.9" class="section-number selfRef">9.1.9. </a><a href="#name-application-dap-collection-j" class="section-name selfRef">"application/dap-collection-job-resp" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-9.1.9-1">
            <dt id="section-9.1.9-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.9-1.2">
              <p id="section-9.1.9-1.2.1">application<a href="#section-9.1.9-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.9-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.9-1.4">
              <p id="section-9.1.9-1.4.1">dap-collection-job-resp<a href="#section-9.1.9-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.9-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.9-1.6">
              <p id="section-9.1.9-1.6.1">N/A<a href="#section-9.1.9-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.9-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.9-1.8">
              <p id="section-9.1.9-1.8.1">None<a href="#section-9.1.9-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.9-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.9-1.10">
              <p id="section-9.1.9-1.10.1">only "8bit" or "binary" is permitted<a href="#section-9.1.9-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.9-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.9-1.12">
              <p id="section-9.1.9-1.12.1">see <a href="#collect-flow" class="auto internal xref">Section 4.8</a> of the published specification<a href="#section-9.1.9-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.9-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.9-1.14">
              <p id="section-9.1.9-1.14.1">N/A<a href="#section-9.1.9-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.9-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.9-1.16">
              <p id="section-9.1.9-1.16.1">RFC XXXX<a href="#section-9.1.9-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.9-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.9-1.18">
              <p id="section-9.1.9-1.18.1">N/A<a href="#section-9.1.9-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.9-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.9-1.20">
              <p id="section-9.1.9-1.20.1">N/A<a href="#section-9.1.9-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.9-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.9-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-9.1.9-1.22.1">
                <dt id="section-9.1.9-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.9-1.22.1.2">N/A<a href="#section-9.1.9-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.9-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.9-1.22.1.4">N/A<a href="#section-9.1.9-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.9-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.9-1.22.1.6">N/A<a href="#section-9.1.9-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-9.1.9-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-9.1.9-1.22.1.8">N/A<a href="#section-9.1.9-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.9-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.9-1.24">
              <p id="section-9.1.9-1.24.1">see Authors' Addresses section of the published specification<a href="#section-9.1.9-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.9-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.9-1.26">
              <p id="section-9.1.9-1.26.1">COMMON<a href="#section-9.1.9-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.9-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.9-1.28">
              <p id="section-9.1.9-1.28.1">N/A<a href="#section-9.1.9-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.9-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.9-1.30">
              <p id="section-9.1.9-1.30.1">see Authors' Addresses section of the published specification<a href="#section-9.1.9-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.9-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.9-1.32">
              <p id="section-9.1.9-1.32.1">IESG<a href="#section-9.1.9-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="iana-codepoints">
<section id="section-9.2">
        <h3 id="name-dap-type-registries">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-dap-type-registries" class="section-name selfRef">DAP Type Registries</a>
        </h3>
<p id="section-9.2-1">This document also requests creation of a new "Distributed Aggregation Protocol
(DAP)" page. This page will contain several new registries, described in the
following sections. All registries are administered under the Specification
Required policy <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<div id="batch-mode-reg">
<section id="section-9.2.1">
          <h4 id="name-batch-modes-registry">
<a href="#section-9.2.1" class="section-number selfRef">9.2.1. </a><a href="#name-batch-modes-registry" class="section-name selfRef">Batch Modes Registry</a>
          </h4>
<p id="section-9.2.1-1">A new registry will be (RFC EDITOR: change "will be" to "has been") created
called "Batch Mode Identifiers" for DAP batch modes (<a href="#batch-mode" class="auto internal xref">Section 4.2</a>). This
registry should contain the following columns:<a href="#section-9.2.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-9.2.1-2">
            <dt id="section-9.2.1-2.1">Value:</dt>
            <dd style="margin-left: 1.5em" id="section-9.2.1-2.2">
              <p id="section-9.2.1-2.2.1">The one-byte identifier for the batch mode<a href="#section-9.2.1-2.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.2.1-2.3">Name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.2.1-2.4">
              <p id="section-9.2.1-2.4.1">The name of the batch mode<a href="#section-9.2.1-2.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.2.1-2.5">Reference:</dt>
            <dd style="margin-left: 1.5em" id="section-9.2.1-2.6">
              <p id="section-9.2.1-2.6.1">Where the batch mode is defined<a href="#section-9.2.1-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-9.2.1-3">The initial contents of this registry listed in <a href="#batch-mode-id" class="auto internal xref">Table 2</a>.<a href="#section-9.2.1-3" class="pilcrow">¶</a></p>
<span id="name-initial-contents-of-the-bat"></span><div id="batch-mode-id">
<table class="center" id="table-2">
            <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-initial-contents-of-the-bat" class="selfRef">Initial contents of the Batch Mode Identifiers registry.</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Value</th>
                <th class="text-left" rowspan="1" colspan="1">Name</th>
                <th class="text-left" rowspan="1" colspan="1">Reference</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>0x00</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>reserved</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#batch-mode" class="auto internal xref">Section 4.2</a> of RFC XXXX</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>0x01</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>time_interval</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#time-interval-batch-mode" class="auto internal xref">Section 5.1</a> of RFC XXXX</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>0x02</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>leader_selected</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#leader-selected-batch-mode" class="auto internal xref">Section 5.2</a> of RFC XXXX</td>
              </tr>
            </tbody>
          </table>
</div>
</section>
</div>
<div id="report-extension-registry">
<section id="section-9.2.2">
          <h4 id="name-report-extension-registry">
<a href="#section-9.2.2" class="section-number selfRef">9.2.2. </a><a href="#name-report-extension-registry" class="section-name selfRef">Report Extension Registry</a>
          </h4>
<p id="section-9.2.2-1">A new registry will be (RFC EDITOR: change "will be" to "has been") created
called "Report Extension Identifiers" for extensions to the upload interaction
(<a href="#upload-flow" class="auto internal xref">Section 4.6</a>). This registry should contain the following columns:<a href="#section-9.2.2-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-9.2.2-2">
            <dt id="section-9.2.2-2.1">Value:</dt>
            <dd style="margin-left: 1.5em" id="section-9.2.2-2.2">
              <p id="section-9.2.2-2.2.1">The two-byte identifier for the upload extension<a href="#section-9.2.2-2.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.2.2-2.3">Name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.2.2-2.4">
              <p id="section-9.2.2-2.4.1">The name of the upload extension<a href="#section-9.2.2-2.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.2.2-2.5">Reference:</dt>
            <dd style="margin-left: 1.5em" id="section-9.2.2-2.6">
              <p id="section-9.2.2-2.6.1">Where the upload extension is defined<a href="#section-9.2.2-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-9.2.2-3">The initial contents of this registry are listed in <a href="#upload-extension-id" class="auto internal xref">Table 3</a>.<a href="#section-9.2.2-3" class="pilcrow">¶</a></p>
<span id="name-initial-contents-of-the-rep"></span><div id="upload-extension-id">
<table class="center" id="table-3">
            <caption>
<a href="#table-3" class="selfRef">Table 3</a>:
<a href="#name-initial-contents-of-the-rep" class="selfRef">Initial contents of the Report Extension Identifiers registry.</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Value</th>
                <th class="text-left" rowspan="1" colspan="1">Name</th>
                <th class="text-left" rowspan="1" colspan="1">Reference</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>0x0000</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>reserved</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">RFC XXXX</td>
              </tr>
            </tbody>
          </table>
</div>
</section>
</div>
<div id="report-error-reg">
<section id="section-9.2.3">
          <h4 id="name-report-error-registry">
<a href="#section-9.2.3" class="section-number selfRef">9.2.3. </a><a href="#name-report-error-registry" class="section-name selfRef">Report Error Registry</a>
          </h4>
<p id="section-9.2.3-1">A new registry will be (RFC EDITOR: change "will be" to "has been") created
called "Report Error Identifiers" for reasons for rejecting reports during the
aggregation interaction (<a href="#aggregation-helper-init" class="auto internal xref">Section 4.7.1.2</a>).<a href="#section-9.2.3-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-9.2.3-2">
            <dt id="section-9.2.3-2.1">Value:</dt>
            <dd style="margin-left: 1.5em" id="section-9.2.3-2.2">
              <p id="section-9.2.3-2.2.1">The one-byte identifier of the report error<a href="#section-9.2.3-2.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.2.3-2.3">Name:</dt>
            <dd style="margin-left: 1.5em" id="section-9.2.3-2.4">
              <p id="section-9.2.3-2.4.1">The name of the report error<a href="#section-9.2.3-2.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-9.2.3-2.5">Reference:</dt>
            <dd style="margin-left: 1.5em" id="section-9.2.3-2.6">
              <p id="section-9.2.3-2.6.1">Where the report error is defined<a href="#section-9.2.3-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-9.2.3-3">The initial contents of this registry are listed below in <a href="#report-error-id" class="auto internal xref">Table 4</a>.<a href="#section-9.2.3-3" class="pilcrow">¶</a></p>
<span id="name-initial-contents-of-the-repo"></span><div id="report-error-id">
<table class="center" id="table-4">
            <caption>
<a href="#table-4" class="selfRef">Table 4</a>:
<a href="#name-initial-contents-of-the-repo" class="selfRef">Initial contents of the Report Error Identifiers registry.</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Value</th>
                <th class="text-left" rowspan="1" colspan="1">Name</th>
                <th class="text-left" rowspan="1" colspan="1">Reference</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>0x00</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>reserved</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#aggregation-helper-init" class="auto internal xref">Section 4.7.1.2</a> of RFX XXXX</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>0x01</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>batch_collected</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#aggregation-helper-init" class="auto internal xref">Section 4.7.1.2</a> of RFX XXXX</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>0x02</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>report_replayed</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#aggregation-helper-init" class="auto internal xref">Section 4.7.1.2</a> of RFX XXXX</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>0x03</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>report_dropped</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#aggregation-helper-init" class="auto internal xref">Section 4.7.1.2</a> of RFX XXXX</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>0x04</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>hpke_unknown_config_id</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#aggregation-helper-init" class="auto internal xref">Section 4.7.1.2</a> of RFX XXXX</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>0x05</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>hpke_decrypt_error</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#aggregation-helper-init" class="auto internal xref">Section 4.7.1.2</a> of RFX XXXX</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>0x06</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>vdaf_prep_error</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#aggregation-helper-init" class="auto internal xref">Section 4.7.1.2</a> of RFX XXXX</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>0x07</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>task_expired</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#aggregation-helper-init" class="auto internal xref">Section 4.7.1.2</a> of RFX XXXX</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>0x08</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>invalid_message</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#aggregation-helper-init" class="auto internal xref">Section 4.7.1.2</a> of RFX XXXX</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>0x09</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>report_too_early</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#aggregation-helper-init" class="auto internal xref">Section 4.7.1.2</a> of RFX XXXX</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>0x10</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>task_not_started</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#aggregation-helper-init" class="auto internal xref">Section 4.7.1.2</a> of RFX XXXX</td>
              </tr>
            </tbody>
          </table>
</div>
</section>
</div>
</section>
</div>
<div id="urn-space">
<section id="section-9.3">
        <h3 id="name-urn-sub-namespace-for-dap-u">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-urn-sub-namespace-for-dap-u" class="section-name selfRef">URN Sub-namespace for DAP (urn:ietf:params:ppm:dap)</a>
        </h3>
<p id="section-9.3-1">The following value will be (RFC EDITOR: change "will be" to "has been")
registered in the "IETF URN Sub-namespace for Registered Protocol
Parameter Identifiers" registry, following the template in <span>[<a href="#RFC3553" class="cite xref">RFC3553</a>]</span>:<a href="#section-9.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.3-2">
<pre>
Registry name:  dap

Specification:  RFC XXXX

Repository:  http://www.iana.org/assignments/dap

Index value:  No transformation needed.
</pre><a href="#section-9.3-2" class="pilcrow">¶</a>
</div>
<p id="section-9.3-3">The initial contents of this namespace are the types and descriptions in
<a href="#urn-space-errors" class="auto internal xref">Table 1</a>, with the Reference field set to RFC XXXX.<a href="#section-9.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="extending-this-doc">
<section id="section-10">
      <h2 id="name-extending-this-document">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-extending-this-document" class="section-name selfRef">Extending this Document</a>
      </h2>
<p id="section-10-1">The behavior of DAP may be extended or modified by future documents defining
one or more of the following:<a href="#section-10-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-10-2">
<li id="section-10-2.1">
          <p id="section-10-2.1.1">a new batch mode (<a href="#batch-mode" class="auto internal xref">Section 4.2</a>)<a href="#section-10-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-10-2.2">
          <p id="section-10-2.2.1">a new report extension (<a href="#report-extensions" class="auto internal xref">Section 4.6.3</a>)<a href="#section-10-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-10-2.3">
          <p id="section-10-2.3.1">a new report error (<a href="#aggregation-helper-init" class="auto internal xref">Section 4.7.1.2</a>)<a href="#section-10-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-10-2.4">
          <p id="section-10-2.4.1">a new entry in the URN sub-namespace for DAP (<a href="#urn-space-errors" class="auto internal xref">Table 1</a>)<a href="#section-10-2.4.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-10-3">Each of these requires registration of a codepoint or other value; see
<a href="#iana" class="auto internal xref">Section 9</a>. No other considerations are required except in the following cases:<a href="#section-10-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10-4.1">
          <p id="section-10-4.1.1">When a document defines a new batch mode, it <span class="bcp14">MUST</span> include a section titled
"DAP Batch Mode Considerations" specifying the following:<a href="#section-10-4.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10-4.1.2.1">
              <p id="section-10-4.1.2.1.1">The value of the <code>config</code> field of <code>Query</code>, <code>PartialBatchSelector</code>, and
<code>BatchSelector</code><a href="#section-10-4.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-10-4.1.2.2">
              <p id="section-10-4.1.2.2.1">Batch buckets (<a href="#batch-buckets" class="auto internal xref">Section 4.7.2.3</a>): how reports are assigned to batch
buckets; how each bucket is identified; and how batch buckets are mapped to
batches.<a href="#section-10-4.1.2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-10-4.1.3">
See <a href="#batch-modes" class="auto internal xref">Section 5</a> for examples.<a href="#section-10-4.1.3" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-10-4.2">
          <p id="section-10-4.2.1">When a document defines a new report extension, it <span class="bcp14">SHOULD</span> include in its
"Security Considerations" section some discussion of how the extension
impacts the security of DAP with respect to the threat model in
<a href="#sec-considerations" class="auto internal xref">Section 8</a>.<a href="#section-10-4.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="sec-combined-references">
<section id="section-11">
      <h2 id="name-references">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-11.1">
        <h3 id="name-normative-references">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="HPKE">[HPKE]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Bhargavan, K.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">C. Wood</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="seriesInfo">RFC 9180</span>, <span class="seriesInfo">DOI 10.17487/RFC9180</span>, <time datetime="2022-02" class="refDate">February 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9180">https://www.rfc-editor.org/rfc/rfc9180</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="OAuth2">[OAuth2]</dt>
        <dd>
<span class="refAuthor">Hardt, D., Ed.</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework"</span>, <span class="seriesInfo">RFC 6749</span>, <span class="seriesInfo">DOI 10.17487/RFC6749</span>, <time datetime="2012-10" class="refDate">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6749">https://www.rfc-editor.org/rfc/rfc6749</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3553">[RFC3553]</dt>
        <dd>
<span class="refAuthor">Mealling, M.</span>, <span class="refAuthor">Masinter, L.</span>, <span class="refAuthor">Hardie, T.</span>, and <span class="refAuthor">G. Klyne</span>, <span class="refTitle">"An IETF URN Sub-namespace for Registered Protocol Parameters"</span>, <span class="seriesInfo">BCP 73</span>, <span class="seriesInfo">RFC 3553</span>, <span class="seriesInfo">DOI 10.17487/RFC3553</span>, <time datetime="2003-06" class="refDate">June 2003</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc3553">https://www.rfc-editor.org/rfc/rfc3553</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4648">[RFC4648]</dt>
        <dd>
<span class="refAuthor">Josefsson, S.</span>, <span class="refTitle">"The Base16, Base32, and Base64 Data Encodings"</span>, <span class="seriesInfo">RFC 4648</span>, <span class="seriesInfo">DOI 10.17487/RFC4648</span>, <time datetime="2006-10" class="refDate">October 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4648">https://www.rfc-editor.org/rfc/rfc4648</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5861">[RFC5861]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refTitle">"HTTP Cache-Control Extensions for Stale Content"</span>, <span class="seriesInfo">RFC 5861</span>, <span class="seriesInfo">DOI 10.17487/RFC5861</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5861">https://www.rfc-editor.org/rfc/rfc5861</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7807">[RFC7807]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span> and <span class="refAuthor">E. Wilde</span>, <span class="refTitle">"Problem Details for HTTP APIs"</span>, <span class="seriesInfo">RFC 7807</span>, <span class="seriesInfo">DOI 10.17487/RFC7807</span>, <time datetime="2016-03" class="refDate">March 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7807">https://www.rfc-editor.org/rfc/rfc7807</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8126">[RFC8126]</dt>
        <dd>
<span class="refAuthor">Cotton, M.</span>, <span class="refAuthor">Leiba, B.</span>, and <span class="refAuthor">T. Narten</span>, <span class="refTitle">"Guidelines for Writing an IANA Considerations Section in RFCs"</span>, <span class="seriesInfo">BCP 26</span>, <span class="seriesInfo">RFC 8126</span>, <span class="seriesInfo">DOI 10.17487/RFC8126</span>, <time datetime="2017-06" class="refDate">June 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8126">https://www.rfc-editor.org/rfc/rfc8126</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9110">[RFC9110]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP Semantics"</span>, <span class="seriesInfo">STD 97</span>, <span class="seriesInfo">RFC 9110</span>, <span class="seriesInfo">DOI 10.17487/RFC9110</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9110">https://www.rfc-editor.org/rfc/rfc9110</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9111">[RFC9111]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP Caching"</span>, <span class="seriesInfo">STD 98</span>, <span class="seriesInfo">RFC 9111</span>, <span class="seriesInfo">DOI 10.17487/RFC9111</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9111">https://www.rfc-editor.org/rfc/rfc9111</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9457">[RFC9457]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refAuthor">Wilde, E.</span>, and <span class="refAuthor">S. Dalal</span>, <span class="refTitle">"Problem Details for HTTP APIs"</span>, <span class="seriesInfo">RFC 9457</span>, <span class="seriesInfo">DOI 10.17487/RFC9457</span>, <time datetime="2023-07" class="refDate">July 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9457">https://www.rfc-editor.org/rfc/rfc9457</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9458">[RFC9458]</dt>
        <dd>
<span class="refAuthor">Thomson, M.</span> and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Oblivious HTTP"</span>, <span class="seriesInfo">RFC 9458</span>, <span class="seriesInfo">DOI 10.17487/RFC9458</span>, <time datetime="2024-01" class="refDate">January 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9458">https://www.rfc-editor.org/rfc/rfc9458</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SHS">[SHS]</dt>
        <dd>
<span class="refTitle">"Secure hash standard"</span>, <span class="refContent">National Institute of Standards and Technology (U.S.)</span>, <span class="seriesInfo">DOI 10.6028/nist.fips.180-4</span>, <time datetime="2015" class="refDate">2015</time>, <span>&lt;<a href="https://doi.org/10.6028/nist.fips.180-4">https://doi.org/10.6028/nist.fips.180-4</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="VDAF">[VDAF]</dt>
      <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Cook, D.</span>, <span class="refAuthor">Patton, C.</span>, and <span class="refAuthor">P. Schoppmann</span>, <span class="refTitle">"Verifiable Distributed Aggregation Functions"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-vdaf-14</span>, <time datetime="2025-01-10" class="refDate">10 January 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-14</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-11.2">
        <h3 id="name-informative-references">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="Dou02">[Dou02]</dt>
        <dd>
<span class="refAuthor">Douceur, J. R.</span>, <span class="refTitle">"The Sybil Attack"</span>, <span class="refContent">International Workshop on Peer-to-Peer Systems (IPTPS)</span>, <time datetime="2002" class="refDate">2002</time>, <span>&lt;<a href="https://doi.org/10.1007/3-540-45748-8_24">https://doi.org/10.1007/3-540-45748-8_24</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.draft-dcook-ppm-dap-interop-test-design-04">[I-D.draft-dcook-ppm-dap-interop-test-design-04]</dt>
        <dd>
<span class="refAuthor">Cook, D.</span>, <span class="refTitle">"DAP Interoperation Test Design"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-dcook-ppm-dap-interop-test-design-04</span>, <time datetime="2023-06-14" class="refDate">14 June 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-dcook-ppm-dap-interop-test-design-04">https://datatracker.ietf.org/doc/html/draft-dcook-ppm-dap-interop-test-design-04</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.draft-ietf-privacypass-architecture-16">[I-D.draft-ietf-privacypass-architecture-16]</dt>
        <dd>
<span class="refAuthor">Davidson, A.</span>, <span class="refAuthor">Iyengar, J.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"The Privacy Pass Architecture"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-privacypass-architecture-16</span>, <time datetime="2023-09-25" class="refDate">25 September 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-architecture-16">https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-architecture-16</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5869">[RFC5869]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span> and <span class="refAuthor">P. Eronen</span>, <span class="refTitle">"HMAC-based Extract-and-Expand Key Derivation Function (HKDF)"</span>, <span class="seriesInfo">RFC 5869</span>, <span class="seriesInfo">DOI 10.17487/RFC5869</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5869">https://www.rfc-editor.org/rfc/rfc5869</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Vad16">[Vad16]</dt>
      <dd>
<span class="refAuthor">Vadhan, S.</span>, <span class="refTitle">"The Complexity of Differential Privacy"</span>, <time datetime="2016" class="refDate">2016</time>, <span>&lt;<a href="https://privacytools.seas.harvard.edu/files/privacytools/files/complexityprivacy_1.pdf">https://privacytools.seas.harvard.edu/files/privacytools/files/complexityprivacy_1.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="contributors">
<section id="appendix-A">
      <h2 id="name-contributors">
<a href="#name-contributors" class="section-name selfRef">Contributors</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Josh Aas</span></div>
<div dir="auto" class="left"><span class="org">ISRG</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:josh@abetterinternet.org" class="email">josh@abetterinternet.org</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Junye Chen</span></div>
<div dir="auto" class="left"><span class="org">Apple</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:junyec@apple.com" class="email">junyec@apple.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">David Cook</span></div>
<div dir="auto" class="left"><span class="org">ISRG</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:dcook@divviup.org" class="email">dcook@divviup.org</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Suman Ganta</span></div>
<div dir="auto" class="left"><span class="org">Apple</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:sganta2@apple.com" class="email">sganta2@apple.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Ameer Ghani</span></div>
<div dir="auto" class="left"><span class="org">ISRG</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:inahga@divviup.org" class="email">inahga@divviup.org</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Kristine Guo</span></div>
<div dir="auto" class="left"><span class="org">Apple</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:kristine_guo@apple.com" class="email">kristine_guo@apple.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Charlie Harrison</span></div>
<div dir="auto" class="left"><span class="org">Google</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:csharrison@chromium.org" class="email">csharrison@chromium.org</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Peter Saint-Andre</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:stpeter@gmail.com" class="email">stpeter@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Shivan Sahib</span></div>
<div dir="auto" class="left"><span class="org">Brave</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:shivankaulsahib@gmail.com" class="email">shivankaulsahib@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Phillipp Schoppmann</span></div>
<div dir="auto" class="left"><span class="org">Google</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:schoppmann@google.com" class="email">schoppmann@google.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Martin Thomson</span></div>
<div dir="auto" class="left"><span class="org">Mozilla</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mt@mozilla.com" class="email">mt@mozilla.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Shan Wang</span></div>
<div dir="auto" class="left"><span class="org">Apple</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:shan_wang@apple.com" class="email">shan_wang@apple.com</a>
</div>
</address>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Tim Geoghegan</span></div>
<div dir="auto" class="left"><span class="org">ISRG</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:timgeog+ietf@gmail.com" class="email">timgeog+ietf@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher Patton</span></div>
<div dir="auto" class="left"><span class="org">Cloudflare</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:chrispatton+ietf@gmail.com" class="email">chrispatton+ietf@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Brandon Pitman</span></div>
<div dir="auto" class="left"><span class="org">ISRG</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:bran@bran.land" class="email">bran@bran.land</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Eric Rescorla</span></div>
<div dir="auto" class="left"><span class="org">Independent</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ekr@rtfm.com" class="email">ekr@rtfm.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher A. Wood</span></div>
<div dir="auto" class="left"><span class="org">Cloudflare</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:caw@heapingbits.net" class="email">caw@heapingbits.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
